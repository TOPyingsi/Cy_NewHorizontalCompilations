System.register("chunks:///_virtual/37_JJTW_Bundle",["./JJTW_ColliderGroupNumber.ts","./JJTW_ColliderManager.ts","./JJTW_DataManager.ts","./JJTW_GameUI.ts","./JJTW_GuidanceManager.ts","./JJTW_MonsterAI.ts","./JJTW_NPCAICtrl.ts","./JJTW_PlayerController.ts","./JJTW_ScanSysem.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/JJTW_ColliderGroupNumber.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(o){var r,e,i,t,l,n,s,a;return{setters:[function(o){r=o.applyDecoratedDescriptor,e=o.initializerDefineProperty},function(o){i=o.cclegacy,t=o.CCInteger,l=o.Node,n=o._decorator,s=o.Component,a=o.Vec3}],execute:function(){var u,p,_,c,g,h,d,D,m,C,y,b,f,A,N,S,w;i._RF.push({},"15918JqhP1MoqstwNgCrDmc","JJTW_ColliderGroupNumber",void 0);const{ccclass:z,property:Y}=n;let J=o("JJTW_ColliderGroupType",function(o){return o[o.Wall=0]="Wall",o[o.Barrier=1]="Barrier",o[o.Stairs=2]="Stairs",o[o.Floor=3]="Floor",o[o.Player_Collider=4]="Player_Collider",o[o.Player_Scan=5]="Player_Scan",o[o.NPC_Scan=6]="NPC_Scan",o[o.NPC_Collider=7]="NPC_Collider",o[o.Monster_Scan=8]="Monster_Scan",o[o.Monster_Collider=9]="Monster_Collider",o[o.Key=10]="Key",o[o.Compass_1=11]="Compass_1",o[o.Compass_2=12]="Compass_2",o[o.Compass_3=13]="Compass_3",o[o.Compass_4=14]="Compass_4",o[o.Compass_5=15]="Compass_5",o[o.Compass_6=16]="Compass_6",o[o.File=17]="File",o[o.Door_1=18]="Door_1",o[o.Door_2=19]="Door_2",o[o.Door_3=20]="Door_3",o[o.Door_4=21]="Door_4",o[o.Door_5=22]="Door_5",o[o.Door_6=23]="Door_6",o[o.Door_Normal=24]="Door_Normal",o[o.Door_Exit=25]="Door_Exit",o[o.Exit_End=26]="Exit_End",o[o.Door_Stair_1=27]="Door_Stair_1",o[o.Door_Stair_2=28]="Door_Stair_2",o[o.House=29]="House",o}({}));o("JJTW_ColliderGroupNumber",(u=z("JJTW_ColliderGroupNumber"),p=Y(t),_=Y({type:Boolean}),c=Y({type:l}),g=Y({type:l}),h=Y({type:Number}),d=Y({type:Number}),D=Y({type:l}),u((y=r((C=class extends s{constructor(...o){super(...o),e(this,"groupType",y,this),e(this,"isDoor",b,this),e(this,"door1",f,this),e(this,"door2",A,this),e(this,"openAngelYDoor1",N,this),e(this,"openAngelYDoor2",S,this),e(this,"compassNode",w,this),this.orignAngelYOoor1=null,this.orignAngelYOoor2=null}start(){this.isDoor&&(this.door1&&(this.orignAngelYOoor1=this.door1.eulerAngles.y),this.door2&&(this.orignAngelYOoor2=this.door2.eulerAngles.y))}setDoorOpen(){if(this.door1){let o=this.door1.eulerAngles;this.door1.eulerAngles=new a(o.x,this.openAngelYDoor1,o.z)}if(this.door2){let o=this.door2.eulerAngles;this.door2.eulerAngles=new a(o.x,this.openAngelYDoor2,o.z)}}setDoorClose(){if(this.door1){let o=this.door2.eulerAngles;this.door1.eulerAngles=new a(o.x,this.orignAngelYOoor1,o.z)}if(this.door2){let o=this.door2.eulerAngles;this.door2.eulerAngles=new a(o.x,this.orignAngelYOoor2,o.z)}}}).prototype,"groupType",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return J.Wall}}),b=r(C.prototype,"isDoor",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),f=r(C.prototype,"door1",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=r(C.prototype,"door2",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=r(C.prototype,"openAngelYDoor1",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),S=r(C.prototype,"openAngelYDoor2",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),w=r(C.prototype,"compassNode",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),m=C))||m));i._RF.pop()}}}));

System.register("chunks:///_virtual/JJTW_ColliderManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./JJTW_ColliderGroupNumber.ts","./JJTW_DataManager.ts"],(function(e){var r,t,i,n,a,l,o,s,u;return{setters:[function(e){r=e.applyDecoratedDescriptor,t=e.initializerDefineProperty},function(e){i=e.cclegacy,n=e.Node,a=e._decorator,l=e.Component},function(e){o=e.JJTW_ColliderGroupNumber,s=e.JJTW_ColliderGroupType},function(e){u=e.JJTW_DataManager}],execute:function(){var p,c,h,b,d,f,g,J,y,m,T,W,_,C,P;i._RF.push({},"f3b25Owt3pMZrPpZJTsUGCG","JJTW_ColliderManager",void 0);const{ccclass:M,property:w}=a;e("JJTW_ColliderManager",(p=M("JJTW_ColliderManager"),c=w(n),h=w(n),b=w(n),d=w(n),f=w(n),g=w(n),p((m=r((y=class extends l{constructor(...e){super(...e),t(this,"Wall",m,this),t(this,"BarrierParent",T,this),t(this,"Stairs",W,this),t(this,"Floor",_,this),t(this,"Key",C,this),t(this,"itemParent",P,this)}start(){u.Instance.resetData();for(let e=0;e<this.Wall.length;e++)this.Wall[e].addComponent(o).groupType=s.Wall;for(let e=0;e<this.BarrierParent.children.length;e++)this.BarrierParent.children[e].addComponent(o).groupType=s.Barrier;for(let e=0;e<this.Stairs.length;e++)this.Stairs[e].addComponent(o).groupType=s.Stairs;this.itemParent.children.forEach((e=>{}))}}).prototype,"Wall",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),T=r(y.prototype,"BarrierParent",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=r(y.prototype,"Stairs",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_=r(y.prototype,"Floor",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),C=r(y.prototype,"Key",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=r(y.prototype,"itemParent",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J=y))||J));i._RF.pop()}}}));

System.register("chunks:///_virtual/JJTW_DataManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,s,o,e,r,a,n;return{setters:[function(t){i=t.applyDecoratedDescriptor,s=t.initializerDefineProperty},function(t){o=t.cclegacy,e=t.Node,r=t._decorator,a=t.Component,n=t.Vec3}],execute:function(){var l,h,u,d,c,m;o._RF.push({},"5735aYVUBdAn7216jtIaegM","JJTW_DataManager",void 0);const{ccclass:D,property:w}=r;t("JJTW_DataManager",(l=D("JJTW_DataManager"),h=w(e),l(((m=class t extends a{constructor(...t){super(...t),s(this,"pathWaypointsParent",c,this),this.isGameStart=!1,this.isGuidanding=!1,this.isStartToLightDownCount=!1,this.currentStepIndex=0,this.isMove=!1,this.delta=null,this.isScream=!1,this.isFlashlight=!0,this.isLightCanOpen=!0,this.isScaning=!1,this.currentTargetPos=null,this.currentPlayerPos=null,this.itemFloorNumber=1,this.isPlayerDead=!1,this.isDownStairDoorOpen=!1,this.isUpStairDoorOpen=!1,this.keyData={worldPos:new n(-3.271,-1.344,8.185),isGot:!1,floorNumber:2},this.compassData=[{id:0,worldPos:new n(18.881,-.588,-6.663),isGot:!1,isSet:!1,floorNumber:2},{id:1,worldPos:new n(27.876,-.466,2.233),isGot:!1,isSet:!1,floorNumber:2},{id:2,worldPos:new n(-7.237,-1.348,13.335),isGot:!1,isSet:!1,floorNumber:2},{id:3,worldPos:new n(25.634,-.411,6.003),isGot:!1,isSet:!1,floorNumber:2},{id:4,worldPos:new n(17.939,-4.838,-3.945),isGot:!1,isSet:!1,floorNumber:1},{id:5,worldPos:new n(9.145,-3.927,-7.711),isGot:!1,isSet:!1,floorNumber:1}],this.fileData={worldPos:new n(-4.782,-.301,-3.04),isGot:!1,isSet:!1,floorNumber:2},this.liveNPCData=[{id:1,isDead:!1},{id:2,isDead:!1}]}onLoad(){t.Instance=this}resetData(){this.isGameStart=!1,this.isGuidanding=!1,this.isStartToLightDownCount=!1,this.currentStepIndex=0,this.isMove=!1,this.delta=null,this.isScream=!1,this.isFlashlight=!0,this.isLightCanOpen=!0,this.currentTargetPos=null,this.currentPlayerPos=null,this.itemFloorNumber=1,this.isPlayerDead=!1,this.isDownStairDoorOpen=!1,this.isUpStairDoorOpen=!1,this.keyData={worldPos:new n(-3.271,-1.344,8.185),isGot:!1,floorNumber:2},this.compassData=[{id:0,worldPos:new n(18.881,-.588,-6.663),isGot:!1,isSet:!1,floorNumber:2},{id:1,worldPos:new n(27.876,-.466,2.233),isGot:!1,isSet:!1,floorNumber:2},{id:2,worldPos:new n(-7.237,-1.348,13.335),isGot:!1,isSet:!1,floorNumber:2},{id:3,worldPos:new n(25.634,-.411,6.003),isGot:!1,isSet:!1,floorNumber:2},{id:4,worldPos:new n(17.939,-4.838,-3.945),isGot:!1,isSet:!1,floorNumber:1},{id:5,worldPos:new n(9.145,-3.927,-7.711),isGot:!1,isSet:!1,floorNumber:1}],this.fileData={worldPos:new n(-4.275,-.391,-5.533),isGot:!1,isSet:!1,floorNumber:2},this.liveNPCData=[{id:1,isDead:!1},{id:2,isDead:!1}]}setTargetPos(){if(!this.keyData.isGot)return this.currentTargetPos=this.keyData.worldPos,void(this.itemFloorNumber=this.keyData.floorNumber);for(let t=0;t<this.compassData.length;t++)if(!this.compassData[t].isSet&&!this.compassData[t].isGot)return this.currentTargetPos=this.compassData[t].worldPos,void(this.itemFloorNumber=this.compassData[t].floorNumber);if(!this.fileData.isGot)return this.currentTargetPos=this.fileData.worldPos,void(this.itemFloorNumber=this.fileData.floorNumber);this.currentTargetPos=null,this.itemFloorNumber=1}}).Instance=null,c=i((d=m).prototype,"pathWaypointsParent",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u=d))||u));o._RF.pop()}}}));

System.register("chunks:///_virtual/JJTW_GameUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIManager.ts","./GameManager.ts","./Banner.ts","./ProjectEventManager.ts","./JJTW_DataManager.ts","./JJTW_PlayerController.ts","./EventManager.ts","./JJTW_ScanSysem.ts"],(function(e){var t,i,n,a,s,l,o,h,c,r,p,d,g,u,T,m,b,C,y,P,S,I,f,v,B,k;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.initializerDefineProperty},function(e){n=e.cclegacy,a=e.Node,s=e.SpriteFrame,l=e._decorator,o=e.Component,h=e.Sprite,c=e.v3,r=e.clamp,p=e.UITransform,d=e.Vec3,g=e.instantiate,u=e.UIOpacity,T=e.tween,m=e.director},function(e){b=e.UIManager,C=e.Panel},function(e){y=e.GameManager},function(e){P=e.default},function(e){S=e.ProjectEventManager,I=e.ProjectEvent},function(e){f=e.JJTW_DataManager},function(e){v=e.JJTW_PlayerController},function(e){B=e.EventManager},function(e){k=e.JJTW_ScanSysem}],execute:function(){var w,E,A,D,J,_,x,N,W,R,z,O,U,M,F,L,j,G,H,K,V,Y,Q,Z,q,X,$,ee,te,ie,ne,ae,se,le,oe,he,ce,re,pe,de,ge,ue,Te,me,be,Ce,ye,Pe,Se,Ie;n._RF.push({},"fe909J/dPBDTrSgtDQD0n33","JJTW_GameUI",void 0);const{ccclass:fe,property:ve}=l;e("JJTW_GameUI",(w=fe("JJTW_GameUI"),E=ve(k),A=ve(a),D=ve(a),J=ve(a),_=ve(a),x=ve(a),N=ve(a),W=ve(a),R=ve(a),z=ve(a),O=ve(a),U=ve(a),M=ve(s),F=ve(a),L=ve(a),j=ve(a),G=ve(a),H=ve(a),K=ve(a),V=ve(a),Y=ve(a),Q=ve(a),Z=ve(a),w(((Ie=class e extends o{constructor(...e){super(...e),i(this,"scanSysem",$,this),i(this,"touchPanel",ee,this),i(this,"joyBase",te,this),i(this,"playerNode",ie,this),i(this,"btnScream",ne,this),i(this,"btnFlashlight",ae,this),i(this,"btnInteract",se,this),i(this,"btnScan",le,this),i(this,"AdPanel",oe,this),i(this,"btnWatchAd",he,this),i(this,"btnAdTipClose",ce,this),i(this,"bagPanel",re,this),i(this,"compassSps",pe,this),i(this,"keyDoorTipPanel",de,this),i(this,"toExitPanel",ge,this),i(this,"waitTipPanel",ue,this),i(this,"exitDoorTipPanel",Te,this),i(this,"beginningTipPanel",me,this),i(this,"btnBeginningTipClose",be,this),i(this,"npcContainer",Ce,this),i(this,"deadPanel",ye,this),i(this,"winPanel",Pe,this),i(this,"btnReturn",Se,this),this.beginningTipShowTime=1,this.lightTime=60,this.lightPassTime=0,this.scanTime=10,this.scanPassTime=0,this.pastPos=null}static get Instance(){return this.instance}onLoad(){e.instance=this,S.emit(I.游戏开始,"掘地求财方块版")}start(){this.hideAllTip(),this.beginningTipPanel.active=!0,this.btnFlashlight.getComponentInChildren(h).fillRange=0,this.btnScan.getComponentInChildren(h).node.active=!1,this.touchPanel.on(a.EventType.TOUCH_START,this.CameraTouchStart,this),this.touchPanel.on(a.EventType.TOUCH_MOVE,this.CameraTouchMove,this),this.joyBase.on(a.EventType.TOUCH_START,this.PlayerTouchStart,this),this.joyBase.on(a.EventType.TOUCH_MOVE,this.PlayerTouchMove,this),this.joyBase.on(a.EventType.TOUCH_END,this.PlayerTouchEnd,this),this.joyBase.on(a.EventType.TOUCH_CANCEL,this.PlayerTouchEnd,this),this.btnScream.on(a.EventType.TOUCH_START,this.ScreamTouchStart,this),this.btnScream.on(a.EventType.TOUCH_END,this.ScreamTouchEnd,this),this.btnScream.on(a.EventType.TOUCH_CANCEL,this.ScreamTouchEnd,this),this.btnFlashlight.on("click",this.onFlashlightClicked,this),this.btnInteract.on("click",this.onInteractClicked,this),this.btnScan.on("click",this.onScanClicked,this),this.winPanel.getChildByName("btnBack").on("click",this.onBtnBackClick,this),this.winPanel.getChildByName("btnReset").on("click",this.onBtnResetClick,this),this.deadPanel.getChildByName("btnBack").on("click",this.onBtnBackClick,this),this.deadPanel.getChildByName("btnReset").on("click",this.onBtnResetClick,this),this.btnReturn.on("click",this.onBtnReturnClick,this),this.deadPanel.active=!1,this.winPanel.active=!1,S.emit(I.弹出窗口,"尖叫逃亡")}update(e){f.Instance.isPlayerDead||(f.Instance.isStartToLightDownCount&&f.Instance.isLightCanOpen&&f.Instance.isFlashlight&&(this.lightPassTime+=e,this.btnFlashlight.getComponentInChildren(h).fillRange=this.lightPassTime/this.lightTime,this.lightPassTime>=this.lightTime&&(f.Instance.isFlashlight=!1,this.lightPassTime=0,f.Instance.isLightCanOpen=!1,this.btnFlashlight.getComponentInChildren(h).fillRange=1)),f.Instance.isScaning&&(this.btnScan.getComponentInChildren(h).node.active||(this.btnScan.getComponentInChildren(h).node.active=!0,this.btnScan.getComponentInChildren(h).fillRange=0),this.scanPassTime+=e,this.btnScan.getComponentInChildren(h).fillRange=-(this.scanTime-this.scanPassTime)/this.scanTime,this.scanPassTime>=this.scanTime&&(f.Instance.isScaning=!1,this.scanPassTime=0,this.btnScan.getComponentInChildren(h).fillRange=0,this.btnScan.getComponentInChildren(h).node.active=!1)))}CameraTouchStart(e){this.pastPos=e.getUILocation()}CameraTouchMove(e){if(!f.Instance.isPlayerDead){var t=e.getUILocation().subtract(this.pastPos).multiplyScalar(.1),i=c(this.playerNode.eulerAngles);i.add3f(-t.y,-t.x,0),i.x=r(i.x,-50,30),this.playerNode.setRotationFromEuler(i),this.pastPos=e.getUILocation()}}PlayerTouchStart(){f.Instance.isMove=!0,f.Instance.isGuidanding&&(0==f.Instance.currentStepIndex?B.Scene.emit("JJTW_JOYSTICK_Start"):2==f.Instance.currentStepIndex&&B.Scene.emit("JJTW_Scream_Start"))}PlayerTouchMove(e){var t=this.joyBase.children[0],i=e.getUILocation(),n=this.joyBase.getWorldPosition(),a=c(i.x-n.x,i.y-n.y,0),s=this.joyBase.getComponent(p).width/2;a.length()>s?(a=a.normalize().multiplyScalar(s),t.setPosition(a)):t.setWorldPosition(c(i.x,i.y)),f.Instance.delta=a}PlayerTouchEnd(){this.joyBase.children[0].setPosition(d.ZERO),f.Instance.isMove=!1,f.Instance.isGuidanding&&0==f.Instance.currentStepIndex&&B.Scene.emit("JJTW_JOYSTICK_End")}ScreamTouchStart(){f.Instance.isScream=!0,f.Instance.isGuidanding&&2==f.Instance.currentStepIndex&&B.Scene.emit("JJTW_Scream_Start")}ScreamTouchEnd(){f.Instance.isScream=!1}onFlashlightClicked(){f.Instance.isLightCanOpen?f.Instance.isFlashlight=!f.Instance.isFlashlight:this.showAdTip()}onInteractClicked(){v.Instance.interact()}onScanClicked(){f.Instance.isScaning?this.showWaitTip():(f.Instance.setTargetPos(),f.Instance.currentTargetPos?(this.scanSysem.showArrow(),f.Instance.isScaning=!0):this.showToExitPanel())}showAdTip(){this.hideAllTip(),this.AdPanel.active=!0,this.btnWatchAd.on("click",this.onWatchAdClicked,this),this.btnAdTipClose.on("click",this.hideAdTip,this)}hideAdTip(){this.AdPanel.active=!1,this.btnWatchAd.off("click",this.onWatchAdClicked,this),this.btnAdTipClose.off("click",this.hideAdTip,this)}onWatchAdClicked(){P.Instance.ShowVideoAd((()=>{f.Instance.isLightCanOpen=!0,f.Instance.isFlashlight=!0,this.hideAdTip()}))}updateBag(){f.Instance.fileData.isGot?this.bagPanel.getChildByName("fileBg").getChildByName("file").active=!0:this.bagPanel.getChildByName("fileBg").getChildByName("file").active=!1,f.Instance.keyData.isGot?this.bagPanel.getChildByName("items").getChildByName("key").active=!0:this.bagPanel.getChildByName("items").getChildByName("key").active=!1;let e=this.bagPanel.getChildByName("items").getChildByName("compass");e.children.forEach((t=>{e.children.length>1&&t.destroy()})),f.Instance.compassData.forEach((t=>{if(t.isGot&&!t.isSet){let i=g(e.children[0]);i.parent=e,i.active=!0,i.getComponentInChildren(h).spriteFrame=this.compassSps[t.id]}})),e.children[0].active=!1}updateNPCUI(){f.Instance.liveNPCData.forEach((e=>{let t=this.npcContainer.children[e.id];e.isDead?t.getChildByName("dead").active=!0:t.getChildByName("dead").active=!1}))}showKeyDoorTip(){this.hideAllTip(),this.keyDoorTipPanel.active=!0,this.unschedule(this.CloseKeyDoorTip),this.scheduleOnce(this.CloseKeyDoorTip,4)}CloseKeyDoorTip(){this.keyDoorTipPanel.active=!1}showExitDoorTip(){this.hideAllTip(),this.exitDoorTipPanel.active=!0,this.unschedule(this.CloseExitDoorTip),this.scheduleOnce(this.CloseExitDoorTip,4)}CloseExitDoorTip(){this.exitDoorTipPanel.active=!1}onBeginningTipCloseClicked(){this.beginningTipPanel.active=!1,this.btnBeginningTipClose.off("click",this.onBeginningTipCloseClicked,this)}showWinAnim(){let e=this.winPanel.getComponent(u);e.opacity=0,this.winPanel.active=!0,this.deadPanel.active=!1,T(e).to(1,{opacity:255}).call((()=>{S.emit(I.游戏结束,"尖叫逃亡")})).start()}showDeadAnim(){let e=this.deadPanel.getComponent(u);e.opacity=0,this.deadPanel.active=!0,this.winPanel.active=!1,T(e).to(1,{opacity:255}).call((()=>{S.emit(I.游戏结束,"尖叫逃亡")})).start()}onBtnBackClick(){this.deadPanel.getChildByName("btnBack").off("click",this.onBtnBackClick,this),this.winPanel.getChildByName("btnBack").off("click",this.onBtnBackClick,this),S.emit(I.返回主页按钮事件,(()=>{b.ShowPanel(C.LoadingPanel,y.StartScene,(()=>{S.emit(I.返回主页,"尖叫逃亡")}))}))}onBtnResetClick(){this.deadPanel.getChildByName("btnReset").off("click",this.onBtnResetClick,this),this.winPanel.getChildByName("btnReset").off("click",this.onBtnResetClick,this),m.loadScene("JJTW_GameScene")}showToExitPanel(){this.hideAllTip(),this.toExitPanel.active=!0,this.unschedule(this.CloseToExitTip),this.scheduleOnce(this.CloseToExitTip,3)}CloseToExitTip(){this.toExitPanel.active=!1}showWaitTip(){this.hideAllTip(),this.waitTipPanel.active=!0,this.unschedule(this.closeWaitTip),this.scheduleOnce(this.closeWaitTip,2)}closeWaitTip(){this.waitTipPanel.active=!1}onBtnReturnClick(){S.emit(I.返回主页按钮事件,(()=>{b.ShowPanel(C.LoadingPanel,y.StartScene,(()=>{S.emit(I.返回主页,"尖叫逃亡")}))}))}hideAllTip(){this.AdPanel.active=!1,this.keyDoorTipPanel.active=!1,this.toExitPanel.active=!1,this.waitTipPanel.active=!1,this.exitDoorTipPanel.active=!1,this.beginningTipPanel.active=!1}}).instance=void 0,$=t((X=Ie).prototype,"scanSysem",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ee=t(X.prototype,"touchPanel",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),te=t(X.prototype,"joyBase",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ie=t(X.prototype,"playerNode",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ne=t(X.prototype,"btnScream",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ae=t(X.prototype,"btnFlashlight",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),se=t(X.prototype,"btnInteract",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),le=t(X.prototype,"btnScan",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oe=t(X.prototype,"AdPanel",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),he=t(X.prototype,"btnWatchAd",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ce=t(X.prototype,"btnAdTipClose",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),re=t(X.prototype,"bagPanel",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pe=t(X.prototype,"compassSps",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),de=t(X.prototype,"keyDoorTipPanel",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ge=t(X.prototype,"toExitPanel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ue=t(X.prototype,"waitTipPanel",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Te=t(X.prototype,"exitDoorTipPanel",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),me=t(X.prototype,"beginningTipPanel",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),be=t(X.prototype,"btnBeginningTipClose",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ce=t(X.prototype,"npcContainer",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ye=t(X.prototype,"deadPanel",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pe=t(X.prototype,"winPanel",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Se=t(X.prototype,"btnReturn",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q=X))||q));n._RF.pop()}}}));

System.register("chunks:///_virtual/JJTW_GuidanceManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./JJTW_DataManager.ts","./EventManager.ts"],(function(t){var e,i,n,r,s,o,a,h,c,u,T;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){n=t.cclegacy,r=t.Node,s=t._decorator,o=t.Component,a=t.Label,h=t.UIOpacity,c=t.Tween},function(t){u=t.JJTW_DataManager},function(t){T=t.EventManager}],execute:function(){var d,l,p,S,g,N,C,y,m,O,f,I,E,_,M,k,v;n._RF.push({},"a1f17YjFYZGUaHSD95OriMG","JJTW_GuidanceManager",void 0);const{ccclass:J,property:x}=s;let L=t("JJTW_GuidanceStepType",function(t){return t[t.INTRODUCTION=0]="INTRODUCTION",t[t.JOYSTICK=1]="JOYSTICK",t[t.CAMERA_ROTATE=2]="CAMERA_ROTATE",t[t.PATHFIND_BUTTON=3]="PATHFIND_BUTTON",t[t.BUTTON_SCREAM=4]="BUTTON_SCREAM",t[t.BUTTON_INTERACT=5]="BUTTON_INTERACT",t[t.BUTTON_FLASHLIGHT=6]="BUTTON_FLASHLIGHT",t}({}));t("JJTW_GuidanceManager",(d=J("JJTW_GuidanceManager"),l=x(r),p=x(r),S=x(r),g=x(r),N=x(r),C=x(r),y=x([r]),d((f=e((O=class extends o{constructor(...t){super(...t),i(this,"modulesLayer",f,this),i(this,"maskLayer",I,this),i(this,"operateLayer",E,this),i(this,"tipPanel",_,this),i(this,"skipButton",M,this),i(this,"tipLabel",k,this),i(this,"allModules",v,this),this.currentStepIndex=0,this.currentTargetNode=null,this.isOperating=!1,this.otherModules=[],this.isHighSpeedMove=!1,this.lightClickCount=0,this.introductionSteps=[{type:L.INTRODUCTION,targetNodeName:"",tipText:"欢迎来到医院，点击屏幕继续"},{type:L.INTRODUCTION,targetNodeName:"",tipText:"这是一个恐怖逃脱游戏，你需要探索医院，在躲避怪物的同时，找到六个罗盘才能打开身后的大门逃脱"},{type:L.INTRODUCTION,targetNodeName:"",tipText:"医院里有一份极为重要的机密文件，找到文件并将文件带出来！"},{type:L.INTRODUCTION,targetNodeName:"",tipText:"有些门需要钥匙才能打开，合理使用强力扫描技能，它会带你寻找需要的物品"},{type:L.INTRODUCTION,targetNodeName:"",tipText:"小心躲避医院里的怪物，打开困住它们的门后，它们可自由移动，小心别被抓到！"},{type:L.INTRODUCTION,targetNodeName:"",tipText:"现在开始操作引导！"}],this.guidanceSteps=[{type:L.JOYSTICK,targetNodeName:"joystick",tipText:"摇杆：长按并滑动中央的白色圆形块，可控制角色前后左右移动"},{type:L.CAMERA_ROTATE,targetNodeName:"cameraRotateArea",tipText:"视角：在屏幕右半部分长按并滑动，可控制视角",hasDemoAnimation:!0},{type:L.BUTTON_SCREAM,targetNodeName:"btnScream",tipText:"尖叫：长按此按钮，可使移动速度提升",otherMudule:["joystick"]},{type:L.BUTTON_INTERACT,targetNodeName:"btnInteract",tipText:"交互：点击此按钮可与道具、门交互"},{type:L.BUTTON_FLASHLIGHT,targetNodeName:"btnFlashLight",tipText:"手电筒：点击可开关手电筒，手电筒的电池会不断耗电，电量归零后可看视频充电"},{type:L.PATHFIND_BUTTON,targetNodeName:"btnScan",tipText:"强力扫描：点击后，会强力扫描全医院，创建一条维持10秒的指引路线"}],this.endSteps=[{type:L.INTRODUCTION,targetNodeName:"",tipText:"恭喜你完成了新手引导，点击屏幕开始游戏"}]}onLoad(){this.skipButton.on(r.EventType.TOUCH_END,this.onSkipGuidance,this)}update(t){u.Instance.isGuidanding&&2==this.currentStepIndex&&u.Instance.isMove&&u.Instance.isScream&&(this.isHighSpeedMove=!0),this.isHighSpeedMove&&2==this.currentStepIndex&&(u.Instance.isMove||u.Instance.isScream||this.onbtnScreamEnd())}start(){this.startGuidance()}startGuidance(){u.Instance.isGuidanding=!0,this.currentStepIndex=0,this.introductionSteps.length>0?(this.maskLayer.on(r.EventType.TOUCH_END,this.onIntroductionClick,this),this.showIntroduction()):this.showCurrentStep()}onIntroductionClick(){this.currentStepIndex++,this.currentStepIndex>=this.introductionSteps.length?(this.maskLayer.off(r.EventType.TOUCH_END,this.onIntroductionClick,this),this.currentStepIndex=0,this.showCurrentStep()):this.showIntroduction()}showFinishIntroduction(){const t=this.endSteps[0];this.tipLabel.getComponent(a).string=t.tipText,this.maskLayer.active=!0,this.tipPanel.active=!0,this.maskLayer.on(r.EventType.TOUCH_END,this.onFinishIntroductionClick,this),this.allModules.forEach((t=>{t.active=!1}))}onFinishIntroductionClick(){this.finishGuidance()}showIntroduction(){const t=this.introductionSteps[this.currentStepIndex];this.tipLabel.getComponent(a).string=t.tipText,this.maskLayer.active=!0,this.tipPanel.active=!0,this.allModules.forEach((t=>{t.active=!1}))}showCurrentStep(){if(this.currentStepIndex>=this.guidanceSteps.length)return void this.showFinishIntroduction();const t=this.guidanceSteps[this.currentStepIndex];this.currentTargetNode=this.modulesLayer.getChildByName(t.targetNodeName),this.currentTargetNode?(this.tipLabel.getComponent(a).string=t.tipText,this.maskLayer.active=!0,this.updateMaskHole(),this.showAllModules(),this.addCurrentModuleListener(t.type),t.hasDemoAnimation&&this.playDemoAnimation(t.type)):this.nextStep()}updateMaskHole(){let t=this.currentTargetNode.worldPosition;this.currentTargetNode.setParent(this.operateLayer),this.currentTargetNode.setWorldPosition(t);const e=this.guidanceSteps[this.currentStepIndex];if(e.otherMudule&&e.otherMudule.length>0){this.otherModules=[];for(let t=0;t<e.otherMudule.length;t++){let i=this.modulesLayer.getChildByName(e.otherMudule[t]),n=i.worldPosition;i.setParent(this.operateLayer),i.setWorldPosition(n),this.otherModules.push(i)}}}showOnlyCurrentModule(){this.allModules.forEach((t=>{t.active=t.name===this.currentTargetNode.name;const e=this.guidanceSteps[this.currentStepIndex];e.otherMudule&&e.otherMudule.length>0&&e.otherMudule.indexOf(t.name)>-1&&(t.active=!0)})),this.tipPanel.active=!0}showAllModules(){this.allModules.forEach((t=>{t.active=!0})),this.tipPanel.active=!0}addCurrentModuleListener(t){switch(this.removeCurrentModuleListener(),t){case L.JOYSTICK:T.on("JJTW_JOYSTICK_Start",this.onJoystickStart,this),T.on("JJTW_JOYSTICK_End",this.onJoystickEnd,this);break;case L.CAMERA_ROTATE:this.currentTargetNode.children[0].active=!0;this.currentTargetNode.children[0].getComponent(h);this.currentTargetNode.on(r.EventType.TOUCH_START,this.onCameraTouchStart,this),this.currentTargetNode.on(r.EventType.TOUCH_END,this.onCameraTouchEnd,this),this.currentTargetNode.on(r.EventType.TOUCH_CANCEL,this.onCameraTouchEnd,this);break;case L.BUTTON_SCREAM:T.on("JJTW_Scream_Start",this.onbtnScreamStart,this);case L.BUTTON_SCREAM:u.Instance.isStartToLightDownCount=!0,this.currentTargetNode.on(r.EventType.TOUCH_END,this.onButtonClick,this);default:this.currentTargetNode.on(r.EventType.TOUCH_END,this.onButtonClick,this)}}removeCurrentModuleListener(){if(!this.currentTargetNode)return;switch(this.guidanceSteps[this.currentStepIndex].type){case L.JOYSTICK:break;case L.CAMERA_ROTATE:this.currentTargetNode.off(r.EventType.TOUCH_START,this.onCameraTouchStart,this),this.currentTargetNode.off(r.EventType.TOUCH_END,this.onCameraTouchEnd,this),this.currentTargetNode.off(r.EventType.TOUCH_CANCEL,this.onCameraTouchEnd,this);break;default:this.currentTargetNode.off(r.EventType.TOUCH_END,this.onButtonClick,this)}}onJoystickStart(){T.off("JJTW_JOYSTICK_Start",this.onJoystickStart,this),this.enterOperatingState()}onJoystickMove(){}onJoystickEnd(){T.off("JJTW_JOYSTICK_End",this.onJoystickEnd,this),this.exitOperatingState(),this.nextStep()}onCameraTouchStart(){const t=this.currentTargetNode.children[0].getComponent(h);c.stopAllByTarget(t),this.currentTargetNode.children[0].active=!1,this.enterOperatingState()}onCameraTouchEnd(){this.exitOperatingState(),this.nextStep()}onbtnScreamStart(){T.off("JJTW_Scream_Start",this.onbtnScreamStart,this),this.enterOperatingState()}onbtnScreamEnd(){this.exitOperatingState(),this.nextStep()}onButtonClick(){this.enterOperatingState(),this.guidanceSteps[this.currentStepIndex].type===L.PATHFIND_BUTTON?(this.currentTargetNode.off(r.EventType.TOUCH_END,this.onButtonClick,this),setTimeout((()=>{this.exitOperatingState(),this.nextStep()}),2e3)):this.guidanceSteps[this.currentStepIndex].type===L.BUTTON_FLASHLIGHT?(this.lightClickCount++,2==this.lightClickCount&&(this.currentTargetNode.off(r.EventType.TOUCH_END,this.onButtonClick,this),this.exitOperatingState(),this.nextStep())):(this.exitOperatingState(),this.nextStep())}enterOperatingState(){this.isOperating||(this.isOperating=!0,this.maskLayer.active=!1,this.showOnlyCurrentModule())}exitOperatingState(){if(!this.isOperating)return;this.isOperating=!1;let t=this.currentTargetNode.worldPosition;if(this.currentTargetNode.setParent(this.modulesLayer),this.currentTargetNode.setWorldPosition(t),"cameraRotateArea"==this.currentTargetNode.name&&this.currentTargetNode.setSiblingIndex(0),this.otherModules.length>0){for(let t=0;t<this.otherModules.length;t++){let e=this.otherModules[t],i=e.worldPosition;e.setParent(this.modulesLayer),e.setWorldPosition(i),"cameraRotateArea"==e.name&&e.setSiblingIndex(0)}this.otherModules=[]}}playDemoAnimation(t){}nextStep(){this.removeCurrentModuleListener(),this.currentStepIndex++,u.Instance.currentStepIndex=this.currentStepIndex,this.showCurrentStep()}onSkipGuidance(){this.removeCurrentModuleListener(),this.currentStepIndex=this.guidanceSteps.length,u.Instance.currentStepIndex=this.guidanceSteps.length,this.maskLayer.off(r.EventType.TOUCH_END,this.onIntroductionClick,this),T.off("JJTW_JOYSTICK_Start",this.onJoystickStart,this),T.off("JJTW_JOYSTICK_End",this.onJoystickEnd,this),T.off("JJTW_Scream_Start",this.onbtnScreamStart,this),u.Instance.isStartToLightDownCount=!0,this.allModules.forEach((t=>{let e=t.worldPosition;t.setParent(this.modulesLayer),t.setWorldPosition(e),"cameraRotateArea"==t.name&&(t.setSiblingIndex(0),t.children[0].active=!1)})),this.finishGuidance()}finishGuidance(){this.maskLayer.off(r.EventType.TOUCH_END,this.onFinishIntroductionClick,this),this.maskLayer.active=!1,this.showAllModules(),this.tipPanel.active=!1,u.Instance.isGameStart=!0}onDestroy(){this.skipButton.off(r.EventType.TOUCH_END,this.onSkipGuidance,this),this.removeAllModuleListener()}removeAllModuleListener(){this.skipButton.off(r.EventType.TOUCH_END,this.onSkipGuidance,this),this.maskLayer.off(r.EventType.TOUCH_END,this.onIntroductionClick,this),this.maskLayer.off(r.EventType.TOUCH_END,this.onFinishIntroductionClick,this),T.off("JJTW_JOYSTICK_Start",this.onJoystickStart,this),T.off("JJTW_JOYSTICK_End",this.onJoystickEnd,this),T.off("JJTW_Scream_Start",this.onbtnScreamStart,this),this.allModules.forEach((t=>{t.off(r.EventType.TOUCH_START,this.onCameraTouchStart,this),t.off(r.EventType.TOUCH_END,this.onCameraTouchEnd,this),t.off(r.EventType.TOUCH_CANCEL,this.onCameraTouchEnd,this),t.off(r.EventType.TOUCH_END,this.onButtonClick,this)}))}}).prototype,"modulesLayer",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(O.prototype,"maskLayer",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(O.prototype,"operateLayer",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(O.prototype,"tipPanel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(O.prototype,"skipButton",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=e(O.prototype,"tipLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(O.prototype,"allModules",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),m=O))||m));n._RF.pop()}}}));

System.register("chunks:///_virtual/JJTW_MonsterAI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./JJTW_ScanSysem.ts","./JJTW_ColliderGroupNumber.ts","./JJTW_DataManager.ts","./JJTW_GameUI.ts","./JJTW_PlayerController.ts"],(function(t){var e,i,o,s,n,a,r,l,h,d,c,P,u,p,m,y,g,S,w;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){o=t.cclegacy,s=t.Collider,n=t.AudioClip,a=t._decorator,r=t.Component,l=t.v3,h=t.SkeletalAnimation,d=t.RigidBody,c=t.Vec3,P=t.tween,u=t.AudioSource},function(t){p=t.JJTW_ScanSysem},function(t){m=t.JJTW_ColliderGroupNumber,y=t.JJTW_ColliderGroupType},function(t){g=t.JJTW_DataManager},function(t){S=t.JJTW_GameUI},function(t){w=t.JJTW_PlayerController}],execute:function(){var f,T,C,b,W,D,_,v,J,k,A,F,I,E,H,N,M;o._RF.push({},"ed6c4td2WdPm68/W4V6RAMX","JJTW_MonsterAI",void 0);const{ccclass:R,property:x}=a;var z=function(t){return t.IDLE="idle",t.WANDER="wander",t.CHASE="chase",t.PATHFIND="pathfind",t}(z||{});t("JJTW_MonsterAI",(f=R("JJTW_MonsterAI"),T=x(S),C=x({type:p,tooltip:"扫描系统实例"}),b=x({type:Number,tooltip:"移动速度"}),W=x({type:Number,tooltip:"路径点到达阈值"}),D=x({type:s,tooltip:"小碰撞器（检测障碍物/玩家接触）"}),_=x({type:s,tooltip:"大碰撞器（检测玩家范围）"}),v=x({type:n}),f((A=e((k=class extends r{constructor(...t){super(...t),i(this,"GameUI",A,this),i(this,"scanSystem",F,this),i(this,"moveSpeed",I,this),i(this,"arrivedThreshold",E,this),i(this,"smallCollider",H,this),i(this,"largeCollider",N,this),i(this,"clip",M,this),this.anim=void 0,this.rigidbody=null,this.wanderWaitTime=3,this.currentState=z.IDLE,this.targetPlayer=null,this.wanderWaitTimer=0,this.stuckTimer=0,this.lastPosition=l(),this.pathFollow={currentPointIndex:0,pathPoints:[],arrivedThreshold:.3},this.isHitPeople=!1,this.isHaveTarget=!1,this.wanderedPoses=[]}start(){this.anim=this.node.getComponent(h),this.rigidbody=this.node.getComponent(d),this.initColliders(),this.switchState(z.WANDER),this.schedule(this.changeState,3)}changeState(){this.isHaveTarget?this.switchState(z.CHASE):this.switchState(z.WANDER)}initColliders(){this.largeCollider.on("onTriggerEnter",this.onPlayerDetected,this),this.largeCollider.on("onTriggerExit",this.onPlayerLost,this),this.smallCollider.on("onCollisionEnter",this.onSmallColliderContact,this)}switchState(t){switch(this.currentState=t,t){case z.WANDER:this.setWanderPath();break;case z.CHASE:this.setChasePath();break;case z.PATHFIND:}}update(t){if(g.Instance.isGameStart&&!this.isHitPeople)switch(this.checkStuck(t),this.currentState){case z.WANDER:this.updateWanderPath(t);break;case z.CHASE:this.updateChasePath(t);break;case z.PATHFIND:}}checkStuck(t){const e=this.node.worldPosition;c.distance(e,this.lastPosition)<.2?(this.stuckTimer+=t,this.stuckTimer>=3.5&&(this.stuckTimer=0,this.resetTracking(),this.switchState(z.WANDER))):(this.stuckTimer=0,this.lastPosition=e.clone())}resetTracking(){this.pathFollow.pathPoints=[],this.largeCollider.enabled=!0}onPlayerDetected(t){var e;if(null==(e=t.otherCollider.node.getComponent(m))?void 0:e.groupType){var i,o;let e=(null==(i=t.otherCollider.node.getComponent(m))?void 0:i.groupType)==y.Player_Collider,s=(null==(o=t.otherCollider.node.getComponent(m))?void 0:o.groupType)==y.NPC_Collider;(e||s)&&(this.targetPlayer=t.otherCollider.node,this.isHaveTarget=!0)}}onPlayerLost(t){this.targetPlayer&&t.otherCollider.node===this.targetPlayer&&this.currentState===z.CHASE&&(this.isHaveTarget=!1)}onSmallColliderContact(t){const e=[y.Wall,y.Barrier],i=[y.Wall,y.Barrier,y.Door_1,y.Door_2,y.Door_3,y.Door_4,y.Door_5,y.Door_6,y.Door_Normal,y.Door_Exit,y.Door_Stair_1,y.Door_Stair_2],o=t.otherCollider.node.getComponent(m);if(o)if(o.groupType==y.Player_Collider){let e=t.otherCollider.node.getComponent(w);P(this.node).call((()=>{this.isHitPeople=!0,this.getComponent(u).playOneShot(this.clip,.5);const t=this.anim.getState("end");null!=t&&t.isPlaying||this.anim.crossFade("end",.2),null==e||e.setPlayerDead()})).delay(2).call((()=>{this.isHitPeople=!1,this.resetTracking(),this.switchState(z.WANDER)})).start()}else if(e.includes(o.groupType)){const t=this.anim.getState("idle");null!=t&&t.isPlaying||this.anim.crossFade("idle",.2)}else if(i.includes(o.groupType)){const t=this.anim.getState("idle");return null!=t&&t.isPlaying||this.anim.crossFade("idle",.2),this.resetTracking(),void this.switchState(z.WANDER)}}setWanderPath(){let t=[];for(let e=0;e<this.scanSystem.roadPoints.length&&!(t.length>=4);e++){let i=this.scanSystem.roadPoints[e];c.distance(this.node.worldPosition,i)<.5||this.scanSystem.checkObstacle(this.node.worldPosition,i,!1)||t.push(i)}let e=1e9,i=t[0];for(let o=0;o<t.length;o++){let s=t[o];if(!this.scanSystem.isSameLayer(this.node.worldPosition,s)&&!g.Instance.isUpStairDoorOpen&&!g.Instance.isDownStairDoorOpen)continue;if(-1!=this.wanderedPoses.indexOf(s))continue;let n=c.distance(this.node.worldPosition,s);n<e&&(e=n,i=s)}if(i){let t=[i];c.distance(this.node.worldPosition,this.scanSystem.topPoint)<.2&&t.push(this.scanSystem.bottomPoint),c.distance(this.node.worldPosition,this.scanSystem.bottomPoint)<.2&&t.push(this.scanSystem.topPoint);let e=t[Math.floor(Math.random()*t.length)];if(e==this.scanSystem.bottomPoint&&!this.scanSystem.isSameLayer(this.node.worldPosition,e)){let t=[this.node.worldPosition,this.scanSystem.middlePoint,this.scanSystem.bottomPoint];return void this.setPath(t)}if(e==this.scanSystem.topPoint&&!this.scanSystem.isSameLayer(this.node.worldPosition,e)){let t=[this.node.worldPosition,this.scanSystem.middlePoint,this.scanSystem.topPoint];return void this.setPath(t)}this.wanderedPoses.push(i),this.wanderedPoses.length>3&&this.wanderedPoses.shift();let o=[this.node.worldPosition,i];this.setPath(o)}else{let e=[this.node.worldPosition,t[Math.floor(Math.random()*t.length)]];this.setPath(e)}}setChasePath(){if(!this.scanSystem.checkObstacle(this.node.worldPosition,this.targetPlayer.worldPosition,!1)){let t=[this.node.worldPosition,this.targetPlayer.worldPosition];return void this.setPath(t)}let t=[];for(let e=0;e<this.scanSystem.roadPoints.length;e++){let i=this.scanSystem.roadPoints[e];this.scanSystem.isSameLayer(this.node.worldPosition,i)&&(this.scanSystem.checkObstacle(this.node.worldPosition,i,!1)||t.push(i))}c.distance(this.node.worldPosition,this.scanSystem.topPoint)<.2&&t.push(this.scanSystem.bottomPoint),c.distance(this.node.worldPosition,this.scanSystem.bottomPoint)<.2&&t.push(this.scanSystem.topPoint);let e=1e5,i=t[0];if(t.forEach(((t,o)=>{let s=c.distance(this.targetPlayer.worldPosition,t);s<e&&(e=s,i=t)})),i){let t=[this.node.worldPosition,i];this.setPath(t)}else{let e=[this.node.worldPosition,t[Math.floor(Math.random()*t.length)]];this.setPath(e)}}updateWanderPath(t){if(this.pathFollow.pathPoints.length>0)return void this.followPath(t);this.wanderWaitTimer+=t;const e=this.anim.getState("idle");null!=e&&e.isPlaying||this.anim.crossFade("idle",.2),this.wanderWaitTimer>=this.wanderWaitTime&&(this.wanderWaitTimer=0,this.setWanderPath())}updateChasePath(t){this.pathFollow.pathPoints.length>0?this.followPath(t):this.setChasePath()}setPath(t){this.pathFollow.pathPoints=t,this.pathFollow.currentPointIndex=0}followPath(t){if(this.pathFollow.currentPointIndex>=this.pathFollow.pathPoints.length)return void(this.pathFollow.pathPoints=[]);if(!this.isHitPeople){const t=this.anim.getState("walk");null!=t&&t.isPlaying||this.anim.crossFade("walk",.2)}const e=this.pathFollow.pathPoints[this.pathFollow.currentPointIndex];this.moveToTarget(e,t),c.distance(this.node.worldPosition,e)<=this.arrivedThreshold&&this.pathFollow.currentPointIndex++}moveToTarget(t,e){const i=t.clone().subtract(this.node.worldPosition).normalize(),o=i.multiplyScalar(this.moveSpeed);if(this.rigidbody){this.rigidbody.setLinearVelocity(o);const t=180*Math.atan2(i.x,i.z)/Math.PI;this.node.setRotationFromEuler(0,t,0)}else{const t=i.multiplyScalar(this.moveSpeed*e);this.node.worldPosition=this.node.worldPosition.clone().add(t)}}}).prototype,"GameUI",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F=e(k.prototype,"scanSystem",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(k.prototype,"moveSpeed",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),E=e(k.prototype,"arrivedThreshold",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),H=e(k.prototype,"smallCollider",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(k.prototype,"largeCollider",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(k.prototype,"clip",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=k))||J));o._RF.pop()}}}));

System.register("chunks:///_virtual/JJTW_NPCAICtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./JJTW_ScanSysem.ts","./JJTW_ColliderGroupNumber.ts","./JJTW_DataManager.ts","./JJTW_GameUI.ts"],(function(t){var i,e,s,o,n,a,r,h,l,d,c,P,u,m,g,p;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.initializerDefineProperty},function(t){s=t.cclegacy,o=t.Collider,n=t.Node,a=t._decorator,r=t.Component,h=t.v3,l=t.SkeletalAnimation,d=t.RigidBody,c=t.Vec3},function(t){P=t.JJTW_ScanSysem},function(t){u=t.JJTW_ColliderGroupNumber,m=t.JJTW_ColliderGroupType},function(t){g=t.JJTW_DataManager},function(t){p=t.JJTW_GameUI}],execute:function(){var y,w,S,f,T,C,b,W,D,v,F,M,N,_,R,A,J,E,I;s._RF.push({},"e2ba6isYiNPD4Hewju2P+ub","JJTW_NPCAICtrl",void 0);const{ccclass:k,property:G}=a;var x=function(t){return t.IDLE="idle",t.WANDER="wander",t.CHASE="chase",t.PATHFIND="pathfind",t}(x||{});t("JJTW_NPCAICtrl",(y=k("JJTW_NPCAICtrl"),w=G(p),S=G({type:P,tooltip:"扫描系统实例"}),f=G({type:Number,tooltip:"移动速度"}),T=G({type:Number,tooltip:"路径点到达阈值"}),C=G({type:o,tooltip:"小碰撞器（检测障碍物/玩家接触）"}),b=G({type:o,tooltip:"大碰撞器（检测玩家范围）"}),W=G({type:n}),D=G({type:n}),y((M=i((F=class extends r{constructor(...t){super(...t),e(this,"GameUI",M,this),e(this,"scanSystem",N,this),e(this,"moveSpeed",_,this),this.speed=0,e(this,"arrivedThreshold",R,this),e(this,"smallCollider",A,this),e(this,"largeCollider",J,this),e(this,"player",E,this),e(this,"NpcNodes",I,this),this.distanceRange=8,this.anim=void 0,this.rigidbody=null,this.wanderWaitTime=3,this.time=0,this.currentState=x.IDLE,this.targetMonster=null,this.lastPlayerPos=null,this.isSameLayerWithPlayer=!1,this.wanderTargetPoint=null,this.wanderWaitTimer=0,this.isObstacleHit=!1,this.isHitDoor=!1,this.stuckTimer=0,this.lastPosition=h(),this.pathFollow={currentPointIndex:0,pathPoints:[],arrivedThreshold:.3},this.isDead=!1,this.isGeneratingWanderPath=!1,this.wanderTryCount=0,this.maxWanderTryCount=10,this.canGoPoses=[],this.isRuning=!1,this.isHaveTarget=!1,this.xunlu=!1}update(t){if(g.Instance.isGameStart&&!this.isDead)switch(this.checkStuck(t),this.currentState){case x.WANDER:this.speed=this.moveSpeed,this.updateWanderPath(t);break;case x.CHASE:this.speed=3*this.moveSpeed,this.updateRunPath(t);break;case x.PATHFIND:this.speed=3*this.moveSpeed}}setNPCDead(){this.isDead=!0,this.rigidbody.enabled=!1,this.anim.crossFade("dead",.5),this.largeCollider.off("onTriggerEnter",this.onPlayerDetected,this),this.largeCollider.off("onTriggerExit",this.onPlayerLost,this),this.getComponent(u).destroy(),this.smallCollider.off("onCollisionEnter",this.onSmallColliderContact,this)}start(){this.anim=this.node.getComponent(l),this.rigidbody=this.node.getComponent(d),this.initColliders(),this.switchState(x.WANDER),this.schedule(this.changeState,3)}changeState(){this.isHaveTarget?this.switchState(x.CHASE):this.switchState(x.WANDER)}initColliders(){this.largeCollider.on("onTriggerEnter",this.onPlayerDetected,this),this.largeCollider.on("onTriggerExit",this.onPlayerLost,this),this.smallCollider.on("onCollisionEnter",this.onSmallColliderContact,this)}switchState(t){switch(this.currentState=t,t){case x.WANDER:this.setWanderPath();break;case x.CHASE:this.setRunPath();break;case x.PATHFIND:}}checkStuck(t){const i=this.node.worldPosition;c.distance(i,this.lastPosition)<.2?(this.stuckTimer+=t,this.stuckTimer>=4&&(this.stuckTimer=0,this.resetTracking(),this.switchState(x.WANDER))):(this.stuckTimer=0,this.lastPosition=i.clone())}resetTracking(){this.targetMonster=null,this.lastPlayerPos=null,this.pathFollow.pathPoints=[],this.largeCollider.enabled=!0}startWander(){this.isGeneratingWanderPath=!0,this.wanderTryCount=0,this.maxWanderTryCount=20,this.tryGenerateWanderPath()}tryGenerateWanderPath(){if(!this.xunlu){if(this.xunlu=!0,this.wanderTryCount>=this.maxWanderTryCount)return this.isGeneratingWanderPath=!1,void this.scheduleOnce((()=>{this.xunlu=!1}),5*Math.random());if(this.wanderTryCount++,this.wanderTargetPoint=this.getRandomRoadPoint(),this.wanderTargetPoint){const t=this.scanSystem.generatePath(this.node.worldPosition,this.wanderTargetPoint,!1,!1);if(t&&t.length>0)return this.node.setWorldPosition(t[0].position),this.setPath(t.map((t=>t.position))),this.isGeneratingWanderPath=!1,this.canGoPoses.push(this.wanderTargetPoint),void this.scheduleOnce((()=>{this.xunlu=!1}),5*Math.random())}if(this.canGoPoses.length>0){this.wanderTargetPoint=this.canGoPoses[Math.floor(Math.random()*this.canGoPoses.length)];const t=this.scanSystem.generatePath(this.node.worldPosition,this.wanderTargetPoint,!1,!1);if(t&&t.length>0)return this.node.setWorldPosition(t[0].position),this.setPath(t.map((t=>t.position))),this.isGeneratingWanderPath=!1,this.canGoPoses.push(this.wanderTargetPoint),void this.scheduleOnce((()=>{this.xunlu=!1}),5*Math.random())}this.scheduleOnce((()=>{this.xunlu=!1}),5*Math.random())}}getRandomRoadPoint(){const t=this.scanSystem.roadPoints;if(0===t.length)return null;let i=t.filter((t=>c.distance(this.node.worldPosition,t)>5*this.arrivedThreshold));if(!g.Instance.isDownStairDoorOpen&&!g.Instance.isUpStairDoorOpen){let t=this.scanSystem.getFloorByPos(this.node.worldPosition);i=i.filter((i=>this.scanSystem.isSameLayerWithTargetLayer(i,t)))}return i.length>0?i[Math.floor(Math.random()*i.length)]:t[Math.floor(Math.random()*t.length)]}getRandomRoadPointByFloor(t){const i=this.scanSystem.roadPointsByLayer[t];if(0===i.length)return null;const e=i.filter((t=>c.distance(this.node.worldPosition,t)>5*this.arrivedThreshold));return e.length>0?e[Math.floor(Math.random()*e.length)]:i[Math.floor(Math.random()*i.length)]}getFarPointAwayFromMonster(t,i){const e=this.scanSystem.roadPointsByLayer[t];if(0===e.length)return null;const s=i.clone().subtract(this.node.worldPosition).normalize(),o=e.filter((t=>{const e=t.clone().subtract(this.node.worldPosition).normalize(),o=c.dot(s,e)<0,n=c.distance(t,i),a=c.distance(this.node.worldPosition,i);return o&&n>a}));return o.length>0?o.reduce(((t,e)=>c.distance(e,i)>c.distance(t,i)?e:t),o[0]):e.reduce(((t,e)=>c.distance(e,i)>c.distance(t,i)?e:t),e[0])}getStairPointByCurrebtPos(){let t=this.scanSystem.getFloorByPos(this.node.worldPosition);return 1==t?this.scanSystem.bottomPoint:2==t?this.scanSystem.topPoint:void 0}updateWander(t){if(this.isGeneratingWanderPath)return;if(this.pathFollow.pathPoints.length>0)return void this.followPath(t);this.wanderWaitTimer+=t;const i=this.anim.getState("idle");null!=i&&i.isPlaying||this.anim.crossFade("idle",.2),this.wanderWaitTimer>=this.wanderWaitTime&&(this.wanderWaitTimer=0,this.startWander())}onPlayerDetected(t){var i;if((null==(i=t.otherCollider.node.getComponent(u))?void 0:i.groupType)&&!this.targetMonster){var e;(null==(e=t.otherCollider.node.getComponent(u))?void 0:e.groupType)==m.Monster_Collider&&(this.targetMonster=t.otherCollider.node,this.isHaveTarget=!0)}}onPlayerLost(t){this.targetMonster&&t.otherCollider.node===this.targetMonster&&this.currentState===x.CHASE&&(this.isHaveTarget=!1)}onSmallColliderContact(t){const i=[m.Wall,m.Barrier],e=[m.Wall,m.Barrier,m.Door_1,m.Door_2,m.Door_3,m.Door_4,m.Door_5,m.Door_6,m.Door_Exit,m.Door_Stair_1,m.Door_Stair_2],s=[m.Door_Normal],o=t.otherCollider.node.getComponent(u);if(o)if(o.groupType==m.Monster_Collider);else if(i.includes(o.groupType)){const t=this.anim.getState("idle");null!=t&&t.isPlaying||this.anim.crossFade("idle",.2),this.isObstacleHit=!0}else{if(e.includes(o.groupType)){const t=this.anim.getState("idle");return null!=t&&t.isPlaying||this.anim.crossFade("idle",.2),this.isHitDoor=!0,this.isHitDoor=!1,this.resetTracking(),void this.switchState(x.WANDER)}if(s.includes(o.groupType)){const i=this.anim.getState("idle");return null!=i&&i.isPlaying||this.anim.crossFade("idle",.2),void this.handleNormalDoor(t.otherCollider.node)}}}handleNormalDoor(t){t.getComponent(u).setDoorOpen(),t.active=!1}updateChase(t){this.targetMonster&&(this.lastPlayerPos=this.targetMonster.worldPosition.clone(),this.startPathfindingToLeaveTarget(this.lastPlayerPos))}startPathfindingToLeaveTarget(t){this.largeCollider.enabled=!1;let i=[];if(this.scanSystem.isSameLayer(this.node.worldPosition,t)){let e=this.getStairPointByCurrebtPos();if(c.distance(e,this.node.worldPosition)>c.distance(e,t)){let e=this.getFarPointAwayFromMonster(this.scanSystem.getFloorByPos(this.node.worldPosition),t);i=this.scanSystem.generatePath(this.node.worldPosition,e,!1,!1).map((t=>t.position))}else{let t=1==this.scanSystem.getFloorByPos(this.node.worldPosition)?2:1,e=this.getRandomRoadPointByFloor(t);const s=this.scanSystem.generatePath(this.node.worldPosition,e,!1,!1);i=i.concat(s.map((t=>t.position)).slice(1))}}else{let t=this.getFarPointAwayFromMonster(this.scanSystem.getFloorByPos(this.node.worldPosition),this.node.worldPosition);i=this.scanSystem.generatePath(this.node.worldPosition,t,!1,!1).map((t=>t.position))}i.length>0?(this.setPath(i),this.switchState(x.PATHFIND)):(this.targetMonster=null,this.largeCollider.enabled=!0,this.switchState(x.WANDER))}updatePathfinding(t){this.pathFollow.pathPoints.length>0?this.followPath(t):(this.largeCollider.enabled=!0,this.targetMonster=null,this.switchState(x.WANDER))}getStairPointForDifferentLayer(t){const i=this.node.worldPosition.y,e=t.y,s=this.scanSystem.middlePoint.y;return i>s&&e<s?this.scanSystem.bottomPoint:i<s&&e>s||e>s?this.scanSystem.topPoint:this.scanSystem.bottomPoint}setPath(t){this.pathFollow.pathPoints=t,this.pathFollow.currentPointIndex=0}followPath(t){if(this.pathFollow.currentPointIndex>=this.pathFollow.pathPoints.length)return void(this.pathFollow.pathPoints=[]);if(this.speed==this.moveSpeed){const t=this.anim.getState("walk");null!=t&&t.isPlaying||this.anim.crossFade("walk",.2)}else{const t=this.anim.getState("run");null!=t&&t.isPlaying||this.anim.crossFade("run",.2)}const i=this.pathFollow.pathPoints[this.pathFollow.currentPointIndex];this.moveToTarget(i,t),c.distance(this.node.worldPosition,i)<=this.arrivedThreshold&&this.pathFollow.currentPointIndex++}moveToTarget(t,i){const e=t.clone().subtract(this.node.worldPosition).normalize(),s=e.multiplyScalar(this.speed);if(this.rigidbody){this.rigidbody.setLinearVelocity(s);const t=180*Math.atan2(e.x,e.z)/Math.PI;this.node.setRotationFromEuler(0,t,0)}else{const t=e.multiplyScalar(this.speed*i);this.node.worldPosition=this.node.worldPosition.clone().add(t)}}setWanderPath(){let t=[];for(let i=0;i<this.scanSystem.roadPoints.length;i++){let e=this.scanSystem.roadPoints[i];c.distance(this.node.worldPosition,e)<.5||(this.scanSystem.checkObstacle(this.node.worldPosition,e,!1)||t.push(e))}let i=1e9,e=t[0];for(let s=0;s<t.length;s++){let o=t[s];if(!this.scanSystem.isSameLayer(this.node.worldPosition,o)&&!g.Instance.isUpStairDoorOpen&&!g.Instance.isDownStairDoorOpen)continue;let n=c.distance(this.node.worldPosition,o);n<i&&(i=n,e=o)}if(e){let t=[e];c.distance(this.node.worldPosition,this.scanSystem.topPoint)<.2&&t.push(this.scanSystem.bottomPoint),c.distance(this.node.worldPosition,this.scanSystem.bottomPoint)<.2&&t.push(this.scanSystem.topPoint);let i=t[Math.floor(Math.random()*t.length)];if(i==this.scanSystem.bottomPoint&&!this.scanSystem.isSameLayer(this.node.worldPosition,i)){let t=[this.node.worldPosition,this.scanSystem.middlePoint,this.scanSystem.bottomPoint];return void this.setPath(t)}if(i==this.scanSystem.topPoint&&!this.scanSystem.isSameLayer(this.node.worldPosition,i)){let t=[this.node.worldPosition,this.scanSystem.middlePoint,this.scanSystem.topPoint];return void this.setPath(t)}let s=[this.node.worldPosition,e];this.setPath(s)}else{let i=[this.node.worldPosition,t[Math.floor(Math.random()*t.length)]];this.setPath(i)}}setRunPath(){let t=[];for(let i=0;i<this.scanSystem.roadPoints.length;i++){let e=this.scanSystem.roadPoints[i];this.scanSystem.isSameLayer(this.node.worldPosition,e)&&(this.scanSystem.checkObstacle(this.node.worldPosition,e,!1)||t.push(e))}c.distance(this.node.worldPosition,this.scanSystem.topPoint)<.2&&t.push(this.scanSystem.bottomPoint),c.distance(this.node.worldPosition,this.scanSystem.bottomPoint)<.2&&t.push(this.scanSystem.topPoint);let i=0,e=t[0];if(t.forEach(((t,s)=>{let o=c.distance(this.targetMonster.worldPosition,t);const n=this.targetMonster.worldPosition.clone().subtract(this.node.worldPosition).normalize(),a=t.clone().subtract(this.node.worldPosition).normalize();c.dot(n,a)<0&&o>i&&(i=o,e=t)})),e){let t=[this.node.worldPosition,e];this.setPath(t)}else{let i=[this.node.worldPosition,t[Math.floor(Math.random()*t.length)]];this.setPath(i)}}updateWanderPath(t){if(this.pathFollow.pathPoints.length>0)return void this.followPath(t);this.wanderWaitTimer+=t;const i=this.anim.getState("idle");null!=i&&i.isPlaying||this.anim.crossFade("idle",1),this.wanderWaitTimer>=this.wanderWaitTime&&(this.wanderWaitTimer=0,this.setWanderPath())}updateRunPath(t){this.pathFollow.pathPoints.length>0?this.followPath(t):this.setRunPath()}}).prototype,"GameUI",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N=i(F.prototype,"scanSystem",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=i(F.prototype,"moveSpeed",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),R=i(F.prototype,"arrivedThreshold",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),A=i(F.prototype,"smallCollider",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=i(F.prototype,"largeCollider",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=i(F.prototype,"player",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=i(F.prototype,"NpcNodes",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),v=F))||v));s._RF.pop()}}}));

System.register("chunks:///_virtual/JJTW_PlayerController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./JJTW_DataManager.ts","./JJTW_ColliderGroupNumber.ts","./JJTW_GameUI.ts"],(function(e){var t,s,n,a,o,i,r,l,c,h,d,m,p,g,I,y,D,C,_,u,f,T,E,v;return{setters:[function(e){t=e.applyDecoratedDescriptor,s=e.initializerDefineProperty},function(e){n=e.cclegacy,a=e.Node,o=e.Camera,i=e._decorator,r=e.Component,l=e.geometry,c=e.CapsuleCollider,h=e.input,d=e.Input,m=e.tween,p=e.SkeletalAnimation,g=e.RigidBody,I=e.SpotLight,y=e.Vec3,D=e.v3,C=e.KeyCode,_=e.AudioSource,u=e.PhysicsSystem},function(e){f=e.JJTW_DataManager},function(e){T=e.JJTW_ColliderGroupNumber,E=e.JJTW_ColliderGroupType},function(e){v=e.JJTW_GameUI}],execute:function(){var b,P,W,K,S,k,G,w,J,U;n._RF.push({},"f31f66MnttAmr/yPa20Wjo9","JJTW_PlayerController",void 0);const{ccclass:x,property:M}=i;e("JJTW_PlayerController",(b=x("JJTW_PlayerController"),P=M(a),W=M(o),K=M(v),b(((U=class e extends r{constructor(...e){super(...e),s(this,"point",G,this),s(this,"UICamera",w,this),s(this,"GameUI",J,this),this.normalSpeed=3.3,this.speed=0,this.rig=void 0,this.anim=void 0,this.light=void 0,this.camera=void 0,this.ray=new l.Ray,this.lightTime=10,this.lightRemainTime=10,this.cameraRay=null,this.isDead=!1,this.isWin=!1,this.lastHouse=null,this.lastCameraPos=null,this.lastCameraWorldPos=null,this.distance=0}static get Instance(){return this.instance}onLoad(){e.instance=this}setPlayerDead(){f.Instance.isMove=!1,f.Instance.isScream=!1,f.Instance.isPlayerDead=!0,this.isDead=!0,this.rig.enabled=!1,this.anim.crossFade("dead",.5),this.getComponent(T).destroy();let e=this.node.getComponent(c);e.off("onTriggerEnter",this.onTriggerEnter,this),e.off("onTriggerExit",this.onTriggerExit,this),h.off(d.EventType.KEY_DOWN,this.onKeyDown,this),h.off(d.EventType.KEY_UP,this.onKeyUp,this),this.getComponent(T).destroy(),m(this.node).delay(1).call((()=>{this.GameUI.showDeadAnim()})).start()}start(){this.cameraRay=new l.Ray,this.anim=this.node.getComponent(p),this.rig=this.node.getComponent(g),this.light=this.node.getComponentInChildren(I),this.camera=this.node.getComponentInChildren(o),this.rig.useCCD=!0;this.node.getChildByName("rayPos").position;this.lastCameraPos=this.camera.node.position,this.lastCameraWorldPos=this.camera.node.getWorldPosition(),this.distance=y.distance(this.lastCameraWorldPos,this.node.getChildByName("rayPos").getWorldPosition());let e=this.node.getComponent(c);e.on("onTriggerEnter",this.onTriggerEnter,this),e.on("onTriggerExit",this.onTriggerExit,this),h.on(d.EventType.KEY_DOWN,this.onKeyDown,this),h.on(d.EventType.KEY_UP,this.onKeyUp,this)}onKeyDown(e){switch(f.Instance.delta=D(0,0,0),e.keyCode){case C.KEY_A:f.Instance.isMove=!0,f.Instance.delta=D(-10,f.Instance.delta.y,f.Instance.delta.z);break;case C.KEY_W:f.Instance.isMove=!0,f.Instance.delta=D(f.Instance.delta.x,10,f.Instance.delta.z);break;case C.KEY_S:f.Instance.isMove=!0,f.Instance.delta=D(f.Instance.delta.x,-10,f.Instance.delta.z);break;case C.KEY_D:f.Instance.isMove=!0,f.Instance.delta=D(10,f.Instance.delta.y,f.Instance.delta.z)}}onKeyUp(e){switch(e.keyCode){case C.KEY_A:f.Instance.isMove=!1,f.Instance.delta=D(0,f.Instance.delta.y,f.Instance.delta.z);break;case C.KEY_W:case C.KEY_S:f.Instance.isMove=!1,f.Instance.delta=D(f.Instance.delta.x,0,f.Instance.delta.z);break;case C.KEY_D:f.Instance.isMove=!1,f.Instance.delta=D(0,f.Instance.delta.y,f.Instance.delta.z)}}update(e){var t;if(!this.isDead&&!this.isWin){if(f.Instance.isFlashlight?this.openFlashlight():this.closeFlashlight(),f.Instance.isScream?(this.speed=3*this.normalSpeed,f.Instance.isMove?this.getComponent(_).playing||this.getComponent(_).play():this.getComponent(_).playing||this.getComponent(_).stop()):(this.speed=this.normalSpeed,this.getComponent(_).stop()),f.Instance.isMove&&(null==(t=f.Instance.delta)?void 0:t.length())>1){if(f.Instance.isScream){const e=this.anim.getState("run");null!=e&&e.isPlaying||this.anim.crossFade("run",1)}else{const e=this.anim.getState("walk");null!=e&&e.isPlaying||this.anim.crossFade("walk",1)}let e=D();e=y.normalize(e,f.Instance.delta).multiplyScalar(this.speed);let t=D();this.rig.getLinearVelocity(t),e.x=-e.x,e.z=e.y,e.y=t.y;const s=this.node.getWorldRotation();y.transformQuat(e,e,s),e.y=0,this.rig.setLinearVelocity(e)}if(f.Instance.isMove)this.rig.useGravity=!0;else{const e=this.anim.getState("idle");null!=e&&e.isPlaying||this.anim.crossFade("idle",1)}f.Instance.currentTargetPos&&(f.Instance.currentPlayerPos=this.node.getWorldPosition())}}interact(){const e=this.camera;if(!e)return;let t=new l.Ray,s=D();this.UICamera.worldToScreen(this.point.getWorldPosition(),s),e.screenPointToRay(s.x,s.y,t);const n=[E.Key,E.Compass_1,E.Compass_2,E.Compass_3,E.Compass_4,E.Compass_5,E.Compass_6,E.File,E.Door_1,E.Door_2,E.Door_3,E.Door_4,E.Door_5,E.Door_6,E.Door_Normal,E.Door_Exit,E.Door_Stair_1,E.Door_Stair_2];if(u.instance.raycastClosest(t)){const e=u.instance.raycastClosestResult,t=e.collider.node.getComponent(T);t&&n.includes(t.groupType)&&this.handleInteract(e)}}handleInteract(e){if(e)switch(e.collider.node.getComponent(T).groupType){case E.Key:f.Instance.keyData.isGot=!0,this.handleItem(e);break;case E.Compass_1:f.Instance.compassData[0].isGot=!0,this.handleItem(e);break;case E.Compass_2:f.Instance.compassData[1].isGot=!0,this.handleItem(e);break;case E.Compass_3:f.Instance.compassData[2].isGot=!0,this.handleItem(e);break;case E.Compass_4:f.Instance.compassData[3].isGot=!0,this.handleItem(e);break;case E.Compass_5:f.Instance.compassData[4].isGot=!0,this.handleItem(e);break;case E.Compass_6:f.Instance.compassData[5].isGot=!0,this.handleItem(e);break;case E.File:f.Instance.fileData.isGot=!0,this.handleItem(e);break;case E.Door_1:case E.Door_2:case E.Door_3:case E.Door_4:case E.Door_5:case E.Door_6:this.handleKeyDoor(e);break;case E.Door_Stair_1:f.Instance.isDownStairDoorOpen=!0,this.handleNormalDoor(e);break;case E.Door_Stair_2:f.Instance.isUpStairDoorOpen=!0,this.handleNormalDoor(e);break;case E.Door_Normal:this.handleNormalDoor(e);break;case E.Door_Exit:this.handleEXITDoor(e)}}handleItem(e){e.collider.node.active=!1,this.GameUI.updateBag()}handleKeyDoor(e){f.Instance.keyData.isGot?(e.collider.node.getComponent(T).setDoorOpen(),e.collider.node.active=!1):this.GameUI.showKeyDoorTip()}handleNormalDoor(e){e.collider.node.getComponent(T).setDoorOpen(),e.collider.node.active=!1}handleEXITDoor(e){let t=!0,s=[];for(let e=0;e<f.Instance.compassData.length;e++)if(!f.Instance.compassData[e].isSet&&(t=!1,f.Instance.compassData[e].isGot)){s.push(f.Instance.compassData[e]);break}if(t)e.collider.node.getComponent(T).setDoorOpen(),e.collider.node.active=!1;else if(s.length>0){for(let t=0;t<s.length;t++)e.collider.node.getComponent(T).compassNode[s[t].id].active=!0,s[t].isSet=!0;this.GameUI.updateBag()}else this.GameUI.showExitDoorTip()}openFlashlight(){this.light.enabled=!0}closeFlashlight(){this.light.enabled=!1}onTriggerEnter(e){const t=e.otherCollider.node.getComponent(T);if(t&&t.groupType==E.Exit_End){f.Instance.isMove=!1,f.Instance.isScream=!1,f.Instance.isPlayerDead=!0,this.isWin=!0,this.rig.enabled=!1,this.getComponent(T).destroy();let e=this.node.getComponent(c);e.off("onTriggerEnter",this.onTriggerEnter,this),e.off("onTriggerExit",this.onTriggerExit,this),h.off(d.EventType.KEY_DOWN,this.onKeyDown,this),h.off(d.EventType.KEY_UP,this.onKeyUp,this),this.getComponent(T).destroy(),m(this.node).call((()=>{this.GameUI.showWinAnim()})).start()}}onTriggerExit(e){}}).instance=void 0,G=t((k=U).prototype,"point",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w=t(k.prototype,"UICamera",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J=t(k.prototype,"GameUI",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S=k))||S));n._RF.pop()}}}));

System.register("chunks:///_virtual/JJTW_ScanSysem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./JJTW_ColliderGroupNumber.ts","./JJTW_DataManager.ts"],(function(t){var i,e,o,r,n,s,a,h,l,c,u,P,d,p,f;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.initializerDefineProperty},function(t){o=t.cclegacy,r=t.Prefab,n=t.Node,s=t._decorator,a=t.Component,h=t.geometry,l=t.Vec3,c=t.instantiate,u=t.PhysicsSystem,P=t.v3},function(t){d=t.JJTW_ColliderGroupNumber,p=t.JJTW_ColliderGroupType},function(t){f=t.JJTW_DataManager}],execute:function(){var y,m,g,w,b,_,S,L,A,T,D,C,I;o._RF.push({},"9766b2ChBtAIbVG2rlVozo/","JJTW_ScanSysem",void 0);const{ccclass:v,property:J}=s,V=new Set;t("JJTW_ScanSysem",(y=v("JJTW_ScanSysem"),m=J(r),g=J(n),w=J(n),b=J(n),_=J(Number),y((A=i((L=class extends a{constructor(...t){super(...t),e(this,"arrowPrefab",A,this),e(this,"arrowParent",T,this),e(this,"roadParent",D,this),e(this,"playerNode",C,this),this.roadPointDistance=.5,this.maxLoopCount=10,this.sameLayerTolerance=1.5,this.floor2Y=-1.602012,e(this,"raycastMask",I,this),this.roadPoints=[],this.topPoint=null,this.middlePoint=null,this.middlePoint_up=null,this.middlePoint_down=null,this.bottomPoint=null,this.downCountTime=10,this.passTime=0,this.time=0,this.isNeedArrow=!0,this.arrowPool={active:[],inactive:[]},this.maxPoolSize=70,this.ray=new h.Ray,this.tempVec3_1=new l,this.tempVec3_2=new l,this.roadPointsByLayer={1:[],2:[]},this.currentPathCalculation=null,this.isPlayer=!0,this.isCalculating=!1,this.maxStepsPerFrame=100,this.xunlu=!1}start(){this.roadParent.active=!1,this.initRoadPoints(),this.preCreateArrows(50)}showArrow(){this.scheduleCreateArrows()}createArrowAsync(){}scheduleCreateArrows(){if(f.Instance.currentTargetPos){let t=this.playerNode.getWorldPosition();this.startPathCalculation(t,f.Instance.currentTargetPos),this.scheduleOnce(this.hideArrow,10)}}hideArrow(){f.Instance.currentTargetPos=null,f.Instance.currentPlayerPos=null,f.Instance.itemFloorNumber=null,this.clearArrows(),this.currentPathCalculation&&(this.currentPathCalculation.isProcessing=!1,this.currentPathCalculation=null)}preCreateArrows(t){for(let i=0;i<t;i++){const t=c(this.arrowPrefab);t.setParent(this.arrowParent),t.active=!1,this.arrowPool.inactive.push(t)}}getArrowFromPool(){if(this.arrowPool.inactive.length>0){const t=this.arrowPool.inactive.pop();return t.active=!0,this.arrowPool.active.push(t),t}{const t=c(this.arrowPrefab);return t.setParent(this.arrowParent),this.arrowPool.active.push(t),t}}initRoadPoints(){this.roadPoints=[],this.roadPointsByLayer={1:[],2:[]};for(let t=0;t<this.roadParent.children.length;t++){const i=this.roadParent.children[t],e=i.worldPosition.clone();this.roadPoints.push(e);const o=e.y>this.floor2Y?2:1;switch(this.roadPointsByLayer[o].push(e),i.name){case"top":this.topPoint=e;break;case"middle":this.middlePoint=e;break;case"bottom":this.bottomPoint=e}}}update(t){}generatePath(t,i,e=!0,o=!0,r){return this.isPlayer=o,this.isNeedArrow=e,(r?this.isSameLayerWithTargetLayer(t,r):this.isSameLayer(t,i))?this.findPathInSameLayer(t,i,o):this.findPathInDifferentLayers(t,i,o)}startPathCalculation(t,i,e=!0){if(this.isPlayer=!0,this.isSameLayer(t,i)){const o=this.findPathInSameLayer(t,i,!0);e&&this.createArrowsAlongPath(o),this.currentPathCalculation=null}else{const o=this.findPathInDifferentLayers(t,i,!0);e&&this.createArrowsAlongPath(o),this.currentPathCalculation=null}}isSameLayer(t,i){return Math.abs(t.y-i.y)<=this.sameLayerTolerance}isSameLayerWithTargetLayer(t,i){let e=0;return t.y>this.floor2Y?e=2:t.y<this.bottomPoint.y&&(e=1),e==i}getFloorByPos(t){let i=0;return t.y>this.floor2Y?i=2:t.y<this.bottomPoint.y&&(i=1),i}findPathInSameLayer(t,i,e){const o=[];V.clear();const r=[],n=t.y>this.floor2Y?2:1,s=[...this.roadPointsByLayer[n],i],a={position:t.clone(),g:0,h:this.heuristic(t,i),f:0+this.heuristic(t,i),parent:null};for(o.push(a);o.length>0;){let t=0;for(let i=0;i<o.length;i++)o[i].f<o[t].f&&(t=i);const n=o.splice(t,1)[0];if(l.distance(n.position,i)<1.5*this.roadPointDistance){let t=n;for(;t;)r.unshift({position:t.position.clone(),isTurnPoint:!0}),t=t.parent;return r}V.add(this.getVec3Hash(n.position));const a=this.getNeighbors(n.position,s,V,e);for(const t of a){if(V.has(this.getVec3Hash(t)))continue;const e=n.g+l.distance(n.position,t);let r=o.find((i=>l.distance(i.position,t)<.01));r?e<r.g&&(r.g=e,r.f=r.g+r.h,r.parent=n):(r={position:t.clone(),g:e,h:this.heuristic(t,i),f:e+this.heuristic(t,i),parent:n},o.push(r))}}return[]}findPathInDifferentLayers(t,i,e){if(!this.topPoint||!this.middlePoint||!this.bottomPoint)return[];let o=[];if(t.y>this.floor2Y){const r=this.findPathInSameLayer(t,this.topPoint,e);if(0===r.length)return[];r.push({position:this.middlePoint.clone(),isTurnPoint:!0}),r.push({position:this.bottomPoint.clone(),isTurnPoint:!0});const n=this.findPathInSameLayer(this.bottomPoint,i,e);if(0===n.length)return r;o=r.concat(n.slice(1))}else if(t.y<this.bottomPoint.y){const r=this.findPathInSameLayer(t,this.bottomPoint,e);if(0===r.length)return[];r.push({position:this.middlePoint.clone(),isTurnPoint:!0}),r.push({position:this.topPoint.clone(),isTurnPoint:!0});const n=this.findPathInSameLayer(this.topPoint,i,e);if(0===n.length)return r;o=r.concat(n.slice(1))}else{let r,n=!1;i.y>this.middlePoint.y?(r=this.topPoint,n=this.middlePoint.y>t.y):(r=this.bottomPoint,n=this.middlePoint.y<t.y);let s=this.findPathInSameLayer(t,r,e);if(0===s.length)return[];if(n){const t=s.findIndex((t=>l.distance(t.position,r)<1.5*this.roadPointDistance));t>0&&s.splice(t,0,{position:this.middlePoint.clone(),isTurnPoint:!0})}const a=this.findPathInSameLayer(r,i,e);if(0===a.length)return s;o=s.concat(a.slice(1))}return o}checkObstacle(t,i,e){i.clone().subtract(t).normalize();const o=l.distance(t,i);h.Ray.fromPoints(this.ray,t,i),u.instance.raycast(this.ray,this.raycastMask);const r=u.instance.raycastResults;if(r&&r.length>0)for(const t of r){const i=t.collider.node.getComponent(d);if(!i)continue;let r=[];r=e?[p.Wall,p.Barrier]:[p.Wall,p.Barrier,p.Door_1,p.Door_2,p.Door_3,p.Door_4,p.Door_5,p.Door_6,p.Door_Normal,p.Door_Exit,p.Door_Stair_1,p.Door_Stair_2];if(r.includes(i.groupType)&&t.distance<o-.01)return!0}return!1}findNearestRoadPoint(t,i,e){let o=null,r=1/0;const n=t.y>this.floor2Y?2:1,s=this.roadPointsByLayer[n]||[];for(const n of s){if(i.some((t=>l.equals(t,n))))continue;if(l.distance(t,n)<.1)continue;if(!this.isSameLayer(t,n))continue;const s=l.distance(t,n);l.subtract(this.tempVec3_1,n,t),this.tempVec3_1.normalize(),l.subtract(this.tempVec3_2,e,t),this.tempVec3_2.normalize();const a=s*(1-.3*((l.dot(this.tempVec3_1,this.tempVec3_2)+1)/2));a<r&&(r=a,o=n)}return o}createArrowsAlongPath(t){if(this.clearArrows(),!(t.length<2))for(let i=0;i<t.length-1;i++){const e=t[i].position,o=t[i+1].position;this.createArrowsBetweenPoints(e,o)}}createArrowsBetweenPoints(t,i){const e=i.clone().subtract(t),o=e.length();e.normalize();const r=Math.ceil(o/this.roadPointDistance);for(let n=1;n<=r;n++){const r=t.clone().add(e.clone().multiplyScalar(n*this.roadPointDistance));l.distance(t,r)>o&&r.set(i);const s=this.getArrowFromPool();s.worldPosition=r,s.eulerAngles=P(0,0,0);const a=180*Math.atan2(e.x,e.z)/Math.PI;s.setRotationFromEuler(0,a,0)}}clearArrows(){for(;this.arrowPool.active.length>0;){const t=this.arrowPool.active.pop();t.active=!1,this.arrowPool.inactive.push(t)}}heuristic(t,i){return l.distance(t,i)}getNeighbors(t,i,e,o){const r=[];for(const n of i)l.distance(t,n)<.05||e.has(this.getVec3Hash(n))||this.checkObstacle(t,n,o)||r.push(n);return r}getVec3Hash(t){return`${t.x.toFixed(2)},${t.y.toFixed(2)},${t.z.toFixed(2)}`}}).prototype,"arrowPrefab",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=i(L.prototype,"arrowParent",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=i(L.prototype,"roadParent",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=i(L.prototype,"playerNode",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=i(L.prototype,"raycastMask",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),S=L))||S));o._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/37_JJTW_Bundle', 'chunks:///_virtual/37_JJTW_Bundle'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});