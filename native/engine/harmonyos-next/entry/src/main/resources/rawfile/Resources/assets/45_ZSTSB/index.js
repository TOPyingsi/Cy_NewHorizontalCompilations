System.register("chunks:///_virtual/45_ZSTSB",["./BHPD_FirstCourse.ts","./BHPD_GameData.ts","./BHPD_GameMgr.ts","./BHPD_PixelPool.ts","./BHPD_ColorBox.ts","./BHPD_Course.ts","./BHPD_Iron.ts","./BHPD_MoveCtrl.ts","./BHPD_Niezi.ts","./BHPD_Pixel.ts","./BHPD_ScaleSlider.ts","./BHPD_TouchCtrl.ts","./BHPD_Map.ts","./ZSTSB_FillColor.ts","./ZSTSB_Prop.ts","./ZSTSB_Cloud.ts","./ZSTSB_Course.ts","./ZSTSB_Map.ts","./ZSTSB_MapBtn.ts","./ZSTSB_AudioManager.ts","./ZSTSB_FirstCourse.ts","./ZSTSB_GameData.ts","./ZSTSB_GameMgr.ts","./ZSTSB_Incident.ts","./ZSTSB_Loading.ts","./ZSTSB_MoveCtrl.ts","./ZSTSB_ParticlePool.ts","./ZSTSB_Pixel.ts","./ZSTSB_PixelPool.ts","./ZSTSB_UIGame.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/BHPD_ColorBox.ts",["cc"],(function(o){var t,e,i,r,s,n;return{setters:[function(o){t=o.cclegacy,e=o.Component,i=o.Color,r=o.Sprite,s=o.Label,n=o._decorator}],execute:function(){var c;t._RF.push({},"20767BiE6hP25FwhUSvYUN5","BHPD_ColorBox",void 0);const{ccclass:l,property:h}=n;o("BHPD_ColorBox",l("BHPD_ColorBox")(c=class extends e{constructor(...o){super(...o),this.colorSprite=null,this.color=new i,this.colorIndex=0,this.Finish=!1}start(){}update(o){}initData(o,t){this.color=o,this.colorIndex=t,this.colorSprite=this.node.getChildByName("圈堆").getComponent(r),this.colorSprite.color=o,this.node.getChildByName("数字").getComponent(s).string=t.toString()}isFinish(){this.node.getChildByName("bg").getComponent(r).grayscale=!0,this.colorSprite.grayscale=!0,this.Finish=!0,this.node.getChildByName("完成").active=!0}})||c);t._RF.pop()}}}));

System.register("chunks:///_virtual/BHPD_Course.ts",["cc","./ZSTSB_AudioManager.ts","./BHPD_GameData.ts"],(function(e){var t,i,n,s,o,c,r;return{setters:[function(e){t=e.cclegacy,i=e.Component,n=e.NodeEventType,s=e.director,o=e._decorator},function(e){c=e.ZSTSB_AudioManager},function(e){r=e.BHPD_GameData}],execute:function(){var a;t._RF.push({},"53930MqCmFEHaDCvM2jvwgy","BHPD_Course",void 0);const{ccclass:d,property:h}=o;e("BHPD_Course",d("BHPD_Course")(a=class extends i{constructor(...e){super(...e),this.index=0,this.isFirst=!0}onEnable(){this.node.on(n.TOUCH_END,this.onClick,this)}onClick(){console.log("下一步教程"),c.instance.playSFX("按钮");let e=this.node.children.length;if(this.index++,this.index>=e)return this.index=0,this.node.children[e-1].active=!1,this.node.children[this.index].active=!0,this.node.active=!1,this.node.off(n.TOUCH_END,this.onClick,this),void(r.Instance.isFirst&&(r.Instance.isFirst=!1,s.getScene().emit("八花拼豆_新手教程结束")));this.node.children[this.index-1].active=!1,this.node.children[this.index].active=!0}})||a);t._RF.pop()}}}));

System.register("chunks:///_virtual/BHPD_FirstCourse.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BHPD_GameMgr.ts","./BHPD_GameData.ts"],(function(e){var i,t,s,r,n,o,c,a,l,h;return{setters:[function(e){i=e.applyDecoratedDescriptor,t=e.initializerDefineProperty},function(e){s=e.cclegacy,r=e.Node,n=e._decorator,o=e.Component,c=e.NodeEventType,a=e.director},function(e){l=e.BHPD_GameMgr},function(e){h=e.BHPD_GameData}],execute:function(){var u,d,p,_,D,f,g;s._RF.push({},"4eba8maPw1A7IKyGbT2BVSf","BHPD_FirstCourse",void 0);const{ccclass:C,property:P}=n;e("BHPD_FirstCourse",(u=C("BHPD_FirstCourse"),d=P({type:[r]}),p=P(r),u((f=i((D=class extends o{constructor(...e){super(...e),t(this,"courseNodes",f,this),t(this,"reward",g,this),this.index=0,this.airWall=null}start(){this.airWall=l.instance.AirWall;for(let e=0;e<this.courseNodes.length;e++)this.courseNodes[e].once(c.TOUCH_END,this.onClick,this);a.getScene().on("八花拼豆_新手教程",this.onClick,this),a.getScene().once("八花拼豆_新手教程结束",this.FinishCourse,this)}onClick(){this.index++,this.airWall.active=!0,console.log("点击了",this.index),this.node.children[this.index-1].active=!1,this.index>=this.node.children.length?this.airWall.active=!1:this.scheduleOnce((()=>{this.node.children[this.index]&&(this.node.children[this.index].active=!0),this.airWall.active=!1}),.3)}FinishCourse(){h.Instance.isFirst=!1,console.error(2222)}}).prototype,"courseNodes",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),g=i(D.prototype,"reward",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=D))||_));s._RF.pop()}}}));

System.register("chunks:///_virtual/BHPD_GameData.ts",["cc"],(function(t){var a,e,i;return{setters:[function(t){a=t.cclegacy,e=t._decorator,i=t.sys}],execute:function(){var l,n;a._RF.push({},"c7dafklnxdM/7jz5QMHyTfR","BHPD_GameData",void 0);const{ccclass:r,property:s}=e;t("BHPD_GameData",r("BHPD_GameData")(((n=class t{constructor(){this.LockArr=[!0,!1,!1,!1,!1,!1,!1,!1,!1,!1],this.isFirst=!0,this.mapData=[{BuildingName:"地图1",State:!1,fillArr:[]},{BuildingName:"地图2",State:!1,fillArr:[]},{BuildingName:"地图3",State:!1,fillArr:[]},{BuildingName:"地图4",State:!1,fillArr:[]},{BuildingName:"地图5",State:!1,fillArr:[]},{BuildingName:"地图6",State:!1,fillArr:[]},{BuildingName:"地图7",State:!1,fillArr:[]},{BuildingName:"地图8",State:!1,fillArr:[]},{BuildingName:"地图9",State:!1,fillArr:[]},{BuildingName:"地图10",State:!1,fillArr:[]}],this.TimeDate=[]}finifshByName(t){for(let a=0;a<this.mapData.length;a++)t===this.mapData[a].BuildingName&&(this.mapData[a].State=!0)}getDataByName(t){return this.mapData.find((a=>a.BuildingName===t))}static get Instance(){return t.instance||this.ReadDate(),t.instance}static DateSave(){let a=JSON.stringify(t.Instance);i.localStorage.setItem("BHPD_DATA",a),console.log("游戏存档")}static ReadDate(){let a=i.localStorage.getItem("BHPD_DATA");""!=a&&null!=a?(console.log("读取存档"),t.instance=Object.assign(new t,JSON.parse(a))):(console.log("新建存档"),t.instance=new t)}}).isText=!1,n.instance=null,l=n))||l);a._RF.pop()}}}));

System.register("chunks:///_virtual/BHPD_GameMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ZSTSB_Incident.ts","./ZSTSB_AudioManager.ts","./BHPD_GameData.ts","./BHPD_PixelPool.ts","./BHPD_Pixel.ts","./BHPD_ColorBox.ts","./BHPD_Niezi.ts","./ProjectEventManager.ts","./BHPD_Iron.ts","./BHPD_ScaleSlider.ts"],(function(t){var e,i,o,s,r,n,l,a,h,c,g,p,u,d,m,f,x,P,C,S,y,w,M,N,b,D,I,B,F,v,z,T,A;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){o=t.cclegacy,s=t.Node,r=t.Prefab,n=t.ParticleSystem2D,l=t._decorator,a=t.Component,h=t.Color,c=t.v3,g=t.Vec3,p=t.director,u=t.Sprite,d=t.Label,m=t.Button,f=t.tween,x=t.ScrollView,P=t.instantiate,C=t.UITransform,S=t.sys,y=t.Texture2D,w=t.gfx},function(t){M=t.ZSTSB_Incident},function(t){N=t.ZSTSB_AudioManager},function(t){b=t.BHPD_GameData},function(t){D=t.BHPD_PixelPool},function(t){I=t.BHPD_Pixel},function(t){B=t.BHPD_ColorBox},function(t){F=t.BHPD_Niezi},function(t){v=t.ProjectEventManager,z=t.ProjectEvent},function(t){T=t.BHPD_Iron},function(t){A=t.BHPD_ScaleSlider}],execute:function(){var _,R,k,$,H,L,O,G,W,E,j,V,Z,U,X,Y,K,q,J,Q,tt,et,it,ot;o._RF.push({},"490e9gVYtpAKa7Z3sIb9mp9","BHPD_GameMgr",void 0);const{ccclass:st,property:rt}=l;t("BHPD_GameMgr",(_=st("BHPD_GameMgr"),R=rt(s),k=rt(D),$=rt(r),H=rt(F),L=rt(T),O=rt(s),G=rt(s),W=rt(s),E=rt(n),j=rt(s),_(((ot=class t extends a{constructor(...t){super(...t),i(this,"Target",U,this),i(this,"PixelPoolCtrl",X,this),i(this,"colorBoxPrefab",Y,this),i(this,"niezi",K,this),i(this,"iron",q,this),i(this,"SureReturn",J,this),this.targetImage=null,i(this,"processNode",Q,this),i(this,"courseNode",tt,this),i(this,"particle",et,this),i(this,"winNode",it,this),this.processSprite=null,this.processLabel=null,this.isGameOver=!1,this.isPoolInit=!1,this.curMapID="",this.curColor=new h,this.curCircle=0,this.level=0,this.fillNodes=[],this.posNodes=[],this.AirWall=null,this.totalPixels=0,this.pixelData2D=[],this.finishData2D=[],this.curPixel=0,this.couldFire=!1,this.isFilling=!1,this.isFirst=!0,this.colorIndexMap=new Map,this.colorSelect=[],this.finishColorNum=4,this.startPos=c(250,0,0),this.startSize=10,this.curIndex=0,this.colorMap=new Map,this.finishMap=new Map,this.posNodeMap=new Map,this.widthNum=0,this.heightNum=0,this.colorCache=new Map,this.colorLookupMap=new Map,this.colorFinishMap=new Map,this.isCreatingPixels=!1,this.isShow=!1,this.tempVec3=new g,this.isText=!1}start(){t.instance=this,this.AirWall=this.node.getChildByName("阻挡墙"),b.isText?this.node.getChildByName("测试").active=!0:this.node.getChildByName("测试").active=!1,b.Instance.isFirst?p.getScene().getChildByPath("Canvas/DIY豆豆/首次教程").active=!0:p.getScene().getChildByPath("Canvas/DIY豆豆/首次教程").active=!1,this.processSprite=this.processNode.getChildByName("进度").getComponent(u),this.processLabel=this.processNode.getChildByName("进度百分比").getComponent(d),this.processLabel.string="0 %"}startGame(){this.curMapID;let e="Sprites/八花拼豆/关卡/"+this.curMapID;v.emit(z.游戏开始),M.LoadImageAsset(e).then((i=>{M.LoadImageAsset(e+"完成").then((e=>{console.log("开始加载游戏"),this.targetImage=i,this.loadImage(e),console.log(t.instance)}))}))}onBtnClick(t){switch(t.target.name){case"教程按钮":this.courseNode.active=!0,b.Instance.isFirst&&p.getScene().emit("八花拼豆_新手教程");break;case"完成拼豆":this.AfinishFill();break;case"完成熨斗":this.AfinishFire();break;case"返回":this.showSureReturn();break;case"返回选图":case"取消返回":this.closeSureReturn()}}showSureReturn(){this.AirWall.active=!0,N.instance.playSFX("按钮"),this.SureReturn.active=!0,this.SureReturn.scale=c(0,0,0);let t=this.SureReturn.getChildByName("返回选图").getComponent(m),e=this.SureReturn.getChildByName("取消返回").getComponent(m);t.enabled=!1,e.enabled=!1,f(this.SureReturn).to(.5,{scale:c(1,1,1)},{easing:"backOut"}).call((()=>{t.enabled=!0,e.enabled=!0})).start()}closeSureReturn(){this.SureReturn.scale=c(1,1,1),N.instance.playSFX("按钮");let t=this.SureReturn.getChildByName("返回选图").getComponent(m),e=this.SureReturn.getChildByName("取消返回").getComponent(m);t.enabled=!1,e.enabled=!1,f(this.SureReturn).to(.5,{scale:c(0,0,0)},{easing:"backIn"}).call((()=>{t.enabled=!0,e.enabled=!0,this.SureReturn.active=!1,this.AirWall.active=!1})).start()}updateProgress(){const t=this.curPixel/(2*this.totalPixels);this.processLabel.string=(100*t).toFixed(2)+" %",this.processSprite.fillRange=t}Win(){this.winNode.active=!0,v.emit(z.游戏结束),N.instance.playSFX("胜利"),M.LoadSprite("Sprites/八花拼豆/关卡/"+this.curMapID+"最终").then((t=>{let e=this.winNode.getChildByName("图片");e.getChildByName("完成图").getComponent(u).spriteFrame=t,f(e).to(1,{scale:c(1,1,1)}).call((()=>{this.particle.node.active=!0,this.particle.resetSystem()})).start()})),this.level<b.Instance.LockArr.length&&(b.Instance.LockArr[this.level]=!0),b.Instance.finifshByName(this.curMapID),console.log("游戏胜利")}restart(){this.curMapID="",this.curColor=null,this.curCircle=0,this.curPixel=0,this.couldFire=!1,this.isFilling=!1,this.isCreatingPixels=!1,this.isShow=!1,this.totalPixels=0,this.finishColorNum=4,this.curIndex=0,this.widthNum=0,this.heightNum=0,this.processSprite&&(this.processSprite.fillRange=0),this.particle.node.active=!1,this.particle.stopSystem(),this.PixelPoolCtrl.loading(),this.PixelPoolCtrl.recyclePixel(),this.niezi.ResetPos(),this.iron.ResetPos(),this.winNode.active=!1,this.winNode.getChildByName("图片").scale=c(0,0,0),this.Target.getChildByName("图片").scale=c(1,1,1),this.Target.getChildByName("图片").position=c(0,0,0),this.node.getChildByPath("游戏内容/放缩滑动条").getComponent(A).setProgress(0);let t=this.node.getChildByPath("游戏内容/填色").getComponent(x).content;for(;t.children.length>0;){const e=t.children[0];e.removeFromParent(),e.destroy()}this.fillNodes.length=0,this.posNodes.length=0,this.colorSelect.length=0,this.pixelData2D.length=0,this.finishData2D.length=0,this.colorIndexMap.clear(),this.colorMap.clear(),this.finishMap.clear(),this.posNodeMap.clear(),this.colorCache.clear(),this.colorLookupMap.clear(),this.colorFinishMap.clear(),this.niezi.ResetPos(),this.startPos.set(250,0,0),this.targetImage=null,b.DateSave()}onFire(){this.curPixel++,this.updateProgress(),console.log(this.curPixel/this.totalPixels),this.curPixel/(2*this.totalPixels)>=1&&this.Win()}onIronMove(t){this.posCheck(t,this.fillNodes,"IronBox")}initSelectColor(){let t=this.node.getChildByPath("游戏内容/填色").getComponent(x).content,e=[0,this.posNodeMap.get(this.curIndex.toString()).length];this.colorIndexMap.set(this.curIndex.toString(),e);for(let e=1;e<this.colorMap.size;e++){let i=this.colorMap.get(e.toString()),o=P(this.colorBoxPrefab);o.parent=t,o.getComponent(B).initData(i,e);let s=this.posNodeMap.get(e.toString()),r=0;for(let t=0;t<s.length;t++){s[t].getComponent(I).IsFilled&&r++}this.colorIndexMap.set(e.toString(),[r,s.length]),this.colorSelect.push(o)}for(let t=1;t<=this.colorIndexMap.size;t++){let e=this.colorIndexMap.get(t.toString());this.totalPixels+=e[1]}console.log(this.totalPixels),console.log(this.colorIndexMap)}onFill(t,e){"ColorBox"===e?this.posCheck(t,this.colorSelect,"ColorBox"):(this.posNodes=this.posNodeMap.get(this.curIndex.toString()),this.posCheck(t,this.posNodes,"PixelBox"))}posCheck(t,e,i,o=0,s=0){let r=this.Target.scale.x,n=this.Target.scale.y;if("IronBox"!==i)for(let l=0;l<e.length;l++){let a=e[l];const h=a.getComponent(C),c=h.width*Math.abs(r),g=h.height*Math.abs(n),p=a.worldPosition.x-c/2,u=a.worldPosition.y-g/2,d=p+c,m=u+g;if(t.x-o/2>p&&t.x+o/2<d&&t.y-s/2>u&&t.y+s/2<m){console.log("正确位置");let t=null;switch(i){case"ColorBox":if(t=a.getComponent(B),this.niezi.isMoving)return void(this.niezi.isFillPos=!1);this.niezi.isFilling||t.Finish||(this.niezi.isFillPos=!0,this.curColor=t.color,this.curIndex=t.colorIndex,this.niezi.startFill(t.color));break;case"PixelBox":t=a.getComponent(I),t.onFill();break;case"IronBox":t=a.getComponent(I),t.onFire()}return}}else{o=200,s=200;for(let i=0;i<e.length;i++){let l=e[i];const a=l.getComponent(C),h=a.width*Math.abs(r),c=a.height*Math.abs(n),g=l.worldPosition.x-h/2,p=l.worldPosition.y-c/2,u=g+h,d=p+c;if(t.x-o/2<g&&t.x+o/2>u&&t.y-s/2<p&&t.y+s/2>d){l.getComponent(I).onFire(),this.iron.showSteam()}}}}fillColor(t){this.isText||this.niezi.onFill();let e=this.colorIndexMap.get(t.toString());if(e[0]++,b.Instance.isFirst&&this.isFirst&&(this.isFirst=!1,p.getScene().emit("八花拼豆_新手教程")),this.curPixel++,this.updateProgress(),e[0]>=e[1]){this.colorSelect[t-1].getComponent(B).isFinish();let e=!0;for(let t=1;t<=this.colorIndexMap.size;t++){let i=this.colorIndexMap.get(t.toString());if(i[0]<i[1]){e=!1;break}}if(e)return this.couldFire=!0,void this.niezi.restart();this.finishColorNum++}}async loadImage(t){if(this.targetImage?console.log("图片存在"):console.log("图片不存在"),this.targetImage){await this.loadImagePixelData(this.targetImage),await this.loadImageFinishData(t);let e=this.Target.position.x-this.widthNum*this.startSize/2,i=this.Target.position.y-this.heightNum*this.startSize/2;this.startPos=c(e,i,0),this.colorCache.clear(),this.preScanColors(),this.colorMap.set(this.curIndex.toString(),new h(0,0,0,0)),this.posNodeMap.set(this.curIndex.toString(),[]),this.curIndex++,await this.createPixel(this.Target)}}async loadImagePixelData(t){return new Promise(((e,i)=>{const o=S.os===S.OS.OPENHARMONY,s=S.os===S.OS.ANDROID;console.log(`当前运行平台: ${S.os}, 是否鸿蒙系统: ${o}, 是否Android: ${s}`);const r=new y;r.image=t;const n=this.readPixels(r);if(n){console.log(n);const t=new Uint8ClampedArray(n.buffer);this.convertTo2DArray(t,r.width,r.height),this.widthNum=r.width,this.heightNum=r.height,e()}}))}async loadImageFinishData(t){return new Promise(((e,i)=>{const o=new y;o.image=t;const s=this.readPixels(o);if(s){console.log(s);const t=new Uint8ClampedArray(s.buffer);this.convertFinishTo2DArray(t,o.width,o.height),e()}}))}findColorIndex(t){const e=`${t.r},${t.g},${t.b},${t.a}`,i=this.colorLookupMap.get(e);if(void 0!==i)return i;for(let i=0;i<this.colorMap.size;i++){const o=this.colorMap.get(i.toString());if(o&&t.r===o.r&&t.g===o.g&&t.b===o.b&&t.a===o.a)return this.colorLookupMap.set(e,i),i}return-1}preScanColors(){const t=new Map,e=new Map;for(let e=0;e<this.heightNum;e++)for(let i=0;i<this.widthNum;i++){const o=this.pixelData2D[e][i],s=`${o.r},${o.g},${o.b},${o.a}`;0!==o.a&&(t.has(s)||t.set(s,{...o}))}for(let t=0;t<this.heightNum;t++)for(let i=0;i<this.widthNum;i++){const o=this.finishData2D[t][i],s=`${o.r},${o.g},${o.b},${o.a}`;0!==o.a&&(e.has(s)||e.set(s,{...o}))}this.preWarmColorCache()}preWarmColorCache(){this.colorLookupMap.clear(),this.colorFinishMap.clear();for(let t=0;t<this.colorMap.size;t++){const e=this.colorMap.get(t.toString());if(e){const i=`${e.r},${e.g},${e.b},${e.a}`;this.colorLookupMap.set(i,t)}}for(let t=0;t<this.finishMap.size;t++){const e=this.finishMap.get(t.toString());if(e){const i=`${e.r},${e.g},${e.b},${e.a}`;this.colorFinishMap.set(i,t)}}}async createPixel(t){this.heightNum,this.widthNum;await this.createPixelsOptimized(t),this.scheduleOnce((()=>{this.initSelectColor(),N.instance.playBGM("游戏场景")}),.1)}async createPixelsOptimized(t){const e=b.Instance.getDataByName(this.curMapID).fillArr;let i=this.heightNum*this.widthNum,o=this.precomputeAllPixelData(),s=this.groupPixelsByColor(o),r=0,n=0;for(const[o,l]of s){for(let o=0;o<l.length;o+=50){let s=l.slice(o,o+50);this.createPixelBatch(t,e,s),r+=s.length,this.isShow||(n=r/i,p.getScene().emit("钻石填色本_加载进度",n)),o+50<l.length&&await new Promise((t=>this.scheduleOnce(t,0)))}i<3400||(i>3400&&n>=.7&&(p.getScene().emit("钻石填色本_加载进度",1),this.isShow=!0),console.log(n))}}precomputeAllPixelData(){const t=[],e=this.PixelPoolCtrl.pixelPrefab.data.getComponent(C),i=this.Target.getChildByName("图片"),o=e.width,s=e.height,r=this.widthNum*o/2,n=this.heightNum*s/2,l=i.position.x-r+10,a=i.position.y-n+10;t.length=this.heightNum*this.widthNum;let c=0,g=null,p=0;for(let e=0;e<this.heightNum;e++){const i=-(a+e*s);for(let s=0;s<this.widthNum;s++){g=this.pixelData2D[e][s];const r=this.tempVec3.set(l+s*o,i,0),n=this.finishData2D[e][s];if(c=this.findColorIndex(g),-1===c&&0!==g.a){c=this.colorMap.size,this.colorMap.set(c.toString(),new h(g.r,g.g,g.b,g.a)),this.posNodeMap.set(c.toString(),[]);const t=g.r+","+g.g+","+g.b+","+g.a;this.colorLookupMap.set(t,c)}t[p]={i:e,j:s,position:r.clone(),grayColor:n,originalColor:g,colorIndex:c},p++}}return t}groupPixelsByColor(t){const e=new Map;for(let i=0;i<t.length;i++){const o=t[i],s=o.grayColor.r+","+o.grayColor.g+","+o.grayColor.b+","+o.grayColor.a;let r=e.get(s);r||(r=[],e.set(s,r)),r.push(o)}return e}createPixelBatch(t,e,i){const o=this.fillNodes,s=this.posNodeMap,r=this.PixelPoolCtrl,n=t.getChildByName("图片");let l=null;for(let t=0;t<i.length;t++){const a=i[t],c=r.getPixelFromPool();c.parent!==n&&c.setParent(n),c.setPosition(a.position),o[o.length]=c;const g=c.getComponent(I);g&&(null!==e?g.initData(a.grayColor,new h(a.originalColor.r,a.originalColor.g,a.originalColor.b,a.originalColor.a),a.colorIndex,e[o.length-1]):g.initData(a.grayColor,new h(a.originalColor.r,a.originalColor.g,a.originalColor.b,a.originalColor.a),a.colorIndex)),l=s.get(a.colorIndex.toString()),l&&(l[l.length]=c),r.usePixel(c)}}convertTo2DArray(t,e,i){this.pixelData2D=new Array(i);for(let o=0;o<i;o++){this.pixelData2D[o]=new Array(e);const i=o*e*4;for(let s=0;s<e;s++){const e=i+4*s;this.pixelData2D[o][s]={r:t[e],g:t[e+1],b:t[e+2],a:t[e+3]}}}}convertFinishTo2DArray(t,e,i){this.finishData2D=new Array(i);for(let o=0;o<i;o++){this.finishData2D[o]=new Array(e);const i=o*e*4;for(let s=0;s<e;s++){const e=i+4*s;this.finishData2D[o][s]={r:t[e],g:t[e+1],b:t[e+2],a:t[e+3]}}}}readPixels(t,e=0,i=0,o,s){const r=t.getGFXTexture();if(!r)return null;o=o||t.width,s=s||t.height;const n=new Uint8Array(o*s*4),l=new w.BufferTextureCopy;l.texExtent.width=o,l.texExtent.height=s,l.texOffset.x=e,l.texOffset.y=i;try{var a;return null==(a=p.root)||a.device.copyTextureToBuffers(r,[n],[l]),n}catch(t){return console.error("读取纹理像素失败:",t),null}}AfinishFill(){this.isText=!0;for(let t=1;t<this.posNodeMap.size;t++){const e=this.posNodeMap.get(t.toString());for(let t=0;t<e.length;t++)e[t].getComponent(I).onTextFill()}this.niezi.nextStep(),this.isText=!1}AfinishFire(){this.isText=!0;for(let t=1;t<this.posNodeMap.size;t++){const e=this.posNodeMap.get(t.toString());for(let t=0;t<e.length;t++)e[t].getComponent(I).onTextFire()}this.isText=!1}}).instance=null,U=e((Z=ot).prototype,"Target",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=e(Z.prototype,"PixelPoolCtrl",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=e(Z.prototype,"colorBoxPrefab",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(Z.prototype,"niezi",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=e(Z.prototype,"iron",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=e(Z.prototype,"SureReturn",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=e(Z.prototype,"processNode",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tt=e(Z.prototype,"courseNode",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),et=e(Z.prototype,"particle",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),it=e(Z.prototype,"winNode",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=Z))||V));o._RF.pop()}}}));

System.register("chunks:///_virtual/BHPD_Iron.ts",["cc","./BHPD_GameMgr.ts"],(function(t){var o,s,e,i,n,c,a,r,h;return{setters:[function(t){o=t.cclegacy,s=t.Component,e=t.Vec3,i=t.ParticleSystem2D,n=t.NodeEventType,c=t.v3,a=t.tween,r=t._decorator},function(t){h=t.BHPD_GameMgr}],execute:function(){var l;o._RF.push({},"42853uBmnNLgaUm0Sbw2LHZ","BHPD_Iron",void 0);const{ccclass:d,property:P}=r;t("BHPD_Iron",d("BHPD_Iron")(l=class extends s{constructor(...t){super(...t),this.steamParticle=null,this.startPos=e.ZERO}start(){this.startPos=this.node.worldPosition.clone(),this.steamParticle=this.node.getChildByName("蒸汽").getComponent(i),this.node.on(n.TOUCH_START,this.touchStart,this),this.node.on(n.TOUCH_MOVE,this.touchMove,this),this.node.on(n.TOUCH_END,this.touchEnd,this)}touchStart(t){const o=c(t.getUILocation().x,t.getUILocation().y);this.node.worldPosition=o}touchMove(t){const o=c(t.getUILocation().x,t.getUILocation().y);this.node.worldPosition=o,h.instance.couldFire&&h.instance.onIronMove(o)}touchEnd(t){this.node.worldPosition=this.startPos,this.closeSteam()}showIron(){a(this.node).to(.5,{position:c(-200,0,0)}).call((()=>{this.startPos=this.node.worldPosition.clone()})).start()}ResetPos(){this.closeSteam(),this.node.worldPosition=c(this.startPos.x,-800,this.startPos.z)}showSteam(){this.steamParticle.node.active||(this.steamParticle.node.active=!0,this.steamParticle.resetSystem())}closeSteam(){this.steamParticle.stopSystem(),this.steamParticle.node.active=!1}})||l);o._RF.pop()}}}));

System.register("chunks:///_virtual/BHPD_Map.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ZSTSB_AudioManager.ts","./UIManager.ts","./ZSTSB_UIGame.ts","./Banner.ts","./ZSTSB_Incident.ts","./BHPD_GameMgr.ts","./BHPD_GameData.ts"],(function(e){var t,a,n,i,s,o,c,r,l,h,d,p,m,g,u,M,S,B,N;return{setters:[function(e){t=e.applyDecoratedDescriptor,a=e.initializerDefineProperty},function(e){n=e.cclegacy,i=e.Node,s=e._decorator,o=e.Component,c=e.ScrollView,r=e.director,l=e.Button,h=e.tween,d=e.v3,p=e.Sprite},function(e){m=e.ZSTSB_AudioManager},function(e){g=e.UIManager},function(e){u=e.ZSTSB_UIGame},function(e){M=e.default},function(e){S=e.ZSTSB_Incident},function(e){B=e.BHPD_GameMgr},function(e){N=e.BHPD_GameData}],execute:function(){var I,f,C,D,_;n._RF.push({},"649550n8jhDcr50FSUdCFsd","BHPD_Map",void 0);const{ccclass:b,property:v}=s;e("BHPD_Map",(I=b("BHPD_Map"),f=v(i),I((_=t((D=class extends o{constructor(...e){super(...e),a(this,"AdNode",_,this),this.mainMapNode=null,this.lockMapName=""}start(){this.mainMapNode=this.node.getChildByName("大地图"),this.refresghMap(),N.Instance.isFirst?this.mainMapNode.getComponent(c).horizontal=!1:this.mainMapNode.getComponent(c).horizontal=!0}update(e){}onBtnClick(e){m.instance.playSFX("按钮");let t=e.target.name;if(t.startsWith("未解锁"))return this.lockMapName=e.target.name,void this.ShowAd(!0);if(t.startsWith("地图")){let e=t.match(/(\d+)$/),a=parseInt(e[1]);return B.instance.level=a,void this.ClickMap(t)}switch(e.target.name){case"返回选图":B.instance.restart(),u.instance.changeMenu("选图界面"),u.instance.hideColorBox(),r.getScene().emit("钻石填色本_开始切换场景"),this.scheduleOnce((()=>{this.mainMapNode.active=!0,N.Instance.isFirst?this.mainMapNode.getComponent(c).horizontal=!1:this.mainMapNode.getComponent(c).horizontal=!0,this.refresghMap()}),.3);break;case"下一关":const e=B.instance.curMapID;let t="";for(let a=0;a<N.Instance.mapData.length;a++)if(e===N.Instance.mapData[a].BuildingName){if(a+1>=N.Instance.mapData.length)return void g.ShowTip("已经是最后一关!");t=N.Instance.mapData[a+1].BuildingName;break}const a=B.instance.level;B.instance.restart(),B.instance.curMapID=t,this.scheduleOnce((()=>{B.instance.level=a+1,u.instance.changeMenu("游戏界面"),B.instance.startGame()}),.2);break;case"返回选择模式":N.DateSave(),B.instance.restart(),u.instance.restartGame(),u.instance.changeMenu("选图界面"),u.instance.hideColorBox(),r.getScene().emit("钻石填色本_开始切换场景"),this.scheduleOnce((()=>{this.mainMapNode.active=!0,N.Instance.isFirst?this.mainMapNode.getComponent(c).horizontal=!1:this.mainMapNode.getComponent(c).horizontal=!0,this.refresghMap(),r.getScene().emit("钻石填色本_加载进度",1)}),.3);break;case"观看广告":M.Instance.ShowVideoAd((()=>{this.ShowAd(!1);let e=this.lockMapName.match(/(\d+)$/),t=parseInt(e[1]);N.Instance.LockArr[t-1]=!0,B.instance.level=t,B.instance.curMapID="地图"+t,console.log(t),this.loadGame()}));break;case"关闭广告":this.ShowAd(!1);break;case"填色按钮":N.Instance.isFirst&&r.getScene().emit("八花拼豆_新手教程"),this.loadGame(),u.instance.hideColorBox();break;case"关闭填色":u.instance.hideColorBox()}}ShowAd(e){let t=this.AdNode.getChildByName("观看广告").getComponent(l),a=this.AdNode.getChildByName("关闭广告").getComponent(l);e?(this.AdNode.active=!0,t.enabled=!1,a.enabled=!1,h(this.AdNode).to(.5,{scale:d(1,1,1)},{easing:"backInOut"}).call((()=>{t.enabled=!0,a.enabled=!0})).start()):(t.enabled=!1,a.enabled=!1,h(this.AdNode).to(.3,{scale:d(0,0,0)},{easing:"backInOut"}).call((()=>{t.enabled=!0,a.enabled=!0,this.AdNode.active=!1})).start())}ClickMap(e){let t=u.instance.ColorBox.getChildByName("图片").getComponent(p);S.LoadSprite("Sprites/八花拼豆/关卡/"+e+"最终").then((a=>{t.spriteFrame=a;const n=N.Instance.getDataByName(e);n&&(n.State?t.grayscale=!1:t.grayscale=!0),B.instance.curMapID=e,u.instance.showColorBox()}))}loadGame(){r.getScene().emit("八花拼豆_进度条图片"),this.scheduleOnce((()=>{u.instance.changeMenu("游戏界面"),B.instance.startGame(),console.error(111)}),.5)}loadMap(e){r.getScene().emit("钻石填色本_开始切换场景"),this.scheduleOnce((()=>{this.mainMapNode.active=!1;let t=e;t.charAt(t.length-1);u.instance.mapBtn.active=!0}),.5)}refresghMap(){this.scheduleOnce((()=>{let e=N.Instance.LockArr,t=this.mainMapNode.getComponent(c).content;for(let a=0;a<e.length;a++){let n=e[a],i=t.children[a+3];n?(i.children[0].active=!1,i.name="地图"+(a+1).toString()):(i.children[0].active=!0,i.name="未解锁"+(a+1).toString())}}),.1)}}).prototype,"AdNode",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=D))||C));n._RF.pop()}}}));

System.register("chunks:///_virtual/BHPD_MoveCtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,o,s,e,n,h,a,r,c,l;return{setters:[function(t){i=t.applyDecoratedDescriptor,o=t.initializerDefineProperty},function(t){s=t.cclegacy,e=t._decorator,n=t.Component,h=t.Vec3,a=t.UITransform,r=t.Node,c=t.director,l=t.v3}],execute:function(){var d,m,u,p,g;s._RF.push({},"ffd4d29u/VE45DRmpTPu4lH","BHPD_MoveCtrl",void 0);const{ccclass:M,property:S}=e;t("BHPD_MoveCtrl",M("BHPD_MoveCtrl")((u=i((m=class extends n{constructor(...t){super(...t),o(this,"minScale",u,this),o(this,"maxScale",p,this),o(this,"zoomSpeed",g,this),this.startPos=new h,this.touchPos=new h,this.originalScale=new h(1,1,1),this.isDragging=!1,this.nodeUITransform=null}start(){this.originalScale.set(this.node.scale),this.nodeUITransform=this.node.getComponent(a),this.node.on(r.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(r.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(r.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(r.EventType.TOUCH_CANCEL,this.onTouchEnd,this),this.node.on(r.EventType.MOUSE_WHEEL,this.onMouseWheel,this),c.getScene().on("八花拼豆_放缩",(t=>{this.onSliderChanged(t)}))}onTouchStart(t){var i;t.getTouches().length>1||(this.isDragging=!0,this.touchPos=l(t.getUILocation().x,t.getUILocation().y),null==(i=this.node.getComponent(a))||i.convertToNodeSpaceAR(this.touchPos,this.startPos))}onTouchMove(t){var i;if(!this.isDragging)return;this.touchPos=l(t.getUILocation().x,t.getUILocation().y),null==(i=this.node.getComponent(a))||i.convertToNodeSpaceAR(this.touchPos,this.touchPos);let o=new h(this.node.position.x+(this.touchPos.x-this.startPos.x),this.node.position.y+(this.touchPos.y-this.startPos.y),this.node.position.z);o=this.clampPositionWithinBounds(o),this.node.setPosition(o)}onTouchEnd(t){this.isDragging=!1}clampPositionWithinBounds(t){if(!this.nodeUITransform)return t;const i=this.nodeUITransform.width,o=this.nodeUITransform.height,s=Math.abs(this.node.scale.x),e=Math.abs(this.node.scale.y),n=this.nodeUITransform.anchorPoint,a=(.5-n.x)*i,r=(.5-n.y)*o,c=i*s/2,l=o*e/2,d=i/2,m=o/2,u=Math.max(0,c-d),p=Math.max(0,l-m),g=Math.min(Math.max(t.x,a-u),a+u),M=Math.min(Math.max(t.y,r-p),r+p);return new h(g,M,t.z)}onSliderChanged(t){const i=1+t,o=new h(this.originalScale.x*i,this.originalScale.y*i,this.originalScale.z*i);this.node.setScale(o);const s=this.node.scale;let e=s.x,n=s.y,a=s.z;e=Math.min(Math.max(Math.abs(e),this.minScale),this.maxScale)*Math.sign(e),n=Math.min(Math.max(Math.abs(n),this.minScale),this.maxScale)*Math.sign(n),a=Math.min(Math.max(Math.abs(a),this.minScale),this.maxScale)*Math.sign(a);let r=new h(this.node.position.x-this.startPos.x,this.node.position.y-this.startPos.y,this.node.position.z);r=this.clampPositionWithinBounds(r),this.node.setPosition(r)}onMouseWheel(t){const i=1+(t.getScrollY()>0?this.zoomSpeed:-this.zoomSpeed),o=this.node.scale;let s=o.x*i,e=o.y*i,n=o.z*i;s=Math.min(Math.max(Math.abs(s),this.minScale),this.maxScale)*Math.sign(s),e=Math.min(Math.max(Math.abs(e),this.minScale),this.maxScale)*Math.sign(e),n=Math.min(Math.max(Math.abs(n),this.minScale),this.maxScale)*Math.sign(n),this.node.setScale(s,e,n);let a=new h(this.node.position.x-this.startPos.x,this.node.position.y-this.startPos.y,this.node.position.z);a=this.clampPositionWithinBounds(a),this.node.setPosition(a)}}).prototype,"minScale",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),p=i(m.prototype,"maxScale",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),g=i(m.prototype,"zoomSpeed",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),d=m))||d);s._RF.pop()}}}));

System.register("chunks:///_virtual/BHPD_Niezi.ts",["cc","./BHPD_GameMgr.ts","./BHPD_GameData.ts","./ZSTSB_AudioManager.ts","./UIManager.ts"],(function(i){var t,s,o,l,e,h,n,r,c,a,d,u,F;return{setters:[function(i){t=i.cclegacy,s=i.Component,o=i.Color,l=i.v3,e=i.Sprite,h=i.NodeEventType,n=i.director,r=i.tween,c=i._decorator},function(i){a=i.BHPD_GameMgr},function(i){d=i.BHPD_GameData},function(i){u=i.ZSTSB_AudioManager},function(i){F=i.UIManager}],execute:function(){var g;t._RF.push({},"67ec2BC/oVFFZ/BXC9UMKNh","BHPD_Niezi",void 0);const{ccclass:p,property:x}=c;i("BHPD_Niezi",p("BHPD_Niezi")(g=class extends s{constructor(...i){super(...i),this.maxFill=10,this.curFill=0,this.preColor=o.WHITE,this.curColor=new o,this.isFilling=!1,this.isFillPos=!1,this.isTruePos=!1,this.circleNode=null,this.circleSprite=null,this.fillBox=[],this.startPos=l(0,0,0),this.couldMove=!0,this.isMoving=!1,this.isFillEndless=!1,this.isFirst=!0,this.isNextStep=!1}start(){this.fillBox=this.node.children,this.circleNode=this.node.getChildByName("白圈"),this.circleSprite=this.circleNode.getComponent(e),console.log(this.circleNode),console.log(this.fillBox),this.node.on(h.TOUCH_START,this.touchStart,this),this.node.on(h.TOUCH_MOVE,this.touchMove,this),this.node.on(h.TOUCH_END,this.touchEnd,this),this.startPos=this.node.worldPosition.clone()}touchStart(i){if(!this.couldMove)return;const t=l(i.getUILocation().x,i.getUILocation().y);this.node.worldPosition=t,this.isNextStep}touchMove(i){if(!this.couldMove)return;const t=l(i.getUILocation().x,i.getUILocation().y,0);if(this.node.worldPosition=t,this.isNextStep)return;this.isMoving=!0;const s=this.circleNode.worldPosition;this.curFill>0&&!this.isFilling&&a.instance.onFill(s,"PixelBox"),this.curFill<=this.maxFill&&a.instance.onFill(s,"ColorBox")}touchEnd(i){if(!this.couldMove)return;if(this.isMoving=!1,this.isNextStep)return void this.nextStep();const t=this.circleNode.worldPosition;this.curFill<=this.maxFill&&a.instance.onFill(t,"ColorBox")}onFill(){this.isFillEndless||(this.curFill--,this.fillBox[this.curFill+1].active=!1,this.curFill<=0&&(this.circleNode.active=!1))}fillText(){this.isFillEndless=!this.isFillEndless,F.ShowTip("是否无限填充： "+this.isFillEndless)}startFill(i){if(!this.isFilling){d.Instance.isFirst&&this.isFirst&&(this.isFirst=!1,n.getScene().emit("八花拼豆_新手教程")),this.isFilling=!0,this.preColor!=i&&this.Clear(),this.circleSprite.color=i,this.circleNode.active=!0,this.curColor=i,a.instance.curColor=i;for(let t=1;t<this.fillBox.length;t++)this.fillBox[t].getComponent(e).color=i;this.schedule(this.addFilling,.1)}}addFilling(){if(!this.isFillPos)return this.isFilling=!1,this.preColor=this.curColor,void this.stopFill();this.fillBox[this.curFill+1].active=!0,this.curFill++,u.instance.playSFX("吸附"),this.curFill>=this.maxFill&&(this.isFilling=!1,a.instance.isFilling=!1,this.stopFill())}stopFill(){console.log("取消填充"),this.unschedule(this.addFilling)}nextStep(){this.ResetPos(),this.HideNiezi(),this.isNextStep=!1,a.instance.iron.showIron()}HideNiezi(){this.couldMove=!1,r(this.node).to(.5,{position:l(-150,-800,0)}).call((()=>{this.couldMove=!0})).start()}Clear(){for(let i=1;i<this.fillBox.length;i++)this.fillBox[i].active=!1;this.curFill=0,this.circleNode.active=!1}restart(){this.Clear(),this.isNextStep=!0}ResetPos(){this.Clear(),this.isNextStep=!1,this.node.worldPosition=this.startPos}})||g);t._RF.pop()}}}));

System.register("chunks:///_virtual/BHPD_Pixel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BHPD_GameMgr.ts","./ZSTSB_AudioManager.ts"],(function(i){var e,t,s,l,r,o,n,h,c,a,p;return{setters:[function(i){e=i.applyDecoratedDescriptor,t=i.initializerDefineProperty},function(i){s=i.cclegacy,l=i.SpriteFrame,r=i._decorator,o=i.Component,n=i.Color,h=i.Sprite,c=i.Label},function(i){a=i.BHPD_GameMgr},function(i){p=i.ZSTSB_AudioManager}],execute:function(){var d,u,F,C,g;s._RF.push({},"e842dJbrc1PC4D+uW6yFdO4","BHPD_Pixel",void 0);const{ccclass:x,property:b}=r;i("BHPD_Pixel",(d=x("BHPD_Pixel"),u=b(l),d((g=e((C=class extends o{constructor(...i){super(...i),t(this,"mask",g,this),this.colorIndex=0,this.pixelColor=new n,this.finishColor=new n,this.sprite=null,this.circleSprite=null,this.colorLabel=null,this.isFilled=!1,this.isFinish=!1,this.showIndex=5,this.isFirst=!0,this.blackColor=new n(1,1,1,255)}get ColorIndex(){return this.colorIndex}get IsFilled(){return this.isFilled}get IsFinish(){return this.isFinish}initData(i,e,t,s){if(this.colorIndex=t,this.sprite=this.node.getComponent(h),this.colorLabel=this.node.getChildByName("数字").getComponent(c),this.circleSprite=this.node.getChildByName("Circle").getComponent(h),0===e.a)return this.pixelColor=new n(255,255,255,255),this.sprite.color=new n(255,255,255,255),this.isFinish=!0,this.isFilled=!0,void(this.colorLabel.string="");if(this.pixelColor=e,this.colorLabel.string=t.toString(),this.finishColor=new n(i.r,i.g,i.b,i.a),s)this.Filled();else{let i=this.pixelColor;this.sprite.color=new n(i.r,i.g,i.b,i.a),this.circleSprite.color=new n(i.r,i.g,i.b,i.a),this.circleSprite.node.active=!1}}onFill(){if(this.isFilled)return;let i=a.instance.curColor;if(this.pixelColor.r===i.r&&this.pixelColor.g===i.g&&this.pixelColor.b===i.b&&this.pixelColor.a===i.a){this.isFilled=!0;let e=this.pixelColor;0===i.r&&0===i.g&&0===i.b&&(e=this.blackColor),this.circleSprite.node.active=!0,this.colorLabel.string="",p.instance.playSFX("填涂"),a.instance.fillColor(this.colorIndex)}}onTextFill(){this.isFilled=!0,this.circleSprite.node.active=!0,this.colorLabel.string="",p.instance.playSFX("填涂"),a.instance.fillColor(this.colorIndex)}onFire(){this.isFinish||(this.isFinish=!0,this.sprite.color=this.finishColor,this.circleSprite.node.active=!1,p.instance.playIron(),a.instance.onFire())}onTextFire(){this.isFinish=!0,this.sprite.color=this.finishColor,this.circleSprite.node.active=!1,p.instance.playIron(),a.instance.onFire()}Filled(){this.isFilled=!0;let i=this.pixelColor;0===i.r&&0===i.g&&0===i.b&&255===i.a&&(i=this.blackColor),this.sprite.color=i}reset(){this.isFilled=!1,this.isFinish=!1,this.circleSprite.node.active=!1,this.sprite.color=n.WHITE,this.pixelColor=n.WHITE}}).prototype,"mask",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=C))||F));s._RF.pop()}}}));

System.register("chunks:///_virtual/BHPD_PixelPool.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BHPD_Pixel.ts","./BHPD_GameMgr.ts"],(function(e){var t,i,s,l,o,n,r,h,P,c,p,a;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.initializerDefineProperty},function(e){s=e.cclegacy,l=e.Prefab,o=e._decorator,n=e.Component,r=e.instantiate,h=e.director,P=e.v3,c=e.Color},function(e){p=e.BHPD_Pixel},function(e){a=e.BHPD_GameMgr}],execute:function(){var u,x,g,f,d;s._RF.push({},"b6bbbD0OiFC/re8teDfOhxk","BHPD_PixelPool",void 0);const{ccclass:m,property:y}=o;e("BHPD_PixelPool",(u=m("BHPD_PixelPool"),x=y(l),u((d=t((f=class extends n{constructor(...e){super(...e),i(this,"pixelPrefab",d,this),this.pixelPool=[],this.usedPixels=[],this.spritePool=[],this.usedSprites=[],this.totalPixels=0,this.finishPixels=0}start(){this.CreatePixels(800),a.instance.isPoolInit=!0}async CreatePixels(e){const t=a.instance.Target.getChildByName("图片");let i=0;for(let s=0;s<e;s+=50){const l=Math.min(50,e-s),o=new Array(l),n=new Array(l);for(let s=0;s<l;s++){const l=r(this.pixelPrefab);l.setParent(t),o[s]=l,i++;let n=i/e;h.getScene().emit("钻石填色本_加载进度",n)}this.pixelPool.push(...o),this.spritePool.push(...n),s+50<e&&await new Promise((e=>setTimeout(e,.05)))}console.log(`对象池初始化完成，总共创建 ${e} 个像素节点`)}getPixelFromPool(){if(this.pixelPool.length>0)return this.pixelPool.pop();return r(this.pixelPrefab)}usePixel(e){this.usedPixels.push(e)}useSprite(e){this.usedSprites.push(e)}loading(){this.totalPixels=Array.from(this.usedPixels).length}recyclePixel(){const e=2e3,t=()=>{const i=this.usedPixels.splice(0,Math.min(50,this.usedPixels.length)),s=this.usedSprites.splice(0,Math.min(50,this.usedSprites.length));console.log(this.usedPixels);for(let e=0;e<i.length;e++){const t=i[e];t.position=P(0,0,0);const s=t.getComponent(p);s&&s.reset()}for(let e=0;e<s.length;e++){s[e].color=c.WHITE}if(this.pixelPool.length<e){const t=e-this.pixelPool.length,l=Math.min(i.length,t);this.pixelPool.push(...i.slice(0,l));const o=Math.min(s.length,t);this.spritePool.push(...s.slice(0,o));for(let e=l;e<i.length;e++)i[e].destroy();for(let e=o;e<s.length;e++)s[e].node.destroy()}else{for(let e=0;e<i.length;e++)i[e].destroy();for(let e=0;e<s.length;e++)s[e].node.destroy()}if(this.finishPixels+=Math.min(i.length,e),this.totalPixels>0){const e=this.finishPixels/this.totalPixels;h.getScene().emit("钻石填色本_加载进度",e)}this.usedPixels.length>0||this.usedSprites.length>0?setTimeout(t,0):(console.log("对象池回收完成"),this.finishPixels=0)};t()}preloadPixels(e){for(let t=0;t<e;t++){const e=r(this.pixelPrefab);this.pixelPool.push(e)}}getPoolSize(){return this.pixelPool.length}}).prototype,"pixelPrefab",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=f))||g));s._RF.pop()}}}));

System.register("chunks:///_virtual/BHPD_ScaleSlider.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BHPD_GameMgr.ts","./ZSTSB_Incident.ts"],(function(e){var r,s,t,i,o,n,l,a,p,c,d,g;return{setters:[function(e){r=e.applyDecoratedDescriptor,s=e.initializerDefineProperty},function(e){t=e.cclegacy,i=e.ProgressBar,o=e.Slider,n=e._decorator,l=e.Component,a=e.director,p=e.Sprite,c=e.UITransform},function(e){d=e.BHPD_GameMgr},function(e){g=e.ZSTSB_Incident}],execute:function(){var h,u,S,B,m,_,f;t._RF.push({},"0149d1auk9NmoAKxTKZO8tO","BHPD_ScaleSlider",void 0);const{ccclass:D,property:M}=n;e("BHPD_ScaleSlider",(h=D("BHPD_ScaleSlider"),u=M(i),S=M(o),h((_=r((m=class extends l{constructor(...e){super(...e),s(this,"progressBar",_,this),s(this,"slider",f,this),this.preMapName=""}start(){a.getScene().on("八花拼豆_进度条图片",this.changeSliderSprite,this),this.slider&&this.progressBar&&(this.slider.progress=0,this.progressBar.progress=this.slider.progress)}changeSliderSprite(){let e=this.slider.node.getChildByName("Handle");e.getComponent(p).sizeMode=p.SizeMode.TRIMMED;const r=d.instance.curMapID;if(this.preMapName===r)return;const s="Sprites/八花拼豆/关卡/"+r+"最终";g.LoadSprite(s).then((s=>{e.getComponent(p).spriteFrame=s;let t=e.getComponent(c);t.width=t.width/4,t.height=t.height/4,this.preMapName=r}))}onSliderChanged(){console.log("改变Slider的值",this.slider.progress),this.progressBar&&(this.progressBar.progress=this.slider.progress,a.getScene().emit("八花拼豆_放缩",this.slider.progress))}setProgress(e){this.slider&&(this.slider.progress=e),this.progressBar&&(this.progressBar.progress=e)}}).prototype,"progressBar",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=r(m.prototype,"slider",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=m))||B));t._RF.pop()}}}));

System.register("chunks:///_virtual/BHPD_TouchCtrl.ts",["cc"],(function(t){var c,r,e;return{setters:[function(t){c=t.cclegacy,r=t.Component,e=t._decorator}],execute:function(){var o;c._RF.push({},"66157IcvmxBa4PeHq+uOrxn","BHPD_TouchCtrl",void 0);const{ccclass:s,property:u}=e;t("BHPD_TouchCtrl",s("BHPD_TouchCtrl")(o=class extends r{start(){}update(t){}})||o);c._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_AudioManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var t,e,o,s,n,r,a;return{setters:[function(i){t=i.applyDecoratedDescriptor,e=i.initializerDefineProperty},function(i){o=i.cclegacy,s=i.AudioClip,n=i._decorator,r=i.Component,a=i.AudioSource}],execute:function(){var l,u,p,c,d,h;o._RF.push({},"d88068OQLRKz7ohJgDVI951","ZSTSB_AudioManager",void 0);const{ccclass:f,property:g}=n;i("ZSTSB_AudioManager",(l=f("ZSTSB_AudioManager"),u=g({type:[s]}),l(((h=class i extends r{constructor(...i){super(...i),e(this,"clips",d,this),this.sfxAudio=null,this.bgmAudio=null}start(){i.instance=this,this.sfxAudio=this.node.getChildByName("sfxAudio").getComponent(a),this.bgmAudio=this.node.getChildByName("bgmAudio").getComponent(a),this.bgmAudio.play()}playSFX(i){for(let t of this.clips)if(t.name===i){this.sfxAudio.playOneShot(t);break}}playBGM(i){this.bgmAudio.stop();for(let t of this.clips)if(t.name===i){this.bgmAudio.clip=t,this.bgmAudio.play();break}}playIron(){for(let i of this.clips)if("熨斗"===i.name&&!this.sfxAudio.playing){this.sfxAudio.clip=i,this.sfxAudio.play();break}}}).instance=null,d=t((c=h).prototype,"clips",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),p=c))||p));o._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_Cloud.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,e,s,o,n,r,l;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.initializerDefineProperty},function(t){s=t.cclegacy,o=t._decorator,n=t.Component,r=t.v3,l=t.tween}],execute:function(){var a,c,u,h,p,d,f;s._RF.push({},"3de22fCgRRLTZRG5WmB6Mxg","ZSTSB_Cloud",void 0);const{ccclass:g,property:S}=o;t("ZSTSB_Cloud",(a=g("ZSTSB_Cloud"),c=S(),u=S(),a((d=i((p=class extends n{constructor(...t){super(...t),e(this,"x",d,this),e(this,"y",f,this),this.startPos=r(0,0,0),this.sign=1}start(){this.startPos=this.node.position.clone()}onEnable(){this.moveSelf()}onDisable(){l(this.node).stop(),this.node.position=this.startPos}moveSelf(){l(this.node).by(1,{position:r(this.x*this.sign,this.y*this.sign,0)}).call((()=>{this.sign=-this.sign,this.moveSelf()})).start()}}).prototype,"x",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),f=i(p.prototype,"y",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),h=p))||h));s._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_Course.ts",["cc","./ZSTSB_AudioManager.ts","./ZSTSB_GameData.ts"],(function(e){var t,i,n,s,o,c,r;return{setters:[function(e){t=e.cclegacy,i=e.Component,n=e.NodeEventType,s=e.director,o=e._decorator},function(e){c=e.ZSTSB_AudioManager},function(e){r=e.ZSTSB_GameData}],execute:function(){var a;t._RF.push({},"d7ce82NfZtNlZ7ypo2GLf1v","ZSTSB_Course",void 0);const{ccclass:d,property:h}=o;e("ZSTSB_Course",d("ZSTSB_Course")(a=class extends i{constructor(...e){super(...e),this.index=0,this.isFirst=!0}onEnable(){this.node.on(n.TOUCH_END,this.onClick,this)}onClick(){console.log("下一步教程"),c.instance.playSFX("按钮");let e=this.node.children.length;if(this.index++,this.index>=e)return this.index=0,this.node.children[e-1].active=!1,this.node.children[this.index].active=!0,this.node.active=!1,this.node.off(n.TOUCH_END,this.onClick,this),void(r.Instance.isGameFirst&&(r.Instance.isGameFirst=!1,s.getScene().emit("钻石填色本_新手教程结束")));this.node.children[this.index-1].active=!1,this.node.children[this.index].active=!0}})||a);t._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_FillColor.ts",["cc","./ZSTSB_GameMgr.ts","./ZSTSB_AudioManager.ts"],(function(o){var e,t,n,i,l,s,r,c,h,d;return{setters:[function(o){e=o.cclegacy,t=o.Component,n=o.Color,i=o.Label,l=o.Sprite,s=o.NodeEventType,r=o.director,c=o._decorator},function(o){h=o.ZSTSB_GameMgr},function(o){d=o.ZSTSB_AudioManager}],execute:function(){var a;e._RF.push({},"6d4ceiAH09JsKjmI6DFYxRm","ZSTSB_FillColor",void 0);const{ccclass:S,property:u}=c;o("ZSTSB_FillColor",S("ZSTSB_FillColor")(a=class extends t{constructor(...o){super(...o),this.colorIndex=0,this.colorIndexLabel=null,this.colorValue=new n,this.colorValueSprite=null}initData(o,e){this.colorIndexLabel=this.node.getChildByName("Label").getComponent(i),this.colorValueSprite=this.node.children[0].getComponent(l),this.colorIndex=e,this.colorValue=o,this.colorIndexLabel.string=e.toString(),this.colorValueSprite.color=o,1===this.colorIndex&&(h.instance.selectNode.worldPosition=this.node.worldPosition),this.node.on(s.TOUCH_END,this.onTouchEnd,this),r.getScene().on("钻石填色本_颜色填充完毕",(o=>{this.onColorFilled(o)}),this)}onTouchEnd(o){h.instance.SelectColor(),h.instance.SwitchColorNodes(this.colorValue),h.instance.selectNodeRoot=this.node,d.instance.playSFX("按钮")}onDestroy(){this.node.off(s.TOUCH_END,this.onTouchEnd,this),r.getScene().off("钻石填色本_颜色填充完毕",this.onColorFilled,this)}onColorFilled(o){this.colorIndex==o&&(this.colorIndexLabel.string="",this.node.getChildByName("完成").active=!0,this.node.off(s.TOUCH_END,this.onTouchEnd,this))}})||a);e._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_FirstCourse.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ZSTSB_GameData.ts","./ZSTSB_AudioManager.ts","./ZSTSB_GameMgr.ts"],(function(e){var t,i,s,r,n,a,o,c,l,h,d,u,S,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.initializerDefineProperty},function(e){s=e.cclegacy,r=e.Node,n=e._decorator,a=e.Component,o=e.NodeEventType,c=e.director,l=e.tween,h=e.v3,d=e.Button},function(e){u=e.ZSTSB_GameData},function(e){S=e.ZSTSB_AudioManager},function(e){g=e.ZSTSB_GameMgr}],execute:function(){var p,_,f,C,y,T,m;s._RF.push({},"32908CTTClKfLDczAyt3xUy","ZSTSB_FirstCourse",void 0);const{ccclass:v,property:B}=n;e("ZSTSB_FirstCourse",(p=v("ZSTSB_FirstCourse"),_=B({type:[r]}),f=B(r),p((T=t((y=class extends a{constructor(...e){super(...e),i(this,"courseNodes",T,this),i(this,"reward",m,this),this.index=0,this.airWall=null}start(){if(u.Instance.isGameFirst){this.airWall=g.instance.AirWall;for(let e=0;e<this.courseNodes.length;e++)this.courseNodes[e].once(o.TOUCH_END,this.onClick,this);c.getScene().on("钻石填色本_新手教程",this.onClick,this),c.getScene().once("钻石填色本_新手教程结束",this.FinishCourse,this)}else this.node.destroy()}onClick(){this.index++,this.airWall.active=!0,console.log("点击了",this.index),this.node.children[this.index-1].active=!1,this.index>=this.node.children.length?this.airWall.active=!1:this.scheduleOnce((()=>{this.node.children[this.index]&&(this.node.children[this.index].active=!0),this.airWall.active=!1}),.3)}FinishCourse(){this.reward.active=!0,l(this.reward).to(.5,{scale:h(1,1,1)},{easing:"backOut"}).start()}getReward(){c.getScene().off("钻石填色本_新手教程"),S.instance.playSFX("按钮"),this.reward.getChildByName("领取").getComponent(d).enabled=!1,l(this.reward).to(.5,{scale:h(0,0,0)},{easing:"backOut"}).call((()=>{this.reward.active=!1})).start(),c.getScene().emit("钻石填色本_获得道具","消除当前数字索引",10),u.Instance.isGameFirst=!1}}).prototype,"courseNodes",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),m=t(y.prototype,"reward",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=y))||C));s._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_GameData.ts",["cc"],(function(a){var i,t,l;return{setters:[function(a){i=a.cclegacy,t=a._decorator,l=a.sys}],execute:function(){var e,r;i._RF.push({},"510a1++PU5KcIqAZfsitT4L","ZSTSB_GameData",void 0);const{ccclass:n,property:p}=t;a("ZSTSB_GameData",n("ZSTSB_GameData")(((r=class a{constructor(){this.mapLockArr=[!0,!1,!1,!1,!1],this.isMapFirst=!0,this.isGameFirst=!0,this.isFillFirst=!1,this.mapData=[{MapID:1,BuildingName:"1-1",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-2",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-3",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-10",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-4",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-5",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-11",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-6",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-7",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-14",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-12",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-8",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-9",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-13",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-101",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-10",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-2",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-71",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-7",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-1",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-4",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-5",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-3",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-31",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-32",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-6",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-8",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-81",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-82",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-83",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-9",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-91",State:!1,fillArr:[]},{MapID:3,BuildingName:"3-4",State:!1,fillArr:[]},{MapID:3,BuildingName:"3-5",State:!1,fillArr:[]},{MapID:3,BuildingName:"3-6",State:!1,fillArr:[]},{MapID:3,BuildingName:"3-7",State:!1,fillArr:[]},{MapID:3,BuildingName:"3-1",State:!1,fillArr:[]},{MapID:3,BuildingName:"3-2",State:!1,fillArr:[]},{MapID:3,BuildingName:"3-3",State:!1,fillArr:[]},{MapID:3,BuildingName:"3-8",State:!1,fillArr:[]},{MapID:3,BuildingName:"3-9",State:!1,fillArr:[]},{MapID:3,BuildingName:"3-10",State:!1,fillArr:[]},{MapID:3,BuildingName:"3-11",State:!1,fillArr:[]},{MapID:3,BuildingName:"3-12",State:!1,fillArr:[]},{MapID:3,BuildingName:"3-13",State:!1,fillArr:[]},{MapID:3,BuildingName:"3-14",State:!1,fillArr:[]},{MapID:3,BuildingName:"3-15",State:!1,fillArr:[]},{MapID:4,BuildingName:"4-1",State:!1,fillArr:[]},{MapID:4,BuildingName:"4-2",State:!1,fillArr:[]},{MapID:4,BuildingName:"4-8",State:!1,fillArr:[]},{MapID:4,BuildingName:"4-4",State:!1,fillArr:[]},{MapID:4,BuildingName:"4-5",State:!1,fillArr:[]},{MapID:4,BuildingName:"4-3",State:!1,fillArr:[]},{MapID:4,BuildingName:"4-6",State:!1,fillArr:[]},{MapID:4,BuildingName:"4-9",State:!1,fillArr:[]},{MapID:4,BuildingName:"4-10",State:!1,fillArr:[]},{MapID:4,BuildingName:"4-7",State:!1,fillArr:[]},{MapID:4,BuildingName:"4-11",State:!1,fillArr:[]},{MapID:5,BuildingName:"5-1",State:!1,fillArr:[]},{MapID:5,BuildingName:"5-2",State:!1,fillArr:[]},{MapID:5,BuildingName:"5-8",State:!1,fillArr:[]},{MapID:5,BuildingName:"5-5",State:!1,fillArr:[]},{MapID:5,BuildingName:"5-6",State:!1,fillArr:[]},{MapID:5,BuildingName:"5-10",State:!1,fillArr:[]},{MapID:5,BuildingName:"5-7",State:!1,fillArr:[]},{MapID:5,BuildingName:"5-3",State:!1,fillArr:[]},{MapID:5,BuildingName:"5-4",State:!1,fillArr:[]},{MapID:5,BuildingName:"5-9",State:!1,fillArr:[]}],this.propData=[{PropName:"消除当前数字索引",PropNum:10}],this.BuildingMap={},this.TimeDate=[]}static getShowNumByName(a){return this.startShowData.get(a)??null}getMapDataByID(a){return this.mapData.filter((i=>i.MapID===a)).map((({MapID:a,BuildingName:i,State:t})=>({MapID:a,BuildingName:i,State:t})))}getMapDataByName(a,i){const t=this.mapData.find((t=>t.MapID===a&&t.BuildingName===i));return{MapID:t.MapID,BuildingName:t.BuildingName,State:t.State}}getBuildingData(a,i){const t=a+i;return this.BuildingMap[t]||null}setBuildingData(a,i,t){for(let l of this.mapData)if(l.MapID===a&&l.BuildingName===i){l.State=t;break}}saveBuildingData(a,i,t){const l=this.mapData.find((t=>t.MapID===a&&t.BuildingName===i)),e=a+i;if(!t)return delete this.BuildingMap[e],void(l.State=!0);l&&(l.fillArr=t,this.BuildingMap[e]=t)}getPropByName(a){for(let i=0;i<this.propData.length;i++)if(this.propData[i].PropName===a)return this.propData[i].PropNum;return null}pushPropByName(a,i){for(let t=0;t<this.propData.length;t++)if(this.propData[t].PropName===a)return this.propData[t].PropNum+=i,console.log("添加道具"+this.propData[t].PropName+"成功"),!0;return console.log("获得道具失败"),null}subPropByName(a,i){for(let t=0;t<this.propData.length;t++)if(this.propData[t].PropName===a&&this.propData[t].PropNum>=0)return this.propData[t].PropNum-=i,console.log("移除道具"+this.propData[t].PropName+"成功"),!0;return console.log("道具移除失败"),null}static get Instance(){return a.instance||this.ReadDate(),a.instance}static DateSave(){let i=JSON.stringify(a.Instance);l.localStorage.setItem("ZSTSB_DATA",i),console.log("游戏存档")}static ReadDate(){let i=l.localStorage.getItem("ZSTSB_DATA");""!=i&&null!=i?(console.log("读取存档"),a.instance=Object.assign(new a,JSON.parse(i))):(console.log("新建存档"),a.instance=new a)}}).isText=!1,r.startShowData=new Map([["1-1",5],["1-2",3],["1-3",5],["1-4",3],["1-5",5],["1-6",3],["1-7",5],["1-8",3],["1-9",5],["1-10",5],["1-11",5],["1-12",5],["1-13",3],["1-14",5],["2-1",5],["2-2",5],["2-3",5],["2-31",3],["2-32",5],["2-4",5],["2-5",5],["2-6",5],["2-7",3],["2-71",3],["2-8",3],["2-81",3],["2-82",3],["2-83",3],["2-9",3],["2-91",3],["2-10",3],["2-101",3],["3-1",3],["3-2",3],["3-3",3],["3-4",3],["3-5",3],["3-6",2],["3-7",2],["3-8",5],["3-9",3],["3-10",3],["3-11",5],["3-12",3],["3-13",3],["3-14",5],["3-15",3],["4-1",5],["4-2",5],["4-3",5],["4-4",3],["4-5",3],["4-6",5],["4-7",5],["4-8",3],["4-9",3],["4-10",5],["4-11",5],["5-1",5],["5-2",5],["5-3",5],["5-4",5],["5-5",4],["5-6",4],["5-7",3],["5-8",5],["5-9",5],["5-10",5]]),r.instance=null,e=r))||e);i._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_GameMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ZSTSB_Pixel.ts","./ZSTSB_Incident.ts","./ZSTSB_FillColor.ts","./ZSTSB_GameData.ts","./ZSTSB_AudioManager.ts","./ZSTSB_PixelPool.ts","./ZSTSB_ParticlePool.ts","./ProjectEventManager.ts","./UIManager.ts"],(function(t){var e,i,o,s,l,r,n,a,h,c,g,p,u,d,C,m,f,x,P,S,N,I,M,w,y,D,B,b,T,v,F,_;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){o=t.cclegacy,s=t.Prefab,l=t.Node,r=t.Label,n=t._decorator,a=t.Component,h=t.v3,c=t.Color,g=t.Vec3,p=t.director,u=t.ScrollView,d=t.Sprite,C=t.tween,m=t.ParticleSystem2D,f=t.UITransform,x=t.instantiate,P=t.NodeEventType,S=t.sys,N=t.Texture2D,I=t.gfx},function(t){M=t.ZSTSB_Pixel},function(t){w=t.ZSTSB_Incident},function(t){y=t.ZSTSB_FillColor},function(t){D=t.ZSTSB_GameData},function(t){B=t.ZSTSB_AudioManager},function(t){b=t.ZSTSB_PixelPool},function(t){T=t.ZSTSB_ParticlePool},function(t){v=t.ProjectEventManager,F=t.ProjectEvent},function(t){_=t.UIManager}],execute:function(){var k,A,L,z,U,O,W,$,Z,G,E,R,j,V,H,X,Y,q;o._RF.push({},"17f682HrNVFN68j9CDUfYr5","ZSTSB_GameMgr",void 0);const{ccclass:J,property:K}=n;t("ZSTSB_GameMgr",(k=J("ZSTSB_GameMgr"),A=K(b),L=K(T),z=K(s),U=K(l),O=K(l),W=K(l),$=K(r),k(((q=class t extends a{constructor(...t){super(...t),i(this,"PixelPoolCtrl",E,this),i(this,"ParticlePoolCtrl",R,this),i(this,"colorBoxPrefab",j,this),i(this,"selectNode",V,this),i(this,"ControlNode",H,this),i(this,"Target",X,this),i(this,"CurModeLabel",Y,this),this.AirWall=null,this.CourseNode=null,this.selectNodeRoot=null,this.targetImage=null,this.startPos=h(250,0,0),this.curMapID=0,this.curBuildingName="",this.curColor=new c(211,249,188,255),this.curColorIndex=1,this.preColorIndex=-1,this.fillNodes=[],this.posNodes=[],this.isPoolInit=!1,this.isFirstFill=!0,this.isUseProp=!1,this.isLock=!1,this.pixelData2D=[],this.LockBtn=null,this.isFirstCourse=!0,this.winNode=null,this.isFirstProp=!0,this.isTruePos=!1,this.isUsingPorp=!1,this.propBoxTs=null,this.propName="",this.finishColorNum=4,this.isCamMove=!1,this.curBox=null,this.colorIndexMap=new Map,this.colorSelect=[],this.isFirst=!1,this.startSize=10,this.curIndex=0,this.colorMap=new Map,this.posNodeMap=new Map,this.colorCache=new Map,this.colorLookupMap=new Map,this.isCreatingPixels=!1,this.isShow=!1,this.tempVec3=new g,this.widthNum=0,this.heightNum=0}start(){t.instance=this,D.isText?this.node.getChildByName("测试").active=!0:this.node.getChildByName("测试").active=!1,D.Instance.isMapFirst?p.getScene().getChildByPath("Canvas/钻石填色/首次教程").active=!0:p.getScene().getChildByPath("Canvas/钻石填色/首次教程").active=!1,this.LockBtn=this.ControlNode.getChildByName("锁定视角"),this.winNode=this.ControlNode.getChildByName("完成"),this.CourseNode=this.ControlNode.getChildByName("教程"),this.AirWall=this.node.getChildByName("阻挡墙"),v.emit(F.游戏开始)}startGame(){let t="Sprites/关卡/"+("关卡"+this.curMapID)+"/"+this.curBuildingName;w.LoadImageAsset(t).then((t=>{console.log("开始加载游戏"),this.CurModeLabel.string="当前模式：解锁视角\n双指缩放,单指拖拽或填涂\n不可单指拖拽批量填涂",this.targetImage=t,this.AirWall.active=!0,this.SelectColor(),p.getScene().emit("钻石填色本_初始化游戏"),this.loadImage(),p.getScene().on("钻石填色本_开始填色",(t=>{this.onFill(t)}),this),p.getScene().on("钻石填色本_结束填色",(()=>{this.isTruePos&&(this.isTruePos=!1,this.useProp())}),this)}))}SelectColor(){this.selectNode.parent=this.ControlNode.getChildByName("左区").getChildByName("填色").getComponent(u).view.node,this.selectNode.setSiblingIndex(0)}SelectProp(){this.selectNode.parent=this.ControlNode}onBtnClick(t){switch(B.instance.playSFX("按钮"),t.target.name){case"锁定视角":this.isLock=!this.isLock,D.Instance.isGameFirst&&p.getScene().emit("钻石填色本_新手教程");let e=t.target.getComponent(d);this.isLock?(e.color=new c(255,255,255,255),_.ShowTip("锁定视角"),this.CurModeLabel.string="当前模式：锁定视角\n双指缩放移动,单指填涂\n可单指拖拽批量填涂"):(e.color=new c(255,255,255,150),_.ShowTip("解锁视角"),this.CurModeLabel.string="当前模式：解锁视角\n双指缩放,单指拖拽或填涂\n不可单指拖拽批量填涂");break;case"教程按钮":this.CourseNode.active=!0,D.Instance.isGameFirst&&this.isFirstCourse&&(this.isFirstCourse=!1,p.getScene().emit("钻石填色本_新手教程"));break;case"复位":this.restoration();break;case"获得道具":p.getScene().emit("钻石填色本_获得道具","消除当前数字索引",20);break;case"完成当前关卡":this.winText()}}winText(){this.isUsingPorp?console.log("正在使用道具，无法立即通关"):this.useAllPropsInOrder()}async useAllPropsInOrder(){const t=[];for(let e=1;e<=this.colorIndexMap.size;e++){let i=this.colorIndexMap.get(e.toString());i[0]<i[1]&&t.push(e)}if(0!==t.length){for(const e of t){this.isUsingPorp&&await new Promise((t=>{const e=setInterval((()=>{this.isUsingPorp||(clearInterval(e),t(null))}),100)}));const t=this.posNodeMap.get(e.toString());if(t&&t.length>0)for(const e of t){const t=e.getComponent(M);if(t&&!t.IsFilled){this.isUseProp=!0,this.propBoxTs=t,this.isTruePos=!0,await this.useProp();break}}await new Promise((t=>this.scheduleOnce(t,.1)))}this.Win()}else this.Win()}Win(){this.fillOver(),D.Instance.saveBuildingData(this.curMapID,this.curBuildingName,null),D.Instance.setBuildingData(this.curMapID,this.curBuildingName,!0),D.DateSave(),v.emit(F.游戏结束),this.scheduleOnce((()=>{this.WinAni(),B.instance.playSFX("胜利")}),.6)}WinAni(){D.Instance.isFillFirst||(D.Instance.isFillFirst=!0),this.winNode.active=!0;let e=this.winNode.getChildByName("图片").getChildByName("完成图").getComponent(d),i="Sprites/关卡/"+("关卡"+t.instance.curMapID)+"/"+this.curBuildingName;w.LoadSprite(i).then((t=>{e.spriteFrame=t,this.winNode.getChildByPath("图片/mask").getComponent(d).spriteFrame=t,C(e.node.parent).to(.5,{scale:h(1,1,1)}).call((()=>{this.WinEffect()})).start()}))}WinEffect(){this.winNode.getChildByName("WinEffect").getComponent(m).resetSystem()}StopWinEffect(){this.winNode.getChildByName("WinEffect").getComponent(m).stopSystem()}onFill(t){this.isUseProp?this.posCheck(this.Target,t,this.fillNodes):this.posCheck(this.Target,t,this.posNodes)}posCheck(t,e,i){const o=t.scale.x,s=t.scale.y;for(let t=0;t<i.length;t++){let r=i[t];const n=r.getComponent(f),a=n.width*o/2,h=n.height*s/2,c=r.worldPosition.x-a,g=r.worldPosition.y-h,p=c+n.width*o,u=g+n.height*s;if(e.x>c&&e.x<p&&e.y>g&&e.y<u){const t=r.getComponent(M);if(this.isUseProp){var l;if(this.propBoxTs=t,0===(null==(l=this.propBoxTs)?void 0:l.ColorIndex)){this.propBoxTs=null,this.isTruePos=!1;break}this.isTruePos=!0}else t.onFill();break}}}async useProp(){var t,e;if(this.propBoxTs&&!this.propBoxTs.getLabelActive())return;if(this.isUsingPorp)return;if(0===(null==(t=this.propBoxTs)?void 0:t.ColorIndex))return void(this.isUsingPorp=!1);let i=null==(e=this.propBoxTs)||null==(e=e.ColorIndex)?void 0:e.toString(),o=this.colorIndexMap.get(i);if(o[0]===o[1])return;let s=this.posNodeMap.get(i);this.isUsingPorp=!0,this.AirWall.active=!0,D.Instance.isGameFirst&&this.isFirstProp&&(this.isFirstProp=!1,p.getScene().emit("钻石填色本_新手教程"));for(let t=0;t<s.length;t+=30){const e=s.slice(t,t+30);for(let t of e){let e=t.getComponent(M);e.IsFilled||e.onPropFill()}B.instance.playSFX("填涂"),t+30<s.length?await new Promise((t=>this.scheduleOnce(t,.05))):(p.getScene().emit("钻石填色本_使用道具",this.propName),this.propBoxTs=null,this.isUsingPorp=!1,this.AirWall.active=!1)}}fillColor(t){let e=this.colorIndexMap.get(t.toString());if(e[0]++,e[0]>=e[1]){let e=!0;p.getScene().emit("钻石填色本_颜色填充完毕",t);for(let t=1;t<=this.colorIndexMap.size;t++){let i=this.colorIndexMap.get(t.toString());if(i[0]<i[1]){e=!1,this.curColorIndex=t;break}}if(e)return void this.Win();this.ParticlePoolCtrl.recycleParticle(),this.finishColorNum++,p.getScene().emit("钻石填色本_颜色填充加一",this.finishColorNum),this.SelectColor();let i=this.colorMap.get(this.curColorIndex.toString());this.SwitchColorNodes(i)}}ParticleEffect(t,e){let i=this.ParticlePoolCtrl.getParticleFromPool();i.node.active=!0,i.node.setWorldPosition(t),i.startColor=e,i.endColor=e,i.resetSystem()}async saveFillData(){let t=[];for(let e=0;e<this.fillNodes.length;e++){const i=this.fillNodes[e].getComponent(M),{r:o,g:s,b:l,a:r}=i.sprite.color;0!==o||0!==s||0!==l||0!==r?t.push(i.IsFilled):t.push(!0)}D.Instance.saveBuildingData(this.curMapID,this.curBuildingName,t),D.DateSave()}fillOver(){this.selectNode.active=!1,this.selectNodeRoot=null,this.restoration()}SwitchColorNodes(t){this.isUseProp=!1,this.curColor=t;for(let t=0;t<this.colorMap.size;t++){let e=this.colorMap.get(t.toString());if((0!==e.r||0!==e.g||0!==e.b||0!==e.a)&&(this.curColor.r===e.r&&this.curColor.g===e.g&&this.curColor.b===e.b&&this.curColor.a===e.a)){this.posNodes=this.posNodeMap.get(t.toString()),this.preColorIndex=this.curColorIndex,this.curColorIndex=t,this.selectNodeRoot=this.colorSelect[t-1];break}}this.preColorIndex===this.curColorIndex&&this.SearchColor()}SearchColor(){if(this.isCamMove)return;const t=this.Target.scale;for(let e of this.posNodes){if(!e.getComponent(M).IsFilled){this.curBox=e;const i=e.position,o=h(-i.x*t.x,-i.y*t.y,this.Target.position.z);return this.isCamMove=!0,void C(this.Target).to(.5,{position:o}).call((()=>{this.isCamMove=!1})).start()}}}restoration(){C(this.Target).to(.5,{scale:h(1,1,1),position:h(0,0,0)}).start()}off(){p.getScene().off("钻石填色本_开始填色"),p.getScene().off("钻石填色本_结束填色"),p.getScene().off("钻石填色本_颜色填充加一"),p.getScene().off("钻石填色本_颜色填充完毕")}async restart(){await this.saveFillData(),this.off(),this.restoration(),p.getScene().emit("钻石填色本_开始切换场景"),p.getScene().emit("钻石填色本_退出游戏"),this.PixelPoolCtrl.loading(),this.PixelPoolCtrl.recyclePixel(),this.ParticlePoolCtrl.recycleParticle(),this.winNode.active=!1;let t=this.winNode.getChildByName("图片");C(t).to(.2,{scale:h(0,0,0)}).start();let e=this.ControlNode.getChildByName("左区").getChildByName("填色").getComponent(u).content;for(;e.children.length>0;){const t=e.children[0];t.removeFromParent(),t.destroy()}this.clearColorData(),this.resetGameState(),this.resetPixelData2D(),this.pixelData2D=[],this.cleanupImageResources(),this.selectNodeRoot=null,this.LockBtn.getComponent(d).color=new c(255,255,255,150),this.unscheduleAllCallbacks()}resetGameState(){this.isLock=!1,this.isFirst=!1,this.isShow=!1,this.isUseProp=!1,this.isUsingPorp=!1,this.isTruePos=!1,this.isCamMove=!1,this.finishColorNum=4,this.curIndex=0,this.curColorIndex=1,this.curColor=new c(255,255,255,255),this.curBuildingName=""}clearColorData(){this.colorMap&&this.colorMap.clear(),this.posNodeMap&&this.posNodeMap.clear(),this.colorIndexMap&&this.colorIndexMap.clear(),this.colorLookupMap&&this.colorLookupMap.clear(),this.colorCache&&this.colorCache.clear()}cleanupImageResources(){this.targetImage&&(this.targetImage=null),this.fillNodes&&(this.fillNodes.length=0,this.fillNodes=null,this.fillNodes=[]),this.posNodes&&(this.posNodes.length=0,this.posNodes=null,this.posNodes=[]),this.colorSelect&&(this.colorSelect.length=0,this.colorSelect=null,this.colorSelect=[])}initSelectColor(){this.selectNode.active=!0;let t=D.getShowNumByName(this.curBuildingName);this.finishColorNum=t-1;let e=this.ControlNode.getChildByName("左区").getChildByName("填色").getComponent(u).content,i=[0,this.posNodeMap.get(this.curIndex.toString()).length];this.colorIndexMap.set(this.curIndex.toString(),i);for(let t=1;t<this.colorMap.size;t++){let i=this.colorMap.get(t.toString()),o=x(this.colorBoxPrefab);o.parent=e,t===this.curIndex+1&&(this.selectNodeRoot=o),o.getComponent(y).initData(i,t);let s=this.posNodeMap.get(t.toString()),l=0;for(let t=0;t<s.length;t++){s[t].getComponent(M).IsFilled&&l++}this.colorIndexMap.set(t.toString(),[l,s.length]),this.colorSelect.push(o)}D.Instance.isGameFirst&&e.children[0].once(P.TOUCH_END,(()=>{p.getScene().emit("钻石填色本_新手教程")}),this);for(let t=1;t<this.colorMap.size;t++){let e=this.posNodeMap.get(t.toString()),i=0;for(let t=0;t<e.length;t++){e[t].getComponent(M).IsFilled&&i++}if(i>=e.length){p.getScene().emit("钻石填色本_颜色填充完毕",t),this.finishColorNum++,p.getScene().emit("钻石填色本_颜色填充加一",this.finishColorNum);for(let t=1;t<this.colorIndexMap.size;t++){let e=this.colorIndexMap.get(t.toString());if(e[0]<e[1]){this.curColorIndex=t;break}}}}this.ParticlePoolCtrl.recycleParticle(),this.isFirst||(this.isFirst=!0,this.finishColorNum++,p.getScene().emit("钻石填色本_颜色填充加一",this.finishColorNum)),console.log(this.colorMap);let o=this.colorMap.get(this.curColorIndex.toString());this.SwitchColorNodes(o),this.scheduleOnce((()=>{C(this.Target).to(.5,{scale:h(6,6,6)}).call((()=>{this.AirWall.active=!1})).start()}),.5)}async loadImage(){if(this.targetImage?console.log("图片存在"):console.log("图片不存在"),this.targetImage){await this.loadImagePixelData(this.targetImage);let t=this.Target.position.x-this.widthNum*this.startSize/2,e=this.Target.position.y-this.heightNum*this.startSize/2-50;this.startPos=h(t,e,0),this.colorCache.clear(),this.preScanColors(),this.colorMap.set(this.curIndex.toString(),new c(0,0,0,0)),this.posNodeMap.set(this.curIndex.toString(),[]),this.curIndex++,await this.createPixel(this.Target)}}findColorIndex(t){const e=`${t.r},${t.g},${t.b},${t.a}`,i=this.colorLookupMap.get(e);if(void 0!==i)return i;for(let i=0;i<this.colorMap.size;i++){const o=this.colorMap.get(i.toString());if(o&&t.r===o.r&&t.g===o.g&&t.b===o.b&&t.a===o.a)return this.colorLookupMap.set(e,i),i}return-1}preScanColors(){const t=new Map;for(let e=0;e<this.heightNum;e++)for(let i=0;i<this.widthNum;i++){const o=this.pixelData2D[e][i],s=`${o.r},${o.g},${o.b},${o.a}`;0!==o.a&&(t.has(s)||t.set(s,{...o}))}this.preWarmColorCache()}preWarmColorCache(){this.colorLookupMap.clear();for(let t=0;t<this.colorMap.size;t++){const e=this.colorMap.get(t.toString());if(e){const i=`${e.r},${e.g},${e.b},${e.a}`;this.colorLookupMap.set(i,t)}}}async createPixel(t){let e=this.heightNum*this.widthNum;this.preloadPixelPool(e),await this.createPixelsOptimized(t),this.scheduleOnce((()=>{this.initSelectColor(),B.instance.playBGM("游戏场景")}),.1)}preloadPixelPool(t){const e=this.PixelPoolCtrl.getPoolSize();e<t&&this.PixelPoolCtrl.preloadPixels(t-e)}async createPixelsOptimized(t){D.Instance.getMapDataByName(this.curMapID,this.curBuildingName);const e=D.Instance.getBuildingData(this.curMapID,this.curBuildingName);let i=this.heightNum*this.widthNum,o=this.precomputeAllPixelData(),s=this.groupPixelsByColor(o),l=0,r=0;for(const[o,n]of s){for(let o=0;o<n.length;o+=50){let s=n.slice(o,o+50);this.createPixelBatch(t,e,s),l+=s.length,this.isShow||(r=l/i,p.getScene().emit("钻石填色本_加载进度",r)),o+50<n.length&&await new Promise((t=>this.scheduleOnce(t,0)))}i<3400||(i>3400&&r>=.7&&(p.getScene().emit("钻石填色本_加载进度",1),this.isShow=!0),console.log(r))}}precomputeAllPixelData(){const t=[],e=this.PixelPoolCtrl.spritePrefab.data.getComponent(f),i=e.width,o=e.height,s=this.widthNum*i/2,l=this.heightNum*o/2,r=this.Target.position.x-s,n=this.Target.position.y-l;t.length=this.heightNum*this.widthNum;let a=0,h=null,g=0;for(let e=0;e<this.heightNum;e++){const s=-(n+e*o);for(let o=0;o<this.widthNum;o++){h=this.pixelData2D[e][o];const l=this.tempVec3.set(r+o*i,s,0),n=77*h.r+150*h.g+29*h.b>>8,p={r:n,g:n,b:n,a:h.a};if(a=this.findColorIndex(h),-1===a&&0!==h.a){a=this.colorMap.size,this.colorMap.set(a.toString(),new c(h.r,h.g,h.b,h.a)),this.posNodeMap.set(a.toString(),[]);const t=h.r+","+h.g+","+h.b+","+h.a;this.colorLookupMap.set(t,a)}t[g]={i:e,j:o,position:l.clone(),grayColor:p,originalColor:h,colorIndex:a},g++}}return t}groupPixelsByColor(t){const e=new Map;for(let i=0;i<t.length;i++){const o=t[i],s=o.grayColor.r+","+o.grayColor.g+","+o.grayColor.b+","+o.grayColor.a;let l=e.get(s);l||(l=[],e.set(s,l)),l.push(o)}return e}createPixelBatch(t,e,i){const o=this.fillNodes,s=this.posNodeMap,l=this.PixelPoolCtrl,r=t.getChildByName("特效"),n=t.getChildByName("图片");let a=null;for(let t=0;t<i.length;t++){const h=i[t],g=l.getPixelFromPool();let p=l.getSpriteFromPool();p.node.parent!==n&&p.node.setParent(n),p.node.setPosition(h.position),g.parent!==r&&g.setParent(r),g.setPosition(h.position),o[o.length]=g;const u=g.getComponent(M);u&&(null!==e?u.initData(p,h.grayColor,new c(h.originalColor.r,h.originalColor.g,h.originalColor.b,h.originalColor.a),h.colorIndex,e[o.length-1]):u.initData(p,h.grayColor,new c(h.originalColor.r,h.originalColor.g,h.originalColor.b,h.originalColor.a),h.colorIndex)),a=s.get(h.colorIndex.toString()),a&&(a[a.length]=g),l.usePixel(g),l.useSprite(p)}}async loadImagePixelData(t){return new Promise(((e,i)=>{const o=S.os===S.OS.OPENHARMONY,s=S.os===S.OS.ANDROID;console.log(`当前运行平台: ${S.os}, 是否鸿蒙系统: ${o}, 是否Android: ${s}`);const l=new N;l.image=t;const r=this.readPixels(l);if(r){console.log(r);const t=new Uint8ClampedArray(r.buffer);this.convertTo2DArray(t,l.width,l.height),this.widthNum=l.width,this.heightNum=l.height,e()}}))}readPixels(t,e=0,i=0,o,s){const l=t.getGFXTexture();if(!l)return null;o=o||t.width,s=s||t.height;const r=new Uint8Array(o*s*4),n=new I.BufferTextureCopy;n.texExtent.width=o,n.texExtent.height=s,n.texOffset.x=e,n.texOffset.y=i;try{var a;return null==(a=p.root)||a.device.copyTextureToBuffers(l,[r],[n]),r}catch(t){return console.error("读取纹理像素失败:",t),null}}convertTo2DArray(t,e,i){console.log(33333),this.pixelData2D=new Array(i);for(let o=0;o<i;o++){this.pixelData2D[o]=new Array(e);const i=o*e*4;for(let s=0;s<e;s++){const e=i+4*s;this.pixelData2D[o][s]={r:t[e],g:t[e+1],b:t[e+2],a:t[e+3]}}}}getPixelColor(t,e){return e>=0&&e<this.pixelData2D.length&&t>=0&&t<this.pixelData2D[e].length?this.pixelData2D[e][t]:null}getPixelData2D(){return this.pixelData2D}resetPixelData2D(){if(this.pixelData2D){for(let t=0;t<this.pixelData2D.length;t++)this.pixelData2D[t]&&(this.pixelData2D[t].length=0);this.pixelData2D.length=0}this.pixelData2D=null}printPixelDataSample(t=5,e=5){for(let i=0;i<Math.min(e,this.pixelData2D.length);i++){let e="行 "+i+": ";for(let o=0;o<Math.min(t,this.pixelData2D[i].length);o++){const t=this.pixelData2D[i][o];e+=`RGBA(${t.r},${t.g},${t.b},${t.a}) `}}}update(t){this.selectNodeRoot&&(this.selectNode.worldPosition=this.selectNodeRoot.worldPosition)}}).instance=null,E=e((G=q).prototype,"PixelPoolCtrl",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(G.prototype,"ParticlePoolCtrl",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=e(G.prototype,"colorBoxPrefab",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=e(G.prototype,"selectNode",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(G.prototype,"ControlNode",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=e(G.prototype,"Target",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=e(G.prototype,"CurModeLabel",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=G))||Z));o._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_Incident.ts",["cc","./BundleManager.ts"],(function(e){var t,n,o,r,s,c,a;return{setters:[function(e){t=e.cclegacy,n=e.Component,o=e.SpriteFrame,r=e.Prefab,s=e.ImageAsset,c=e._decorator},function(e){a=e.BundleManager}],execute:function(){var i;t._RF.push({},"b50db+cRI5F7bWnS/3z2xzU","ZSTSB_Incident",void 0);const{ccclass:d,property:l}=c;e("ZSTSB_Incident",d("ZSTSB_Incident")(i=class extends n{static LoadSprite(e){return new Promise(((t,n)=>{a.GetBundle("45_ZSTSB").load(e+"/spriteFrame",o,((n,o)=>{n?console.log("没有找到图片"+e):t&&t(o)}))}))}static Loadprefab(e){return new Promise(((t,n)=>{a.GetBundle("45_ZSTSB").load(e,r,((n,o)=>{n?console.log("没有找到预制体"+e):t&&t(o)}))}))}static LoadImageAsset(e){return new Promise(((t,n)=>{a.GetBundle("45_ZSTSB").load(e,s,((n,o)=>{n?console.log("没有找到ImageAsset"+e):t&&t(o)}))}))}})||i);t._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_Loading.ts",["cc"],(function(e){var t,o,s,n,i,c,a;return{setters:[function(e){t=e.cclegacy,o=e.Component,s=e.director,n=e.UIOpacity,i=e.tween,c=e.Sprite,a=e._decorator}],execute:function(){var d;t._RF.push({},"f08571b4Z9JOLqdHTLU+qCO","ZSTSB_Loading",void 0);const{ccclass:h,property:l}=a;e("ZSTSB_Loading",h("ZSTSB_Loading")(d=class extends o{constructor(...e){super(...e),this.process=0}start(){s.getScene().on("钻石填色本_开始切换场景",this.openUI,this),s.getScene().on("钻石填色本_切换场景结束",this.closeUI,this),s.getScene().on("钻石填色本_加载进度",(e=>{this.updateProcess(e)}),this)}update(e){}openUI(){this.node.getChildByName("BG").active=!0;let e=this.node.getChildByName("BG").getComponent(n);i(e).to(.2,{opacity:255}).start()}closeUI(){let e=this.node.getChildByName("BG").getComponent(n),t=this.node.getChildByName("BG").getChildByName("加载条").getComponent(c);i(e).to(.2,{opacity:0}).call((()=>{this.node.getChildByName("BG").active=!1,t.fillRange=0})).start()}updateProcess(e){let t=this.node.getChildByName("BG").getChildByName("加载条").getComponent(c);this.process>e||(e>=1&&this.scheduleOnce((()=>{this.closeUI()}),.7),t.fillRange=e,console.log(e))}})||d);t._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_Map.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ZSTSB_GameData.ts","./ZSTSB_MapBtn.ts","./Banner.ts","./ZSTSB_GameMgr.ts","./ZSTSB_UIGame.ts","./UIManager.ts","./ZSTSB_Incident.ts","./ZSTSB_AudioManager.ts"],(function(e){var t,n,a,i,o,s,c,r,l,h,d,p,m,g,u,B,M,S,N,C,f;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.initializerDefineProperty},function(e){a=e.cclegacy,i=e.Node,o=e._decorator,s=e.Component,c=e.director,r=e.ScrollView,l=e.Button,h=e.tween,d=e.v3,p=e.Sprite,m=e.Label},function(e){g=e.ZSTSB_GameData},function(e){u=e.ZSTSB_MapBtn},function(e){B=e.default},function(e){M=e.ZSTSB_GameMgr},function(e){S=e.ZSTSB_UIGame},function(e){N=e.UIManager},function(e){C=e.ZSTSB_Incident},function(e){f=e.ZSTSB_AudioManager}],execute:function(){var I,b,y,_,k,v,A,D,T;a._RF.push({},"3e5544lvbxFcarG1E9IlLqE","ZSTSB_Map",void 0);const{ccclass:Z,property:w}=o;e("ZSTSB_Map",(I=Z("ZSTSB_Map"),b=w(i),y=w(i),_=w(i),I((A=t((v=class extends s{constructor(...e){super(...e),n(this,"returnBtn",A,this),n(this,"courseNode",D,this),n(this,"AdNode",T,this),this.mainMapNode=null,this.curMapNode=null,this.lockMapName=""}start(){this.mainMapNode=this.node.getChildByName("大地图"),this.refreshBigMap(!1)}update(e){}onBtnClick(e){f.instance.playSFX("按钮");let t=e.target.name;if(t.startsWith("未解锁"))return this.lockMapName=e.target.name,void this.ShowAd(!0);if(t.startsWith("地图"))this.loadMap(e.target.name);else switch(e.target.name){case"返回选图":c.getScene().emit("钻石填色本_开始切换场景"),S.instance.hideColorBox(),this.scheduleOnce((()=>{this.mainMapNode.active=!0,this.curMapNode.active=!1,S.instance.mapBtn.active=!1,this.returnBtn.active=!0,this.refreshBigMap()}),.3);break;case"返回地图":if(!g.Instance.isFillFirst)return void N.ShowTip("请先完成当前关卡！");g.DateSave(),S.instance.changeMenu("选图界面"),M.instance.StopWinEffect(),g.Instance.isMapFirst&&(g.Instance.isMapFirst=!1,this.node.getChildByName("新手教程").active=!0,this.mainMapNode.getComponent(r).horizontal=!0,this.curMapNode.getComponent(r).horizontal=!0),this.refreshBigMap(!1),this.refresghMap(M.instance.curMapID,!1),this.scheduleOnce((async()=>{await M.instance.restart(),f.instance.playBGM("主界面")}),0);break;case"返回选择模式":g.DateSave(),c.getScene().emit("钻石填色本_开始切换场景"),S.instance.restartGame(),this.scheduleOnce((()=>{c.getScene().emit("钻石填色本_加载进度",1)}),.2);break;case"观看广告":B.Instance.ShowVideoAd((()=>{this.ShowAd(!1);let e=this.lockMapName.charAt(this.lockMapName.length-1),t=parseInt(e);g.Instance.mapLockArr[t-1]=!0,this.loadMap(this.lockMapName)}));break;case"关闭广告":this.ShowAd(!1);break;case"教程按钮":this.courseNode.active=!0;break;case"填色按钮":g.Instance.isGameFirst&&c.getScene().emit("钻石填色本_新手教程"),this.loadGame(),S.instance.hideColorBox();break;case"关闭填色":S.instance.hideColorBox();break;case"快速填色":this.SearchFill()}}ShowAd(e){let t=this.AdNode.getChildByName("观看广告").getComponent(l),n=this.AdNode.getChildByName("关闭广告").getComponent(l);t.enabled&&(e?(this.AdNode.active=!0,t.enabled=!1,n.enabled=!1,h(this.AdNode).to(.5,{scale:d(1,1,1)},{easing:"backInOut"}).call((()=>{t.enabled=!0,n.enabled=!0})).start()):(t.enabled=!1,n.enabled=!1,h(this.AdNode).to(.3,{scale:d(0,0,0)},{easing:"backInOut"}).call((()=>{t.enabled=!0,n.enabled=!0,this.AdNode.active=!1})).start()))}SearchFill(){let e=g.Instance.getMapDataByID(M.instance.curMapID);for(let t=0;t<e.length;t++){let n=e[t].State,a=e[t].BuildingName;if(!n){M.instance.curBuildingName=a;let e=S.instance.ColorBox.getChildByName("图片").getComponent(p),t="Sprites/关卡/"+("关卡"+M.instance.curMapID)+"/"+a;C.LoadSprite(t).then((t=>{e.spriteFrame=t,M.instance.curBuildingName=a,S.instance.showColorBox()}));break}}}loadGame(){this.scheduleOnce((()=>{S.instance.changeMenu("游戏界面"),M.instance.startGame(),console.error(111)}),.5)}loadMap(e){c.getScene().emit("钻石填色本_开始切换场景"),this.scheduleOnce((()=>{this.mainMapNode.active=!1,this.curMapNode=this.node.getChildByName(e),this.curMapNode.active=!0;let t=e,n=t.charAt(t.length-1),a=parseInt(n);M.instance.curMapID=a,this.initMapData(a),S.instance.mapBtn.active=!0,this.updateMapProcess(a)}),.5)}initMapData(e){let t=g.Instance.getMapDataByID(e);for(let n=0;n<t.length;n++){let a=t[n].State,i=t[n].BuildingName,o=this.node.children[e].getComponent(r).content.children[n+2].getComponent(u);a?o.Complete(i):o.init(i),c.getScene().emit("钻石填色本_加载进度",(n+1)/t.length)}this.returnBtn.active=!1}refresghMap(e,t=!0){g.Instance.isMapFirst?(this.mainMapNode.getComponent(r).horizontal=!1,this.node.getChildByName("地图1").getComponent(r).horizontal=!1):(this.mainMapNode.getComponent(r).horizontal=!0,this.node.getChildByName("地图1").getComponent(r).horizontal=!0),this.scheduleOnce((()=>{let n=g.Instance.getMapDataByID(e);this.updateMapProcess(e);for(let a=0;a<n.length;a++){let i=n[a].State,o=n[a].BuildingName,s=this.node.getChildByName("地图"+e).getComponent(r).content.children[a+2].getComponent(u);i&&s.Complete(o),t&&c.getScene().emit("钻石填色本_加载进度",(a+1)/n.length)}}),.3)}updateMapProcess(e){let t=g.Instance.getMapDataByID(e),n=S.instance.ColorBox.getChildByName("图片");switch(e){case 1:n.scale=d(6,6,6);break;case 2:case 4:n.scale=d(4,4,4);break;case 3:n.scale=d(6,6,6)}let a=t.length,i=0;for(let e=0;e<t.length;e++){t[e].State&&i++}let o=i/a,s=this.node.getChildByName("Btn").getChildByName("进度条");if(s.getChildByName("进度").getComponent(p).fillRange=o,o>=1){let e=M.instance.curMapID;e<g.Instance.mapLockArr.length&&(g.Instance.mapLockArr[e]=!0)}s.getChildByName("进度百分比").getComponent(m).string=(100*o).toFixed(2)+"%"}refreshBigMap(e=!0){var t;let n=this.node.getChildByName("大地图").getComponent(r),a=g.Instance.mapLockArr.length;null==(t=this.curMapNode)||t.getComponent(r);g.Instance.isMapFirst?(this.mainMapNode.getComponent(r).horizontal=!1,this.node.getChildByName("地图1").getComponent(r).horizontal=!1):(this.mainMapNode.getComponent(r).horizontal=!0,this.node.getChildByName("地图1").getComponent(r).horizontal=!0);for(let t=0;t<g.Instance.mapLockArr.length;t++){g.Instance.mapLockArr[t]?(n.content.children[t+3].name="地图"+(t+1),this.node.children[t+1].name="地图"+(t+1),n.content.children[t+3].children[0].active=!1):(n.content.children[t+3].name="未解锁"+(t+1),this.node.children[t+1].name="未解锁"+(t+1),n.content.children[t+3].children[0].active=!0),e&&c.getScene().emit("钻石填色本_加载进度",(t+1)/a)}}}).prototype,"returnBtn",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(v.prototype,"courseNode",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=t(v.prototype,"AdNode",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=v))||k));a._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_MapBtn.ts",["cc","./ZSTSB_Incident.ts","./ZSTSB_UIGame.ts","./ZSTSB_GameMgr.ts","./ZSTSB_GameData.ts","./ZSTSB_AudioManager.ts"],(function(t){var n,e,a,i,s,o,c,r,S,u;return{setters:[function(t){n=t.cclegacy,e=t.Component,a=t.Sprite,i=t.NodeEventType,s=t._decorator},function(t){o=t.ZSTSB_Incident},function(t){c=t.ZSTSB_UIGame},function(t){r=t.ZSTSB_GameMgr},function(t){S=t.ZSTSB_GameData},function(t){u=t.ZSTSB_AudioManager}],execute:function(){var p;n._RF.push({},"7a46eIOkhpIZK39v3XDdmYl","ZSTSB_MapBtn",void 0);const{ccclass:d,property:h}=s;t("ZSTSB_MapBtn",d("ZSTSB_MapBtn")(p=class extends e{constructor(...t){super(...t),this.buildingName=""}start(){}update(t){}init(t){this.buildingName=t,this.getComponent(a).grayscale=!0,this.node.on(i.TOUCH_END,this.touchEnd,this)}Complete(t){this.buildingName=t,this.getComponent(a).grayscale=!1,this.node.on(i.TOUCH_END,this.touchEnd,this)}touchEnd(){if(u.instance.playSFX("按钮"),S.Instance.getMapDataByName(r.instance.curMapID,this.buildingName).State)return;let t=c.instance.ColorBox.getChildByName("图片").getComponent(a),n="Sprites/关卡/"+("关卡"+r.instance.curMapID)+"/"+this.buildingName;o.LoadSprite(n).then((n=>{t.spriteFrame=n,r.instance.curBuildingName=this.buildingName,c.instance.showColorBox()}))}})||p);n._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_MoveCtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ZSTSB_GameMgr.ts","./ZSTSB_GameData.ts"],(function(t){var i,e,s,o,n,h,c,a,l,r,g;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.initializerDefineProperty},function(t){s=t.cclegacy,o=t.Node,n=t._decorator,h=t.Component,c=t.v2,a=t.director,l=t.v3},function(t){r=t.ZSTSB_GameMgr},function(t){g=t.ZSTSB_GameData}],execute:function(){var u,d,T,S,f,y;s._RF.push({},"c50a6PoSw9L15kmEuNNVVsF","ZSTSB_MoveCtrl",void 0);const{ccclass:p,property:N}=n;t("ZSTSB_MoveCtrl",(u=p("ZSTSB_MoveCtrl"),d=N(o),u((f=i((S=class extends h{constructor(...t){super(...t),e(this,"targetNode",f,this),e(this,"wheelZoomSpeed",y,this),this.touches=[],this.initialDistance=0,this.initialScale=c(1,1),this.currentScale=c(1,1),this.isDragging=!1,this.lastTouchPos=c(0,0),this.initialPosition=c(0,0)}start(){a.getScene().on("钻石填色本_初始化游戏",this.initTouchEvent,this),a.getScene().on("钻石填色本_退出游戏",this.offTouchEvent,this)}initTouchEvent(){this.node.on(o.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(o.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(o.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(o.EventType.TOUCH_CANCEL,this.onTouchEnd,this),this.node.on(o.EventType.MOUSE_WHEEL,this.onMouseWheel,this),console.error(222)}update(t){}offTouchEvent(){this.node.off(o.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(o.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(o.EventType.TOUCH_END,this.onTouchEnd,this),this.node.off(o.EventType.TOUCH_CANCEL,this.onTouchEnd,this),this.node.off(o.EventType.MOUSE_WHEEL,this.onMouseWheel,this),this.touches.length=0,this.isDragging=!1,this.initialDistance=0,this.initialScale.set(1,1),this.currentScale.set(1,1),this.lastTouchPos.set(0,0),this.initialPosition.set(0,0)}onTouchStart(t){const i=t.touch;if(i){-1===this.touches.findIndex((t=>t.getID()===i.getID()))&&this.touches.push(i);let e=l(t.getUILocation().x,t.getUILocation().y,0);if(2===this.touches.length&&(this.initialDistance=this.getTouchDistance(this.touches[0],this.touches[1]),this.targetNode&&this.initialScale.set(this.targetNode.scale.x,this.targetNode.scale.y),this.isDragging=!1),1===this.touches.length&&!r.instance.isLock){const i=l(t.getUILocation().x,t.getUILocation().y,0);this.lastTouchPos.set(i.x,i.y),this.targetNode&&this.initialPosition.set(this.targetNode.worldPosition.x,this.targetNode.worldPosition.y)}if(1!==this.touches.length||this.isDragging||r.instance.onFill(e),2===this.touches.length&&r.instance.isLock){this.isDragging=!0;const i=l(t.getUILocation().x,t.getUILocation().y,0);this.lastTouchPos.set(i.x,i.y),this.targetNode&&this.initialPosition.set(this.targetNode.worldPosition.x,this.targetNode.worldPosition.y)}if(1===this.touches.length&&r.instance.isLock){let i=l(t.getUILocation().x,t.getUILocation().y,0);r.instance.onFill(i)}}}onTouchMove(t){if(g.Instance.isGameFirst)return;let i=l(t.getUILocation().x,t.getUILocation().y,0);if(2===this.touches.length&&!r.instance.isLock){const t=this.getTouchDistance(this.touches[0],this.touches[1]);if(this.initialDistance>0&&this.targetNode){const i=t/this.initialDistance,e=this.initialScale.x*i,s=this.initialScale.y*i;this.targetNode.setScale(e,s,this.targetNode.scale.z),this.currentScale.set(e,s)}}if(2===this.touches.length&&r.instance.isLock){const t=this.getTouchDistance(this.touches[0],this.touches[1]);if(this.initialDistance>0&&this.targetNode){const i=t/this.initialDistance,e=this.initialScale.x*i,s=this.initialScale.y*i;this.targetNode.setScale(e,s,this.targetNode.scale.z),this.currentScale.set(e,s)}const i=this.getMidPoint(this.touches[0],this.touches[1]);if(this.touches[1]&&this.targetNode){const t=i.x-this.lastTouchPos.x,e=i.y-this.lastTouchPos.y,s=this.initialPosition.x+t,o=this.initialPosition.y+e;this.targetNode.worldPosition=l(s,o,this.targetNode.position.z)}}if(1===this.touches.length&&!r.instance.isLock){const i=t.touch;this.isDragging=!0;const e=l(i.getUILocation().x,i.getUILocation().y,0);if(i&&this.targetNode){const t=e.x-this.lastTouchPos.x,i=e.y-this.lastTouchPos.y,s=this.initialPosition.x+t,o=this.initialPosition.y+i;this.targetNode.worldPosition=l(s,o,this.targetNode.position.z)}}1===this.touches.length&&r.instance.isLock&&r.instance.onFill(i)}onTouchEnd(t){a.getScene().emit("钻石填色本_结束填色");const i=t.touch;if(i){const t=this.touches.findIndex((t=>t.getID()===i.getID()));-1!==t&&this.touches.splice(t,1),this.touches.length<1&&(this.isDragging=!1)}this.touches.length=0}onMouseWheel(t){if(!r.instance.isLock&&this.targetNode){const i=1+(t.getScrollY()>0?this.wheelZoomSpeed:-this.wheelZoomSpeed),e=this.targetNode.scale.x*i,s=this.targetNode.scale.y*i;this.targetNode.setScale(e,s,this.targetNode.scale.z),this.currentScale.set(e,s)}}getMidPoint(t,i){const e=t.getLocation(),s=i.getLocation(),o=(e.x+s.x)/2,n=(e.y+s.y)/2;return c(o,n)}getTouchDistance(t,i){const e=t.getLocation(),s=i.getLocation(),o=s.x-e.x,n=s.y-e.y;return Math.sqrt(o*o+n*n)}}).prototype,"targetNode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=i(S.prototype,"wheelZoomSpeed",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),T=S))||T));s._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_ParticlePool.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ZSTSB_GameMgr.ts"],(function(e){var t,r,i,o,l,s,a,c,n;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.initializerDefineProperty},function(e){i=e.cclegacy,o=e.Prefab,l=e._decorator,s=e.Component,a=e.instantiate,c=e.ParticleSystem2D},function(e){n=e.ZSTSB_GameMgr}],execute:function(){var P,p,u,h,f;i._RF.push({},"a2fd8Xf0KNFgb1JqbEsPqYW","ZSTSB_ParticlePool",void 0);const{ccclass:g,property:d}=l;e("ZSTSB_ParticlePool",(P=g("ZSTSB_ParticlePool"),p=d(o),P((f=t((h=class extends s{constructor(...e){super(...e),r(this,"particlePrefab",f,this),this.particlePool=[],this.usedParticles=[]}start(){this.CreateParticle(100)}async CreateParticle(e){const t=n.instance.Target;for(let r=0;r<e;r+=50){const i=Math.min(50,e-r);for(let e=0;e<i;e++){let e=a(this.particlePrefab);e.setParent(t);let r=e.getComponent(c);this.particlePool.push(r),e.active=!1}r+50<e&&await new Promise((e=>this.scheduleOnce(e,.01)))}console.log(`粒子对象池初始化完成，总共创建 ${e} 个粒子节点`)}getParticleFromPool(){if(this.particlePool.length>0)return this.particlePool.pop();{let e=a(this.particlePrefab);e.setParent(n.instance.Target);let t=e.getComponent(c);return this.particlePool.push(t),e.active=!1,t}}returnParticleToPool(e){this.particlePool.push(e)}useParticle(e){this.usedParticles.push(e)}recycleParticle(){const e=()=>{const t=this.usedParticles.splice(0,Math.min(50,this.usedParticles.length));for(let e of t)this.particlePool.length<100?(e.node.active=!1,this.particlePool.push(e)):e.node.destroy();this.usedParticles.length>0?setTimeout(e,0):console.log("粒子回收完成")};this.usedParticles.length>0?e():console.log("粒子回收完成")}}).prototype,"particlePrefab",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u=h))||u));i._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_Pixel.ts",["cc","./ZSTSB_GameMgr.ts","./ZSTSB_AudioManager.ts","./ZSTSB_GameData.ts"],(function(i){var t,e,l,s,o,n,r,h,a,c;return{setters:[function(i){t=i.cclegacy,e=i.Component,l=i.Color,s=i.Label,o=i.UIOpacity,n=i.director,r=i._decorator},function(i){h=i.ZSTSB_GameMgr},function(i){a=i.ZSTSB_AudioManager},function(i){c=i.ZSTSB_GameData}],execute:function(){var p;t._RF.push({},"0d7d3tgcwhNXYBR54FFhJ4r","ZSTSB_Pixel",void 0);const{ccclass:d,property:g}=r;i("ZSTSB_Pixel",d("ZSTSB_Pixel")(p=class extends e{constructor(...i){super(...i),this.colorIndex=0,this.pixelColor=new l,this.sprite=null,this.label=null,this.isFilled=!1,this.spUIOp=null,this.particle=null,this.showIndex=5,this.blackColor=new l(1,1,1,255)}get ColorIndex(){return this.colorIndex}get IsFilled(){return this.isFilled}onLoad(){this.label=this.node.getChildByName("数字").getComponent(s),this.changeUIOpacity(0)}initData(i,t,e,s,r){this.colorIndex=s,this.sprite=i,this.spUIOp=this.sprite.getComponent(o);let a=h.instance.curBuildingName,p=c.getShowNumByName(a);if(this.showIndex=p,0===e.a)return this.pixelColor=new l(0,0,0,0),void(this.sprite.color=new l(0,0,0,0));if(this.pixelColor=e,this.colorIndex>this.showIndex?this.label.node.active=!1:this.label.node.active=!0,this.label.string=this.colorIndex.toString(),this.changeUIOpacity(255),r)this.Filled();else{let i=t;this.sprite.color=new l(i.r,i.g,i.b,i.a)}n.getScene().on("钻石填色本_颜色填充加一",(i=>{this.colorIndex===i&&this.showLabel(!0)}),this)}showLabel(i){this.label.node.active=i}onFill(){if(this.isFilled)return;if(!this.label.node.active)return;let i=h.instance.curColor;if(this.pixelColor.r===i.r&&this.pixelColor.g===i.g&&this.pixelColor.b===i.b&&this.pixelColor.a===i.a){this.isFilled=!0,this.label.string="";let t=this.pixelColor;0===i.r&&0===i.g&&0===i.b&&(t=this.blackColor),this.sprite.color=t,a.instance.playSFX("填涂"),c.Instance.isGameFirst&&h.instance.isFirstFill&&(h.instance.isFirstFill=!1,n.getScene().emit("钻石填色本_新手教程")),h.instance.fillColor(this.colorIndex),h.instance.ParticleEffect(this.node.worldPosition.clone(),t)}}onPropFill(){if(!this.label.node.active)return;this.isFilled=!0,this.label.string="";let i=this.pixelColor;0===i.r&&0===i.g&&0===i.b&&(i=this.blackColor),this.sprite.color=i,h.instance.fillColor(this.colorIndex),h.instance.ParticleEffect(this.node.worldPosition.clone(),i)}Filled(){this.isFilled=!0,this.label.string="";let i=this.pixelColor;0===i.r&&0===i.g&&0===i.b&&255===i.a&&(i=this.blackColor),this.sprite.color=i}reset(){this.isFilled=!1,this.label.string="",this.showLabel(!1),this.sprite.color=l.WHITE,this.pixelColor=l.WHITE,this.changeUIOpacity(0)}changeUIOpacity(i){this.spUIOp&&(this.spUIOp.opacity=i)}getLabelActive(){return this.label.node.active}})||p);t._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_PixelPool.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ZSTSB_Pixel.ts","./ZSTSB_GameMgr.ts"],(function(e){var t,i,s,l,o,n,r,h,a,p,P,c,u;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.initializerDefineProperty},function(e){s=e.cclegacy,l=e.Prefab,o=e._decorator,n=e.Component,r=e.instantiate,h=e.Sprite,a=e.director,p=e.v3,P=e.Color},function(e){c=e.ZSTSB_Pixel},function(e){u=e.ZSTSB_GameMgr}],execute:function(){var g,x,f,d,m,S,y;s._RF.push({},"6b30eDLKKhJ8rhtF7/y51u7","ZSTSB_PixelPool",void 0);const{ccclass:b,property:C}=o;e("ZSTSB_PixelPool",(g=b("ZSTSB_PixelPool"),x=C(l),f=C(l),g((S=t((m=class extends n{constructor(...e){super(...e),i(this,"pixelPrefab",S,this),i(this,"spritePrefab",y,this),this.pixelPool=[],this.usedPixels=[],this.spritePool=[],this.usedSprites=[],this.pixelComponentCache=new WeakMap,this.totalPixels=0,this.finishPixels=0}start(){this.CreatePixels(2500),u.instance.isPoolInit=!0}async CreatePixels(e){const t=u.instance.Target.getChildByName("特效"),i=u.instance.Target.getChildByName("图片");let s=0;for(let l=0;l<e;l+=50){const o=Math.min(50,e-l),n=new Array(o),p=new Array(o);for(let l=0;l<o;l++){const o=r(this.pixelPrefab),P=r(this.spritePrefab);o.setParent(t),P.setParent(i),n[l]=o,p[l]=P.getComponent(h),s++;let c=s/e;a.getScene().emit("钻石填色本_加载进度",c)}this.pixelPool.push(...n),this.spritePool.push(...p),l+50<e&&await new Promise((e=>setTimeout(e,.05)))}}getPixelFromPool(){if(this.pixelPool.length>0)return this.pixelPool.pop();{const e=r(this.pixelPrefab),t=e.getComponent(c);return t&&this.pixelComponentCache.set(e,t),e}}getSpriteFromPool(){return this.spritePool.length>0?this.spritePool.pop():r(this.spritePrefab).getComponent(h)}usePixel(e){this.usedPixels.push(e)}useSprite(e){this.usedSprites.push(e)}loading(){this.totalPixels=Array.from(this.usedPixels).length}recyclePixel(){const e=u.instance.Target.getChildByName("特效"),t=(u.instance.Target.getChildByName("图片"),5500),i=()=>{const s=this.usedPixels.splice(0,Math.min(50,this.usedPixels.length)),l=this.usedSprites.splice(0,Math.min(50,this.usedSprites.length));console.log(this.usedPixels);for(let e=0;e<s.length;e++){const t=s[e];t.position=p(0,0,0);const i=t.getComponent(c);i&&i.reset()}for(let e=0;e<l.length;e++){l[e].color=P.WHITE}if(this.pixelPool.length<t){const e=t-this.pixelPool.length,i=Math.min(s.length,e);this.pixelPool.push(...s.slice(0,i));const o=Math.min(l.length,e);this.spritePool.push(...l.slice(0,o));for(let e=i;e<s.length;e++)s[e].destroy();for(let e=o;e<l.length;e++)l[e].node.destroy()}else{for(let e=0;e<s.length;e++)s[e].destroy();for(let e=0;e<l.length;e++)l[e].node.destroy()}if(this.finishPixels+=Math.min(s.length,t),this.totalPixels>0){const e=this.finishPixels/this.totalPixels;a.getScene().emit("钻石填色本_加载进度",e)}this.usedPixels.length>0||this.usedSprites.length>0?setTimeout(i,0):(console.log("对象池回收完成"),this.finishPixels=0,console.log(e.children.length))};i()}preloadPixels(e){for(let t=0;t<e;t++){const e=r(this.pixelPrefab);this.pixelPool.push(e)}}getPoolSize(){return this.pixelPool.length}}).prototype,"pixelPrefab",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=t(m.prototype,"spritePrefab",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=m))||d));s._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_Prop.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ZSTSB_GameData.ts","./ZSTSB_GameMgr.ts","./Banner.ts","./ZSTSB_AudioManager.ts","./UIManager.ts"],(function(e){var t,i,s,n,o,a,r,p,h,l,c,d,u,S,m,g,N;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.initializerDefineProperty},function(e){s=e.cclegacy,n=e.Node,o=e._decorator,a=e.Component,r=e.director,p=e.Button,h=e.tween,l=e.v3,c=e.Label,d=e.Sprite},function(e){u=e.ZSTSB_GameData},function(e){S=e.ZSTSB_GameMgr},function(e){m=e.default},function(e){g=e.ZSTSB_AudioManager},function(e){N=e.UIManager}],execute:function(){var b,B,f,y,P,_,A;s._RF.push({},"934d0sujilJQarK6rkFV7Zu","ZSTSB_Prop",void 0);const{ccclass:C,property:v}=o;e("ZSTSB_Prop",(b=C("ZSTSB_Prop"),B=v(),f=v(n),b((_=t((P=class extends a{constructor(...e){super(...e),i(this,"propName",_,this),i(this,"AdNode",A,this),this.adSprite=null,this.label=null,this.propNum=0,this.isFirst=!0}start(){this.init(),this.initEvent()}onClick(){g.instance.playSFX("按钮"),u.Instance.isGameFirst&&this.isFirst&&(this.isFirst=!1,r.getScene().emit("钻石填色本_新手教程")),this.adSprite.active?(S.instance.isUseProp=!1,this.ShowAd(!0)):(S.instance.isUseProp=!0,S.instance.propName=this.propName,S.instance.selectNodeRoot=this.node,console.log("点击道具："+this.propName),S.instance.SelectProp())}ShowAd(e){let t=this.AdNode.getChildByName("观看广告").getComponent(p),i=this.AdNode.getChildByName("关闭广告").getComponent(p);t.enabled&&(e?(this.AdNode.active=!0,t.enabled=!1,i.enabled=!1,h(this.AdNode).to(.5,{scale:l(1,1,1)},{easing:"backInOut"}).call((()=>{t.enabled=!0,i.enabled=!0})).start()):(t.enabled=!1,i.enabled=!1,h(this.AdNode).to(.3,{scale:l(0,0,0)},{easing:"backInOut"}).call((()=>{t.enabled=!0,i.enabled=!0,this.AdNode.active=!1})).start()))}onClose(){this.ShowAd(!1)}LookAd(){this.ShowAd(!1),m.Instance.ShowVideoAd((()=>{this.getProp(10)}))}init(){this.label=this.node.getChildByName("道具数量").getComponent(c),this.adSprite=this.node.getChildByName("广告");let e=u.Instance.getPropByName(this.propName);e&&(this.propNum=e,this.label.string=this.propNum.toString())}initEvent(){this.node.on(n.EventType.TOUCH_END,this.onClick,this),r.getScene().on("钻石填色本_使用道具",(e=>{this.propName===e&&this.useProp()}),this),r.getScene().on("钻石填色本_获得道具",((e,t)=>{this.propName===e&&this.getProp(t)}),this)}refreshUI(){this.label.string=this.propNum.toString(),this.propNum<=0?(this.getComponent(d).grayscale=!0,this.adSprite.active=!0,S.instance.isUseProp=!1):(this.getComponent(d).grayscale=!1,this.adSprite.active=!1)}useProp(){u.Instance.subPropByName(this.propName,1)&&(this.propNum--,this.refreshUI())}getProp(e){u.Instance.pushPropByName(this.propName,e)&&(this.propNum+=e,N.ShowTip("获得"+e+"个道具！"),this.refreshUI())}}).prototype,"propName",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),A=t(P.prototype,"AdNode",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=P))||y));s._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_UIGame.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ZSTSB_AudioManager.ts","./ProjectEventManager.ts","./UIManager.ts","./GameManager.ts","./ZSTSB_GameMgr.ts","./BHPD_GameData.ts","./ZSTSB_GameData.ts","./BHPD_GameMgr.ts"],(function(t){var e,a,i,n,o,s,l,c,r,h,B,g,u,d,m,p,C,S,y,b,v;return{setters:[function(t){e=t.applyDecoratedDescriptor,a=t.initializerDefineProperty},function(t){i=t.cclegacy,n=t.Node,o=t._decorator,s=t.Component,l=t.director,c=t.UIOpacity,r=t.tween,h=t.v3,B=t.Button},function(t){g=t.ZSTSB_AudioManager},function(t){u=t.ProjectEventManager,d=t.ProjectEvent},function(t){m=t.UIManager,p=t.Panel},function(t){C=t.GameManager},function(t){S=t.ZSTSB_GameMgr},function(t){y=t.BHPD_GameData},function(t){b=t.ZSTSB_GameData},function(t){v=t.BHPD_GameMgr}],execute:function(){var _,f,P,T,x,D,M,I;i._RF.push({},"ad8ef/YvRxEvIBkJ3teobpz","ZSTSB_UIGame",void 0);const{ccclass:G,property:Z}=o;t("ZSTSB_UIGame",(_=G("ZSTSB_UIGame"),f=Z(n),P=Z(n),_(((I=class t extends s{constructor(...t){super(...t),this.curScene="选图界面",a(this,"mapBtn",D,this),a(this,"ColorBox",M,this),this.startBtn=null,this.closeBtn=null,this.fillCourse=null,this.fillProgress=null,this.gameType="DIY豆豆"}start(){t.instance=this,y.ReadDate(),b.ReadDate()}update(t){}onBtnClick(t){var e,a;switch(g.instance.playSFX("按钮"),t.target.name){case"返回主页":u.emit(d.返回主页按钮事件,(()=>{m.ShowPanel(p.LoadingPanel,C.StartScene,(()=>{u.emit(d.返回主页,"钻石填色本")}))}));break;case"钻石填色":this.gameType="钻石填色",null!=(e=S.instance)&&e.isPoolInit&&this.scheduleOnce((()=>{l.getScene().emit("钻石填色本_加载进度",1)}),.2),this.startMode();break;case"DIY豆豆":this.gameType="DIY豆豆",null!=(a=v.instance)&&a.isPoolInit&&this.scheduleOnce((()=>{l.getScene().emit("钻石填色本_加载进度",1)}),.2),this.startMode()}}startMode(){l.getScene().emit("钻石填色本_开始切换场景"),this.scheduleOnce((()=>{this.node.getChildByName("选择模式").active=!1,this.node.getChildByName(this.gameType).active=!0,this.init()}),.25)}restartGame(){this.node.getChildByName("钻石填色").active=!1,this.node.getChildByName("DIY豆豆").active=!1,this.node.getChildByName("选择模式").active=!0}changeMenu(t){l.getScene().emit("钻石填色本_开始切换场景");let e=this.node.getChildByPath(this.gameType+"/"+this.curScene).getComponent(c);r(e).to(.2,{opacity:0},{easing:"backIn"}).call((()=>{"游戏界面"!==this.curScene&&(this.node.getChildByPath(this.gameType+"/"+this.curScene).active=!1),this.node.getChildByPath(this.gameType+"/"+t).active=!0})).start();let a=this.node.getChildByPath(this.gameType+"/"+t).getComponent(c);r(a).to(.8,{opacity:255},{easing:"backOut"}).call((()=>{this.curScene=t})).start()}showColorBox(){this.ColorBox.active=!0,this.ColorBox.parent.active=!0,this.startBtn.enabled=!1,this.closeBtn.enabled=!1,this.ColorBox.scale=h(0,0,0),r(this.ColorBox).to(.5,{scale:h(1,1,1)},{easing:"backOut"}).call((()=>{this.startBtn.enabled=!0,this.closeBtn.enabled=!0})).start()}hideColorBox(){this.startBtn.enabled=!1,this.closeBtn.enabled=!1,this.ColorBox.scale=h(1,1,1),r(this.ColorBox).to(.5,{scale:h(0,0,0)},{easing:"backIn"}).call((()=>{this.ColorBox.active=!1,this.ColorBox.parent.active=!1,this.startBtn.enabled=!0,this.closeBtn.enabled=!0})).start()}init(){this.ColorBox=this.node.getChildByPath("/"+this.gameType+"/选图界面/填色框/面板"),this.startBtn=this.ColorBox.getChildByName("填色按钮").getComponent(B),this.closeBtn=this.ColorBox.getChildByName("关闭填色").getComponent(B)}}).instance=null,D=e((x=I).prototype,"mapBtn",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(x.prototype,"ColorBox",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=x))||T));i._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/45_ZSTSB', 'chunks:///_virtual/45_ZSTSB'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});