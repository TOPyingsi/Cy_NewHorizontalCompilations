System.register("chunks:///_virtual/45_ZSTSB",["./ZSTSB_FillColor.ts","./ZSTSB_Prop.ts","./ZSTSB_Course.ts","./ZSTSB_Map.ts","./ZSTSB_MapBtn.ts","./ZSTSB_AudioManager.ts","./ZSTSB_GameData.ts","./ZSTSB_GameMgr.ts","./ZSTSB_Incident.ts","./ZSTSB_Loading.ts","./ZSTSB_MapCtrl.ts","./ZSTSB_MoveCtrl.ts","./ZSTSB_ParticlePool.ts","./ZSTSB_Pixel.ts","./ZSTSB_PixelPool.ts","./ZSTSB_UIGame.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/ZSTSB_AudioManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var t,e,o,s,n,r,u;return{setters:[function(i){t=i.applyDecoratedDescriptor,e=i.initializerDefineProperty},function(i){o=i.cclegacy,s=i.AudioClip,n=i._decorator,r=i.Component,u=i.AudioSource}],execute:function(){var a,l,c,p,d,h;o._RF.push({},"d88068OQLRKz7ohJgDVI951","ZSTSB_AudioManager",void 0);const{ccclass:g,property:f}=n;i("ZSTSB_AudioManager",(a=g("ZSTSB_AudioManager"),l=f({type:[s]}),a(((h=class i extends r{constructor(...i){super(...i),e(this,"clips",d,this),this.sfxAudio=null,this.bgmAudio=null}start(){i.instance=this,this.sfxAudio=this.node.getChildByName("sfxAudio").getComponent(u),this.bgmAudio=this.node.getChildByName("bgmAudio").getComponent(u),this.bgmAudio.play()}playSFX(i){for(let t of this.clips)if(t.name===i){this.sfxAudio.playOneShot(t);break}}playBGM(i){this.bgmAudio.stop();for(let t of this.clips)if(t.name===i){this.bgmAudio.clip=t,this.bgmAudio.play();break}}}).instance=null,d=t((p=h).prototype,"clips",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),c=p))||c));o._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_Course.ts",["cc"],(function(e){var i,t,n,s;return{setters:[function(e){i=e.cclegacy,t=e.Component,n=e.NodeEventType,s=e._decorator}],execute:function(){var o;i._RF.push({},"d7ce82NfZtNlZ7ypo2GLf1v","ZSTSB_Course",void 0);const{ccclass:c,property:h}=s;e("ZSTSB_Course",c("ZSTSB_Course")(o=class extends t{constructor(...e){super(...e),this.index=0}onEnable(){this.node.on(n.TOUCH_END,this.onClick,this)}onClick(){console.log("下一步教程");let e=this.node.children.length;if(this.index++,this.index>=e)return this.index=0,this.node.children[e-1].active=!1,this.node.children[this.index].active=!0,this.node.active=!1,void this.node.off(n.TOUCH_END,this.onClick,this);this.node.children[this.index-1].active=!1,this.node.children[this.index].active=!0}})||o);i._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_FillColor.ts",["cc","./ZSTSB_GameMgr.ts","./ZSTSB_AudioManager.ts"],(function(o){var e,t,n,i,l,s,r,c,a,h;return{setters:[function(o){e=o.cclegacy,t=o.Component,n=o.Color,i=o.Label,l=o.Sprite,s=o.NodeEventType,r=o.director,c=o._decorator},function(o){a=o.ZSTSB_GameMgr},function(o){h=o.ZSTSB_AudioManager}],execute:function(){var d;e._RF.push({},"6d4ceiAH09JsKjmI6DFYxRm","ZSTSB_FillColor",void 0);const{ccclass:S,property:u}=c;o("ZSTSB_FillColor",S("ZSTSB_FillColor")(d=class extends t{constructor(...o){super(...o),this.colorIndex=0,this.colorIndexLabel=null,this.colorValue=new n,this.colorValueSprite=null}initData(o,e){this.colorIndexLabel=this.node.getChildByName("Label").getComponent(i),this.colorValueSprite=this.node.children[0].getComponent(l),this.colorIndex=e,this.colorValue=o,this.colorIndexLabel.string=e.toString(),this.colorValueSprite.color=o,1===this.colorIndex&&(a.instance.selectNode.worldPosition=this.node.worldPosition),this.node.on(s.TOUCH_END,this.onTouchEnd,this),r.getScene().on("钻石填色本_颜色填充完毕",(o=>{this.colorIndex==o&&(this.colorIndexLabel.string="",this.node.getChildByName("完成").active=!0,this.node.off(s.TOUCH_END,this.onTouchEnd,this))}),this)}onTouchEnd(o){a.instance.SelectColor(),a.instance.SwitchColorNodes(this.colorValue),a.instance.selectNodeRoot=this.node,h.instance.playSFX("按钮")}})||d);e._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_GameData.ts",["cc"],(function(a){var t,e,i;return{setters:[function(a){t=a.cclegacy,e=a._decorator,i=a.sys}],execute:function(){var l,r;t._RF.push({},"510a1++PU5KcIqAZfsitT4L","ZSTSB_GameData",void 0);const{ccclass:p,property:n}=e;a("ZSTSB_GameData",p("ZSTSB_GameData")(((r=class a{constructor(){this.mapLockArr=[!0,!1,!1,!1,!1],this.mapProgressArr=[0,0,0,0,0],this.isMapFirst=!0,this.isGameFirst=!0,this.mapData=[{MapID:1,BuildingName:"1-1",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-2",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-3",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-4",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-5",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-6",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-7",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-8",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-9",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-10",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-11",State:!1,fillArr:[]},{MapID:1,BuildingName:"1-12",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-1",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-2",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-3",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-31",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-32",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-4",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-5",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-6",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-7",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-71",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-8",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-81",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-9",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-91",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-10",State:!1,fillArr:[]},{MapID:2,BuildingName:"2-101",State:!1,fillArr:[]}],this.propData=[{PropName:"消除当前数字索引",PropNum:10}],this.TimeDate=[]}getMapDataByID(a){let t=[];for(let e=0;e<this.mapData.length;e++)this.mapData[e].MapID==a&&t.push(this.mapData[e]);return t}getMapDataByName(a,t){for(let e=0;e<this.mapData.length;e++)if(this.mapData[e].MapID==a&&this.mapData[e].BuildingName==t)return this.mapData[e];return null}saveBuildingData(a,t,e){for(let i=0;i<this.mapData.length;i++)this.mapData[i].MapID==a&&this.mapData[i].BuildingName==t&&(this.mapData[i].fillArr=e);return null}getPropByName(a){for(let t=0;t<this.propData.length;t++)if(this.propData[t].PropName===a)return this.propData[t].PropNum;return null}pushPropByName(a,t){for(let e=0;e<this.propData.length;e++)if(this.propData[e].PropName===a)return this.propData[e].PropNum+=t,console.log("添加道具"+this.propData[e].PropName+"成功"),!0;return console.log("获得道具失败"),null}subPropByName(a,t){for(let e=0;e<this.propData.length;e++)if(this.propData[e].PropName===a&&this.propData[e].PropNum>=0)return this.propData[e].PropNum-=t,console.log("移除道具"+this.propData[e].PropName+"成功"),!0;return console.log("道具移除失败"),null}static get Instance(){return a.instance||this.ReadDate(),a.instance}static DateSave(){let t=JSON.stringify(a.Instance);i.localStorage.setItem("HJMSJ_DATA",t),console.log("游戏存档")}static ReadDate(){let t=i.localStorage.getItem("HJMSJ_DATA");""!=t&&null!=t?(console.log("读取存档"),a.instance=Object.assign(new a,JSON.parse(t))):(console.log("新建存档"),a.instance=new a)}}).instance=null,l=r))||l);t._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_GameMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ZSTSB_Pixel.ts","./ZSTSB_Incident.ts","./ZSTSB_FillColor.ts","./ZSTSB_GameData.ts","./ZSTSB_AudioManager.ts","./ZSTSB_PixelPool.ts","./ZSTSB_ParticlePool.ts"],(function(t){var e,i,o,s,l,r,n,a,h,c,g,p,u,d,C,m,N,x,f,S,P,w,M,I,B,D;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){o=t.cclegacy,s=t.macro,l=t.DynamicAtlasManager,r=t.Prefab,n=t.Node,a=t._decorator,h=t.Component,c=t.v3,g=t.Color,p=t.director,u=t.ScrollView,d=t.Sprite,C=t.ParticleSystem2D,m=t.tween,N=t.UITransform,x=t.instantiate,f=t.Vec3},function(t){S=t.ZSTSB_Pixel},function(t){P=t.ZSTSB_Incident},function(t){w=t.ZSTSB_FillColor},function(t){M=t.ZSTSB_GameData},function(t){I=t.ZSTSB_AudioManager},function(t){B=t.ZSTSB_PixelPool},function(t){D=t.ZSTSB_ParticlePool}],execute:function(){var y,b,T,v,_,F,k,z,L,A,Z,$,U,G,O,R,E,W;o._RF.push({},"17f682HrNVFN68j9CDUfYr5","ZSTSB_GameMgr",void 0);const{ccclass:j,property:H}=a;s.CLEANUP_IMAGE_CACHE=!1,l.instance.enabled=!0;t("ZSTSB_GameMgr",(y=j("ZSTSB_GameMgr"),b=H(B),T=H(D),v=H(r),_=H(n),F=H(n),k=H(n),z=H(n),y(((W=class t extends h{constructor(...t){super(...t),i(this,"PixelPoolCtrl",Z,this),i(this,"ParticlePoolCtrl",$,this),i(this,"colorBoxPrefab",U,this),i(this,"selectNode",G,this),i(this,"CourseNode",O,this),i(this,"ControlNode",R,this),i(this,"Target",E,this),this.selectNodeRoot=null,this.targetImage=null,this.startPos=c(250,0,0),this.curMapID=0,this.curBuildingName="",this.curColor=new g(211,249,188,255),this.curColorIndex=1,this.preColorIndex=-1,this.fillNodes=[],this.posNodes=[],this.isUseProp=!1,this.isLock=!1,this.pixelData2D=[],this.LockBtn=null,this.winNode=null,this.isTruePos=!1,this.isUsingPorp=!1,this.propBoxTs=null,this.propName="",this.finishColorNum=4,this.isCamMove=!1,this.curBox=null,this.colorIndexMap=new Map,this.colorSelect=[],this.isFirst=!1,this.startSize=10,this.curIndex=0,this.colorMap=new Map,this.posNodeMap=new Map,this.colorCache=new Map,this.colorLookupMap=new Map,this.isCreatingPixels=!1,this.isShow=!1,this.widthNum=0,this.heightNum=0}start(){t.instance=this,this.LockBtn=this.ControlNode.getChildByName("锁定视角"),this.winNode=this.ControlNode.getChildByName("完成"),p.getScene().on("钻石填色本_开始填色",(t=>{this.onFill(t)}),this),p.getScene().on("钻石填色本_结束填色",(()=>{this.isTruePos&&(this.isTruePos=!1,this.useProp())}),this)}startGame(){let t="Sprites/关卡/"+("关卡"+this.curMapID)+"/"+this.curBuildingName;P.LoadImageAsset(t).then((t=>{this.targetImage=t,this.loadImage()}))}SelectColor(){this.selectNode.parent=this.ControlNode.getChildByName("填色").getComponent(u).view.node,this.selectNode.setSiblingIndex(0)}SelectProp(){this.selectNode.parent=this.ControlNode}onBtnClick(t){switch(I.instance.playSFX("按钮"),t.target.name){case"锁定视角":this.isLock=!this.isLock,console.log("锁定视角:",this.isLock);let e=t.target.getComponent(d);this.isLock?e.color=new g(255,255,255,255):e.color=new g(255,255,255,150);break;case"教程按钮":this.CourseNode.active=!0;break;case"复位":this.restoration()}}Win(){this.fillOver(),this.selectNode.active=!1,this.selectNodeRoot=null,this.scheduleOnce((()=>{this.WinAni(),I.instance.playSFX("胜利")}),.6)}WinAni(){this.winNode.active=!0;let e=this.winNode.getChildByName("图片").getChildByName("完成图").getComponent(d),i=this.winNode.getChildByName("WinEffect").getComponent(C),o="Sprites/关卡/"+("关卡"+t.instance.curMapID)+"/"+this.curBuildingName;P.LoadSprite(o).then((t=>{e.spriteFrame=t,m(e.node.parent).to(.5,{scale:c(1,1,1)}).call((()=>{i.resetSystem()})).start()}))}onFill(t){this.isUseProp?this.posCheck(this.Target,t,this.fillNodes):this.posCheck(this.Target,t,this.posNodes)}posCheck(t,e,i){const o=t.scale.x,s=t.scale.y;for(let t=0;t<i.length;t++){let r=i[t];const n=r.getComponent(N),a=n.width*o/2,h=n.height*s/2,c=r.worldPosition.x-a,g=r.worldPosition.y-h,p=c+n.width*o,u=g+n.height*s;if(e.x>c&&e.x<p&&e.y>g&&e.y<u){const t=r.getComponent(S);if(this.isUseProp){var l;if(this.propBoxTs=t,0===(null==(l=this.propBoxTs)?void 0:l.ColorIndex)){this.propBoxTs=null,this.isTruePos=!1;break}this.isTruePos=!0}else t.onFill();break}}}async useProp(){var t,e;if(this.propBoxTs&&!this.propBoxTs.getLabelActive())return;if(this.isUsingPorp)return;if(0===(null==(t=this.propBoxTs)?void 0:t.ColorIndex))return void(this.isUsingPorp=!1);let i=null==(e=this.propBoxTs)||null==(e=e.ColorIndex)?void 0:e.toString(),o=this.colorIndexMap.get(i);if(o[0]===o[1])return;let s=this.posNodeMap.get(i);this.isUsingPorp=!0;for(let t=0;t<s.length;t+=20){const e=s.slice(t,t+20);for(let t of e){let e=t.getComponent(S);e.IsFilled||e.onPropFill()}I.instance.playSFX("填涂"),t+20<s.length?await new Promise((t=>this.scheduleOnce(t,.05))):(p.getScene().emit("钻石填色本_使用道具",this.propName),this.propBoxTs=null,this.isUsingPorp=!1)}}fillColor(t){let e=this.colorIndexMap.get(t.toString());if(e[0]++,e[0]>=e[1]){let e=!0;p.getScene().emit("钻石填色本_颜色填充完毕",t);for(let t=1;t<=this.colorIndexMap.size;t++){let i=this.colorIndexMap.get(t.toString());if(i[0]<i[1]){e=!1,this.curColorIndex=t;break}}if(e)return void this.Win();this.ParticlePoolCtrl.recycleParticle(),this.finishColorNum++,p.getScene().emit("钻石填色本_颜色填充加一",this.finishColorNum),this.SelectColor();let i=this.colorMap.get(this.curColorIndex.toString());console.log("当前填充颜色为："+i+",填充完毕"),this.SwitchColorNodes(i)}}ParticleEffect(t,e){let i=this.ParticlePoolCtrl.getParticleFromPool();i.node.active=!0,i.node.setWorldPosition(t),i.startColor=e,i.endColor=e,i.resetSystem()}async saveFillData(){let t=[];for(let e=0;e<this.fillNodes.length;e++){const i=this.fillNodes[e].getComponent(S),{r:o,g:s,b:l,a:r}=i.sprite.color;0!==o||0!==s||0!==l||0!==r?t.push(i.IsFilled):t.push(!0)}console.log(t.length),M.Instance.saveBuildingData(this.curMapID,this.curBuildingName,t),M.DateSave()}fillOver(){console.log("图片填充完毕"),M.Instance.getMapDataByName(this.curMapID,this.curBuildingName).State=!0,M.DateSave(),console.log(M.Instance.mapData),this.restoration()}SwitchColorNodes(t){this.isUseProp=!1,this.curColor=t;for(let t=0;t<this.colorMap.size;t++){let e=this.colorMap.get(t.toString());if((0!==e.r||0!==e.g||0!==e.b||0!==e.a)&&(this.curColor.r===e.r&&this.curColor.g===e.g&&this.curColor.b===e.b&&this.curColor.a===e.a)){this.posNodes=this.posNodeMap.get(t.toString()),this.preColorIndex=this.curColorIndex,this.curColorIndex=t,this.selectNodeRoot=this.colorSelect[t-1],console.log("切换颜色,当前颜色索引为："+this.curColorIndex);break}}this.preColorIndex===this.curColorIndex&&this.SearchColor()}SearchColor(){if(this.isCamMove)return;const t=this.Target.scale;for(let e of this.posNodes){if(!e.getComponent(S).IsFilled){this.curBox=e;const i=e.position,o=c(-i.x*t.x,-i.y*t.y,this.Target.position.z);return this.isCamMove=!0,void m(this.Target).to(.5,{position:o}).call((()=>{this.isCamMove=!1})).start()}}}restoration(){m(this.Target).to(.5,{scale:c(1,1,1),position:c(0,0,0)}).start()}async restart(){await this.saveFillData(),this.restoration(),p.getScene().emit("钻石填色本_开始切换场景"),this.PixelPoolCtrl.loading(),this.PixelPoolCtrl.recyclePixel(),this.winNode.active=!1;let e=this.winNode.getChildByName("图片");m(e).to(.2,{scale:c(0,0,0)}).start(),this.ControlNode.getChildByName("填色").getComponent(u).content.children.forEach((t=>{t.destroy()})),this.isLock=!1,this.isFirst=!1,this.isShow=!1,this.colorMap.clear(),this.posNodeMap.clear(),this.colorIndexMap.clear(),this.colorLookupMap.clear(),this.posNodes=[],this.fillNodes=[],this.colorSelect=[],this.finishColorNum=4,this.curIndex=0,this.curColorIndex=1,this.curColor=new g(255,255,255,255),this.curBuildingName="",this.selectNodeRoot=null,this.LockBtn.getComponent(d).color=new g(255,255,255,150),console.log(t.instance)}initSelectColor(){this.selectNode.active=!0,"2-31"===this.curBuildingName||"2-8"===this.curBuildingName||"2-81"===this.curBuildingName||"2-9"===this.curBuildingName||"2-10"===this.curBuildingName||"2-101"===this.curBuildingName?this.finishColorNum=2:this.finishColorNum=4;let t=this.ControlNode.getChildByName("填色").getComponent(u).content,e=[0,this.posNodeMap.get(this.curIndex.toString()).length];this.colorIndexMap.set(this.curIndex.toString(),e);for(let e=1;e<this.colorMap.size;e++){let i=this.colorMap.get(e.toString()),o=x(this.colorBoxPrefab);o.parent=t,e===this.curIndex+1&&(this.selectNodeRoot=o),o.getComponent(w).initData(i,e);let s=this.posNodeMap.get(e.toString()),l=0;for(let t=0;t<s.length;t++){s[t].getComponent(S).IsFilled&&l++}this.colorIndexMap.set(e.toString(),[l,s.length]),this.colorSelect.push(o)}for(let t=1;t<this.colorMap.size;t++){let e=this.posNodeMap.get(t.toString()),i=0;for(let t=0;t<e.length;t++){e[t].getComponent(S).IsFilled&&i++}if(i>=e.length){p.getScene().emit("钻石填色本_颜色填充完毕",t),this.finishColorNum++,p.getScene().emit("钻石填色本_颜色填充加一",this.finishColorNum);for(let t=1;t<this.colorIndexMap.size;t++){let e=this.colorIndexMap.get(t.toString());if(e[0]<e[1]){this.curColorIndex=t;break}}}}this.ParticlePoolCtrl.recycleParticle(),this.isFirst||(this.isFirst=!0,this.finishColorNum++,p.getScene().emit("钻石填色本_颜色填充加一",this.finishColorNum));let i=this.colorMap.get(this.curColorIndex.toString());this.SwitchColorNodes(i),this.scheduleOnce((()=>{m(this.Target).to(.5,{scale:c(4,4,4)}).start(),M.Instance.isGameFirst&&(this.CourseNode.active=!0,M.Instance.isGameFirst=!1)}),.5)}async loadImage(){if(this.targetImage){var t;await this.loadImagePixelData(this.targetImage),console.log("像素数据加载完成，二维数组尺寸:",this.pixelData2D.length,"x",(null==(t=this.pixelData2D[0])?void 0:t.length)||0);let e=this.Target.position.x-this.widthNum*this.startSize/2,i=this.Target.position.y-this.heightNum*this.startSize/2;this.startPos=c(e,i,0),this.colorCache.clear(),this.preScanColors(),this.colorMap.set(this.curIndex.toString(),new g(0,0,0,0)),this.posNodeMap.set(this.curIndex.toString(),[]),this.curIndex++,await this.createPixel(this.Target),console.log("像素数据创建完成"),console.log(this.colorMap)}}findColorIndex(t){const e=`${t.r},${t.g},${t.b},${t.a}`,i=this.colorLookupMap.get(e);if(void 0!==i)return i;for(let i=0;i<this.colorMap.size;i++){const o=this.colorMap.get(i.toString());if(o&&t.r===o.r&&t.g===o.g&&t.b===o.b&&t.a===o.a)return this.colorLookupMap.set(e,i),i}return-1}preScanColors(){const t=new Map;for(let e=0;e<this.heightNum;e++)for(let i=0;i<this.widthNum;i++){const o=this.pixelData2D[e][i],s=`${o.r},${o.g},${o.b},${o.a}`;t.has(s)||t.set(s,{...o})}console.log(`发现 ${t.size} 种不同颜色`),this.preWarmColorCache()}preWarmColorCache(){this.colorLookupMap.clear();for(let t=0;t<this.colorMap.size;t++){const e=this.colorMap.get(t.toString());if(e){const i=`${e.r},${e.g},${e.b},${e.a}`;this.colorLookupMap.set(i,t)}}}async createPixel(t){let e=this.heightNum*this.widthNum;this.preloadPixelPool(e),await this.createPixelsOptimized(t),this.scheduleOnce((()=>{this.initSelectColor(),I.instance.playBGM("游戏场景"),console.log(this.fillNodes.length)}),.1),this.scheduleOnce((()=>{}),.7)}preloadPixelPool(t){const e=this.PixelPoolCtrl.getPoolSize();e<t&&this.PixelPoolCtrl.preloadPixels(t-e)}async createPixelsOptimized(t){let e=M.Instance.getMapDataByName(this.curMapID,this.curBuildingName),i=this.heightNum*this.widthNum,o=this.precomputeAllPixelData(),s=this.groupPixelsByColor(o),l=0,r=0;for(const[o,n]of s){for(let o=0;o<n.length;o+=50){let s=n.slice(o,o+50);this.createPixelBatch(t,e.fillArr,s),l+=s.length,this.isShow||(r=l/i,p.getScene().emit("钻石填色本_加载进度",r)),o+50<n.length&&await new Promise((t=>this.scheduleOnce(t,0)))}i<3e3||i>3e3&&r>=.6&&(p.getScene().emit("钻石填色本_加载进度",1),this.isShow=!0)}}precomputeAllPixelData(){const t=[],e=this.PixelPoolCtrl.spritePrefab.data.getComponent(N),i=e.width,o=e.height,s=this.widthNum*i/2,l=this.heightNum*o/2,r=this.Target.position.x-s,n=this.Target.position.y-l;t.length=this.heightNum*this.widthNum;let a=0,h=null,c=0;for(let e=0;e<this.heightNum;e++){const s=-(n+e*o);for(let o=0;o<this.widthNum;o++){h=this.pixelData2D[e][o];const l=new f(r+o*i,s,0),n=77*h.r+150*h.g+29*h.b>>8,p={r:n,g:n,b:n,a:h.a};if(a=this.findColorIndex(h),-1===a){a=this.colorMap.size,this.colorMap.set(a.toString(),new g(h.r,h.g,h.b,h.a)),this.posNodeMap.set(a.toString(),[]);const t=h.r+","+h.g+","+h.b+","+h.a;this.colorLookupMap.set(t,a)}t[c]={i:e,j:o,position:l,grayColor:p,originalColor:h,colorIndex:a},c++}}return t}groupPixelsByColor(t){const e=new Map;Math.min(100,Math.ceil(t.length/10));for(let i=0;i<t.length;i++){const o=t[i],s=o.grayColor.r+","+o.grayColor.g+","+o.grayColor.b+","+o.grayColor.a;let l=e.get(s);l||(l=[],e.set(s,l)),l.push(o)}return e}createPixelBatch(t,e,i){const o=this.fillNodes,s=this.posNodeMap,l=this.PixelPoolCtrl,r=t.getChildByName("特效"),n=t.getChildByName("图片");let a=null;for(let t=0;t<i.length;t++){const h=i[t],c=l.getPixelFromPool();let p=l.getSpriteFromPool();p.node.parent!==n&&p.node.setParent(n),p.node.setPosition(h.position),c.parent!==r&&c.setParent(r),c.setPosition(h.position),o[o.length]=c;const u=c.getComponent(S);u&&(null!==e?u.initData(p,h.grayColor,new g(h.originalColor.r,h.originalColor.g,h.originalColor.b,h.originalColor.a),h.colorIndex,e[o.length]):u.initData(p,h.grayColor,new g(h.originalColor.r,h.originalColor.g,h.originalColor.b,h.originalColor.a),h.colorIndex)),a=s.get(h.colorIndex.toString()),a&&(a[a.length]=c),l.usePixel(c),l.useSprite(p)}}async loadImagePixelData(t){return new Promise(((e,i)=>{const o=new Image;o.onload=()=>{const t=document.createElement("canvas");t.width=o.width,t.height=o.height;const s=t.getContext("2d");if(!s)return void i(new Error("无法获取canvas 2D上下文"));s.drawImage(o,0,0);const l=s.getImageData(0,0,o.width,o.height).data;this.convertTo2DArray(l,o.width,o.height),this.widthNum=o.width,this.heightNum=o.height,e()},o.onerror=()=>{i(new Error("图片加载失败"))},o.src=t.nativeUrl}))}convertTo2DArray(t,e,i){this.pixelData2D=new Array(i);for(let o=0;o<i;o++){this.pixelData2D[o]=new Array(e);const i=o*e*4;for(let s=0;s<e;s++){const e=i+4*s;this.pixelData2D[o][s]={r:t[e],g:t[e+1],b:t[e+2],a:t[e+3]}}}}getPixelColor(t,e){return e>=0&&e<this.pixelData2D.length&&t>=0&&t<this.pixelData2D[e].length?this.pixelData2D[e][t]:null}getPixelData2D(){return this.pixelData2D}printPixelDataSample(t=5,e=5){console.log("像素数据采样 (前"+t+"x"+e+"像素):");for(let i=0;i<Math.min(e,this.pixelData2D.length);i++){let e="行 "+i+": ";for(let o=0;o<Math.min(t,this.pixelData2D[i].length);o++){const t=this.pixelData2D[i][o];e+=`RGBA(${t.r},${t.g},${t.b},${t.a}) `}console.log(e)}}update(t){this.selectNodeRoot&&(this.selectNode.worldPosition=this.selectNodeRoot.worldPosition)}}).instance=null,Z=e((A=W).prototype,"PixelPoolCtrl",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=e(A.prototype,"ParticlePoolCtrl",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=e(A.prototype,"colorBoxPrefab",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=e(A.prototype,"selectNode",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(A.prototype,"CourseNode",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(A.prototype,"ControlNode",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(A.prototype,"Target",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=A))||L));o._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_Incident.ts",["cc","./BundleManager.ts"],(function(e){var t,n,o,r,s,c,a;return{setters:[function(e){t=e.cclegacy,n=e.Component,o=e.SpriteFrame,r=e.Prefab,s=e.ImageAsset,c=e._decorator},function(e){a=e.BundleManager}],execute:function(){var i;t._RF.push({},"b50db+cRI5F7bWnS/3z2xzU","ZSTSB_Incident",void 0);const{ccclass:d,property:l}=c;e("ZSTSB_Incident",d("ZSTSB_Incident")(i=class extends n{static LoadSprite(e){return new Promise(((t,n)=>{a.GetBundle("45_ZSTSB").load(e+"/spriteFrame",o,((n,o)=>{n?console.log("没有找到图片"+e):t&&t(o)}))}))}static Loadprefab(e){return new Promise(((t,n)=>{a.GetBundle("45_ZSTSB").load(e,r,((n,o)=>{n?console.log("没有找到预制体"+e):t&&t(o)}))}))}static LoadImageAsset(e){return new Promise(((t,n)=>{a.GetBundle("45_ZSTSB").load(e,s,((n,o)=>{n?console.log("没有找到ImageAsset"+e):t&&t(o)}))}))}})||i);t._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_Loading.ts",["cc"],(function(e){var t,o,s,i,n,c,a;return{setters:[function(e){t=e.cclegacy,o=e.Component,s=e.director,i=e.UIOpacity,n=e.tween,c=e.Sprite,a=e._decorator}],execute:function(){var d;t._RF.push({},"f08571b4Z9JOLqdHTLU+qCO","ZSTSB_Loading",void 0);const{ccclass:h,property:l}=a;e("ZSTSB_Loading",h("ZSTSB_Loading")(d=class extends o{constructor(...e){super(...e),this.process=0}start(){s.getScene().on("钻石填色本_开始切换场景",this.openUI,this),s.getScene().on("钻石填色本_切换场景结束",this.closeUI,this),s.getScene().on("钻石填色本_加载进度",(e=>{this.updateProcess(e)}),this)}update(e){}openUI(){this.node.getChildByName("BG").active=!0;let e=this.node.getChildByName("BG").getComponent(i);n(e).to(.2,{opacity:255}).start()}closeUI(){let e=this.node.getChildByName("BG").getComponent(i),t=this.node.getChildByName("BG").getChildByName("加载条").getComponent(c);n(e).to(.2,{opacity:0}).call((()=>{this.node.getChildByName("BG").active=!1,t.fillRange=0})).start()}updateProcess(e){let t=this.node.getChildByName("BG").getChildByName("加载条").getComponent(c);this.process>e||(e>=1&&this.scheduleOnce((()=>{this.closeUI()}),.5),t.fillRange=e)}})||d);t._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_Map.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ZSTSB_GameData.ts","./ZSTSB_MapBtn.ts","./Banner.ts","./ZSTSB_GameMgr.ts","./ZSTSB_UIGame.ts","./ProjectEventManager.ts","./GameManager.ts","./UIManager.ts","./ZSTSB_Incident.ts","./ZSTSB_AudioManager.ts"],(function(e){var t,n,a,i,c,r,s,o,l,h,p,d,g,u,m,B,S,M,f,C,I,N,y;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.initializerDefineProperty},function(e){a=e.cclegacy,i=e.Node,c=e._decorator,r=e.Component,s=e.director,o=e.Sprite,l=e.ScrollView,h=e.v3,p=e.Label},function(e){d=e.ZSTSB_GameData},function(e){g=e.ZSTSB_MapBtn},function(e){u=e.default},function(e){m=e.ZSTSB_GameMgr},function(e){B=e.ZSTSB_UIGame},function(e){S=e.ProjectEventManager,M=e.ProjectEvent},function(e){f=e.GameManager},function(e){C=e.UIManager,I=e.Panel},function(e){N=e.ZSTSB_Incident},function(e){y=e.ZSTSB_AudioManager}],execute:function(){var _,v,D,b,T,Z,k;a._RF.push({},"3e5544lvbxFcarG1E9IlLqE","ZSTSB_Map",void 0);const{ccclass:G,property:P}=c;e("ZSTSB_Map",(_=G("ZSTSB_Map"),v=P(i),D=P(i),_((Z=t((T=class extends r{constructor(...e){super(...e),n(this,"returnBtn",Z,this),n(this,"courseNode",k,this),this.mainMapNode=null,this.curMapNode=null}start(){this.mainMapNode=this.node.getChildByName("大地图"),this.refreshBigMap()}update(e){}onBtnClick(e){y.instance.playSFX("按钮");let t=e.target.name;if(t.startsWith("未解锁"))u.Instance.ShowVideoAd((()=>{let t=e.target.name,n=t.charAt(t.length-1),a=parseInt(n);d.Instance.mapLockArr[a-1]=!0,this.loadMap(e.target.name)}));else if(t.startsWith("地图"))this.loadMap(e.target.name);else switch(e.target.name){case"返回主页":d.DateSave(),S.emit(M.返回主页按钮事件,(()=>{C.ShowPanel(I.LoadingPanel,f.StartScene,(()=>{S.emit(M.返回主页,"钻石填色本")}))}));break;case"返回选图":s.getScene().emit("钻石填色本_开始切换场景"),this.scheduleOnce((()=>{this.mainMapNode.active=!0,this.curMapNode.active=!1,B.instance.mapBtn.active=!1,this.returnBtn.active=!0,this.refreshBigMap(),y.instance.playBGM("主场景")}),.3);break;case"返回地图":B.instance.changeMenu("选图界面"),this.refreshBigMap(!1),this.refresghMap(m.instance.curMapID,!1),m.instance.restart(),y.instance.playBGM("主场景");break;case"教程按钮":this.courseNode.active=!0;break;case"填色按钮":this.loadGame(),B.instance.hideColorBox();break;case"关闭填色":B.instance.hideColorBox();break;case"快速填色":this.SearchFill()}}SearchFill(){let e=d.Instance.getMapDataByID(m.instance.curMapID);for(let t=0;t<e.length;t++){let n=e[t].State,a=e[t].BuildingName;if(!n){m.instance.curBuildingName=a;let e=B.instance.ColorBox.getChildByName("图片").getComponent(o),t="Sprites/关卡/"+("关卡"+m.instance.curMapID)+"/"+a;N.LoadSprite(t).then((t=>{e.spriteFrame=t,m.instance.curBuildingName=a,B.instance.showColorBox()}));break}}}loadGame(){this.scheduleOnce((()=>{B.instance.changeMenu("游戏界面"),m.instance.startGame()}),.5)}loadMap(e){s.getScene().emit("钻石填色本_开始切换场景"),this.scheduleOnce((()=>{this.mainMapNode.active=!1,this.curMapNode=this.node.getChildByName(e),this.curMapNode.active=!0;let t=e,n=t.charAt(t.length-1),a=parseInt(n);m.instance.curMapID=a,this.initMapData(a),B.instance.mapBtn.active=!0,this.updateMapProcess(a),console.log("切换到地图"+a),d.Instance.isMapFirst&&(this.courseNode.active=!0,d.Instance.isMapFirst=!1)}),.5)}initMapData(e){let t=d.Instance.getMapDataByID(e);console.log(t);for(let n=0;n<t.length;n++){let a=t[n].State,i=t[n].BuildingName,c=this.node.children[e].getComponent(l).content.children[n+2].getComponent(g);a?c.Complete(i):c.init(i),s.getScene().emit("钻石填色本_加载进度",(n+1)/t.length)}this.returnBtn.active=!1}refresghMap(e,t=!0){this.scheduleOnce((()=>{let n=d.Instance.getMapDataByID(e);this.updateMapProcess(e);for(let a=0;a<n.length;a++){let i=n[a].State,c=n[a].BuildingName,r=this.node.getChildByName("地图"+e).getComponent(l).content.children[a+2].getComponent(g);i&&r.Complete(c),t&&s.getScene().emit("钻石填色本_加载进度",(a+1)/n.length)}}),.3)}updateMapProcess(e){let t=d.Instance.getMapDataByID(e),n=B.instance.ColorBox.getChildByName("图片");switch(e){case 1:n.scale=h(6,6,6);break;case 2:n.scale=h(4,4,4);break;case 3:n.scale=h(6,6,6)}let a=t.length,i=0;for(let e=0;e<t.length;e++){t[e].State&&i++}let c=i/a,r=this.node.getChildByName("Btn").getChildByName("进度条");r.getChildByName("进度").getComponent(o).fillRange=c,r.getChildByName("进度百分比").getComponent(p).string=(100*c).toFixed(2)+"%"}refreshBigMap(e=!0){let t=this.node.getChildByName("大地图").getComponent(l);for(let n=0;n<d.Instance.mapLockArr.length;n++){if(d.Instance.mapLockArr[n]){t.content.children[n+2].name="地图"+(n+1),this.node.children[n+1].name="地图"+(n+1),t.content.children[n+2].getComponent(o).grayscale=!1,t.content.children[n+2].children[0].active=!1}else{t.content.children[n+2].name="未解锁"+(n+1),this.node.children[n+1].name="未解锁"+(n+1),t.content.children[n+2].getComponent(o).grayscale=!0,t.content.children[n+2].children[0].active=!0}e&&s.getScene().emit("钻石填色本_加载进度",(n+1)/d.Instance.mapLockArr.length)}}}).prototype,"returnBtn",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(T.prototype,"courseNode",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=T))||b));a._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_MapBtn.ts",["cc","./ZSTSB_Incident.ts","./ZSTSB_UIGame.ts","./ZSTSB_GameMgr.ts","./ZSTSB_GameData.ts","./ZSTSB_AudioManager.ts"],(function(t){var e,n,a,i,s,o,c,r,S,u;return{setters:[function(t){e=t.cclegacy,n=t.Component,a=t.Sprite,i=t.NodeEventType,s=t._decorator},function(t){o=t.ZSTSB_Incident},function(t){c=t.ZSTSB_UIGame},function(t){r=t.ZSTSB_GameMgr},function(t){S=t.ZSTSB_GameData},function(t){u=t.ZSTSB_AudioManager}],execute:function(){var p;e._RF.push({},"7a46eIOkhpIZK39v3XDdmYl","ZSTSB_MapBtn",void 0);const{ccclass:B,property:m}=s;t("ZSTSB_MapBtn",B("ZSTSB_MapBtn")(p=class extends n{constructor(...t){super(...t),this.buildingName=""}start(){}update(t){}init(t){this.buildingName=t,this.getComponent(a).grayscale=!0,this.node.on(i.TOUCH_END,this.touchEnd,this)}Complete(t){this.getComponent(a).grayscale=!1}touchEnd(){if(u.instance.playSFX("按钮"),S.Instance.getMapDataByName(r.instance.curMapID,this.buildingName).State)return;let t=c.instance.ColorBox.getChildByName("图片").getComponent(a),e="Sprites/关卡/"+("关卡"+r.instance.curMapID)+"/"+this.buildingName;o.LoadSprite(e).then((e=>{t.spriteFrame=e,r.instance.curBuildingName=this.buildingName,c.instance.showColorBox()}))}})||p);e._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_MapCtrl.ts",["cc"],(function(t){var r,c,e;return{setters:[function(t){r=t.cclegacy,c=t.Component,e=t._decorator}],execute:function(){var a;r._RF.push({},"d2f46EElMBFCrwP0SObaPJ1","ZSTSB_MapCtrl",void 0);const{ccclass:s,property:n}=e;t("ZSTSB_MapCtrl",s("ZSTSB_MapCtrl")(a=class extends c{start(){}update(t){}})||a);r._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_MoveCtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ZSTSB_GameMgr.ts"],(function(t){var e,i,o,s,n,h,c,a,r,l;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){o=t.cclegacy,s=t.Node,n=t._decorator,h=t.Component,c=t.v2,a=t.v3,r=t.director},function(t){l=t.ZSTSB_GameMgr}],execute:function(){var u,g,d,T,S,p;o._RF.push({},"c50a6PoSw9L15kmEuNNVVsF","ZSTSB_MoveCtrl",void 0);const{ccclass:y,property:f}=n;t("ZSTSB_MoveCtrl",(u=y("ZSTSB_MoveCtrl"),g=f(s),u((S=e((T=class extends h{constructor(...t){super(...t),i(this,"targetNode",S,this),i(this,"wheelZoomSpeed",p,this),this.touches=[],this.initialDistance=0,this.initialScale=c(1,1),this.currentScale=c(1,1),this.isDragging=!1,this.lastTouchPos=c(0,0),this.initialPosition=c(0,0)}start(){this.node.on(s.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(s.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(s.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(s.EventType.TOUCH_CANCEL,this.onTouchEnd,this),this.node.on(s.EventType.MOUSE_WHEEL,this.onMouseWheel,this)}update(t){}onDestroy(){this.node.off(s.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(s.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(s.EventType.TOUCH_END,this.onTouchEnd,this),this.node.off(s.EventType.TOUCH_CANCEL,this.onTouchEnd,this)}onTouchStart(t){const e=t.touch;if(e){if(-1===this.touches.findIndex((t=>t.getID()===e.getID()))&&this.touches.push(e),2===this.touches.length&&(this.initialDistance=this.getTouchDistance(this.touches[0],this.touches[1]),this.targetNode&&this.initialScale.set(this.targetNode.scale.x,this.targetNode.scale.y),this.isDragging=!1),1===this.touches.length&&!l.instance.isLock){this.isDragging=!0;const e=a(t.getUILocation().x,t.getUILocation().y,0);this.lastTouchPos.set(e.x,e.y),this.targetNode&&this.initialPosition.set(this.targetNode.worldPosition.x,this.targetNode.worldPosition.y)}if(1===this.touches.length&&l.instance.isLock){let e=a(t.getUILocation().x,t.getUILocation().y,0);l.instance.onFill(e)}}}onTouchMove(t){let e=a(t.getUILocation().x,t.getUILocation().y,0);if(2===this.touches.length&&!l.instance.isLock){const t=this.getTouchDistance(this.touches[0],this.touches[1]);if(this.initialDistance>0&&this.targetNode){const e=t/this.initialDistance,i=this.initialScale.x*e,o=this.initialScale.y*e;this.targetNode.setScale(i,o,this.targetNode.scale.z),this.currentScale.set(i,o)}}if(1===this.touches.length&&!l.instance.isLock){const e=t.touch,i=a(e.getUILocation().x,e.getUILocation().y,0);if(e&&this.targetNode){const t=i.x-this.lastTouchPos.x,e=i.y-this.lastTouchPos.y,o=this.initialPosition.x+t,s=this.initialPosition.y+e;this.targetNode.worldPosition=a(o,s,this.targetNode.position.z)}}1===this.touches.length&&l.instance.isLock&&l.instance.onFill(e)}onTouchEnd(t){r.getScene().emit("钻石填色本_结束填色");const e=t.touch;if(e){const t=this.touches.findIndex((t=>t.getID()===e.getID()));-1!==t&&this.touches.splice(t,1),this.touches.length<1&&(this.isDragging=!1)}}onMouseWheel(t){if(!l.instance.isLock&&this.targetNode){const e=1+(t.getScrollY()>0?this.wheelZoomSpeed:-this.wheelZoomSpeed),i=this.targetNode.scale.x*e,o=this.targetNode.scale.y*e;this.targetNode.setScale(i,o,this.targetNode.scale.z),this.currentScale.set(i,o)}}getTouchDistance(t,e){const i=t.getLocation(),o=e.getLocation(),s=o.x-i.x,n=o.y-i.y;return Math.sqrt(s*s+n*n)}}).prototype,"targetNode",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=e(T.prototype,"wheelZoomSpeed",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),d=T))||d));o._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_ParticlePool.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ZSTSB_GameMgr.ts"],(function(e){var t,r,i,l,o,s,c,a,n;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.initializerDefineProperty},function(e){i=e.cclegacy,l=e.Prefab,o=e._decorator,s=e.Component,c=e.instantiate,a=e.ParticleSystem2D},function(e){n=e.ZSTSB_GameMgr}],execute:function(){var P,u,p,h,f;i._RF.push({},"a2fd8Xf0KNFgb1JqbEsPqYW","ZSTSB_ParticlePool",void 0);const{ccclass:g,property:S}=o;e("ZSTSB_ParticlePool",(P=g("ZSTSB_ParticlePool"),u=S(l),P((f=t((h=class extends s{constructor(...e){super(...e),r(this,"particlePrefab",f,this),this.particlePool=[],this.usedParticles=[]}start(){this.CreateParticle(100)}async CreateParticle(e){const t=n.instance.Target;for(let r=0;r<e;r+=50){const i=Math.min(50,e-r);for(let e=0;e<i;e++){let e=c(this.particlePrefab);e.setParent(t);let r=e.getComponent(a);this.particlePool.push(r),e.active=!1}r+50<e&&await new Promise((e=>this.scheduleOnce(e,.01)))}console.log(`粒子对象池初始化完成，总共创建 ${e} 个粒子节点`)}getParticleFromPool(){if(this.particlePool.length>0)return this.particlePool.pop();{let e=c(this.particlePrefab);e.setParent(n.instance.Target);let t=e.getComponent(a);return this.particlePool.push(t),e.active=!1,t}}returnParticleToPool(e){this.particlePool.push(e)}useParticle(e){this.usedParticles.push(e)}recycleParticle(){const e=this.usedParticles.splice(0,Math.min(100,this.usedParticles.length));for(let t of e)this.returnParticleToPool(t);this.usedParticles.length>0?this.scheduleOnce((()=>{this.recycleParticle()}),.01):console.log("粒子回收完成")}}).prototype,"particlePrefab",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=h))||p));i._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_Pixel.ts",["cc","./ZSTSB_GameMgr.ts","./ZSTSB_AudioManager.ts"],(function(i){var t,e,l,s,o,r,n,h,c;return{setters:[function(i){t=i.cclegacy,e=i.Component,l=i.Color,s=i.Label,o=i.UIOpacity,r=i.director,n=i._decorator},function(i){h=i.ZSTSB_GameMgr},function(i){c=i.ZSTSB_AudioManager}],execute:function(){var a;t._RF.push({},"0d7d3tgcwhNXYBR54FFhJ4r","ZSTSB_Pixel",void 0);const{ccclass:p,property:d}=n;i("ZSTSB_Pixel",p("ZSTSB_Pixel")(a=class extends e{constructor(...i){super(...i),this.colorIndex=0,this.pixelColor=new l,this.sprite=null,this.label=null,this.isFilled=!1,this.spUIOp=null,this.particle=null,this.showIndex=5,this.blackColor=new l(1,1,1,255)}get ColorIndex(){return this.colorIndex}get IsFilled(){return this.isFilled}onLoad(){this.label=this.node.getChildByName("数字").getComponent(s),this.changeUIOpacity(0)}initData(i,t,e,s,n){this.colorIndex=s,this.sprite=i,this.spUIOp=this.sprite.getComponent(o);let c=h.instance.curBuildingName;if(this.showIndex="2-31"===c||"2-8"===c||"2-81"===c||"2-9"===c||"2-10"===c||"2-101"===c?3:5,0===e.a?(this.pixelColor=new l(0,0,0,0),this.sprite.color=new l(0,0,0,0)):(this.pixelColor=e,this.colorIndex>this.showIndex?this.label.node.active=!1:this.label.node.active=!0,this.label.string=this.colorIndex.toString(),this.changeUIOpacity(255)),n)this.Filled();else{let i=t;this.sprite.color=new l(i.r,i.g,i.b,i.a)}r.getScene().on("钻石填色本_颜色填充加一",(i=>{this.colorIndex===i&&this.showLabel(!0)}),this)}showLabel(i){console.log(this.colorIndex+"显示"),this.label.node.active=i}onFill(){if(this.isFilled)return;if(!this.label.node.active)return;let i=h.instance.curColor;if(this.pixelColor.r===i.r&&this.pixelColor.g===i.g&&this.pixelColor.b===i.b&&this.pixelColor.a===i.a){this.isFilled=!0,this.label.string="";let t=this.pixelColor;0===i.r&&0===i.g&&0===i.b&&(t=this.blackColor),this.sprite.color=t,c.instance.playSFX("填涂"),h.instance.fillColor(this.colorIndex),h.instance.ParticleEffect(this.node.worldPosition.clone(),t)}}onPropFill(){if(!this.label.node.active)return;this.isFilled=!0,this.label.string="";let i=this.pixelColor;0===i.r&&0===i.g&&0===i.b&&(i=this.blackColor),this.sprite.color=i,h.instance.fillColor(this.colorIndex),h.instance.ParticleEffect(this.node.worldPosition.clone(),i)}Filled(){this.isFilled=!0,this.label.string="";let i=this.pixelColor;0===i.r&&0===i.g&&0===i.b&&255===i.a&&(i=this.blackColor),this.sprite.color=i}reset(){this.isFilled=!1,this.label.string="",this.showLabel(!1),this.sprite.color=l.WHITE,this.pixelColor=l.WHITE,this.changeUIOpacity(0)}changeUIOpacity(i){this.spUIOp&&(this.spUIOp.opacity=i)}getLabelActive(){return this.label.node.active}})||a);t._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_PixelPool.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ZSTSB_Pixel.ts","./ZSTSB_GameMgr.ts"],(function(e){var t,i,s,o,l,r,n,h,p,P,a,u,c;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.initializerDefineProperty},function(e){s=e.cclegacy,o=e.Prefab,l=e._decorator,r=e.Component,n=e.instantiate,h=e.Sprite,p=e.v3,P=e.Color,a=e.director},function(e){u=e.ZSTSB_Pixel},function(e){c=e.ZSTSB_GameMgr}],execute:function(){var x,f,g,S,d,m,b;s._RF.push({},"6b30eDLKKhJ8rhtF7/y51u7","ZSTSB_PixelPool",void 0);const{ccclass:T,property:y}=l;e("ZSTSB_PixelPool",(x=T("ZSTSB_PixelPool"),f=y(o),g=y(o),x((m=t((d=class extends r{constructor(...e){super(...e),i(this,"pixelPrefab",m,this),i(this,"spritePrefab",b,this),this.pixelPool=[],this.usedPixels=[],this.spritePool=[],this.usedSprites=[],this.totalPixels=0,this.finishPixels=0}start(){this.CreatePixels(2500)}async CreatePixels(e){const t=c.instance.Target.getChildByName("特效"),i=c.instance.Target.getChildByName("图片");for(let s=0;s<e;s+=50){const o=Math.min(50,e-s);for(let e=0;e<o;e++){const e=n(this.pixelPrefab),s=n(this.spritePrefab);e.setParent(t),s.setParent(i);const o=s.getComponent(h);this.pixelPool.push(e),this.spritePool.push(o)}s+50<e&&await new Promise((e=>this.scheduleOnce(e,.01)))}console.log(`对象池初始化完成，总共创建 ${e} 个像素节点`)}getPixelFromPool(){return this.pixelPool.length>0?this.pixelPool.pop():n(this.pixelPrefab)}getSpriteFromPool(){return this.spritePool.length>0?this.spritePool.pop():n(this.spritePrefab).getComponent(h)}returnPixelToPool(e){e.position=p(0,0,0);const t=e.getComponent(u);t&&t.reset(),this.pixelPool.push(e)}returnSpriteToPool(e){e.color=P.WHITE,this.spritePool.push(e)}usePixel(e){this.usedPixels.push(e)}useSprite(e){this.usedSprites.push(e)}loading(){this.totalPixels=Array.from(this.usedPixels).length}recyclePixel(){const e=this.usedPixels.splice(0,Math.min(30,this.usedPixels.length)),t=this.usedSprites.splice(0,Math.min(30,this.usedSprites.length));for(let e of t){let t=e.getComponent(h);this.returnSpriteToPool(t)}for(let t of e){this.returnPixelToPool(t),this.finishPixels++;let e=this.finishPixels/this.totalPixels;a.getScene().emit("钻石填色本_加载进度",e)}this.usedPixels.length>0?this.scheduleOnce((()=>{this.recyclePixel()}),.01):(console.log("对象池回收完成"),this.finishPixels=0)}preloadPixels(e){for(let t=0;t<e;t++){const e=n(this.pixelPrefab);this.pixelPool.push(e)}}getPoolSize(){return this.pixelPool.length}}).prototype,"pixelPrefab",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=t(d.prototype,"spritePrefab",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=d))||S));s._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_Prop.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ZSTSB_GameData.ts","./ZSTSB_GameMgr.ts","./Banner.ts","./ZSTSB_AudioManager.ts"],(function(t){var e,i,s,r,o,n,p,a,c,h,l,u,S;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){s=t.cclegacy,r=t._decorator,o=t.Component,n=t.Node,p=t.director,a=t.Label,c=t.Sprite},function(t){h=t.ZSTSB_GameData},function(t){l=t.ZSTSB_GameMgr},function(t){u=t.default},function(t){S=t.ZSTSB_AudioManager}],execute:function(){var m,g,d,N,P;s._RF.push({},"934d0sujilJQarK6rkFV7Zu","ZSTSB_Prop",void 0);const{ccclass:B,property:_}=r;t("ZSTSB_Prop",(m=B("ZSTSB_Prop"),g=_(),m((P=e((N=class extends o{constructor(...t){super(...t),i(this,"propName",P,this),this.adSprite=null,this.label=null,this.propNum=0}start(){this.init(),this.node.on(n.EventType.TOUCH_END,this.onClick,this),p.getScene().on("钻石填色本_使用道具",(t=>{this.propName===t&&this.useProp()}),this),p.getScene().on("钻石填色本_获得道具",(t=>{this.propName===t&&this.getProp()}),this)}onClick(){S.instance.playSFX("按钮"),this.adSprite.active?(l.instance.isUseProp=!1,u.Instance.ShowVideoAd((()=>{this.getProp()}))):(l.instance.isUseProp=!0,l.instance.propName=this.propName,l.instance.selectNodeRoot=this.node,console.log("点击道具："+this.propName),l.instance.SelectProp())}init(){this.label=this.node.getChildByName("道具数量").getComponent(a),this.adSprite=this.node.getChildByName("广告");let t=h.Instance.getPropByName(this.propName);t&&(this.propNum=t,this.label.string=this.propNum.toString())}refreshUI(){this.label.string=this.propNum.toString(),this.propNum<=0?(this.getComponent(c).grayscale=!0,this.adSprite.active=!0,l.instance.isUseProp=!1):(this.getComponent(c).grayscale=!1,this.adSprite.active=!1)}useProp(){h.Instance.subPropByName(this.propName,1)&&(this.propNum--,this.refreshUI())}getProp(){h.Instance.pushPropByName(this.propName,1)&&(this.propNum++,this.refreshUI())}}).prototype,"propName",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),d=N))||d));s._RF.pop()}}}));

System.register("chunks:///_virtual/ZSTSB_UIGame.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ZSTSB_AudioManager.ts"],(function(e){var t,i,n,o,a,r,c,l,s,u,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.initializerDefineProperty},function(e){n=e.cclegacy,o=e.Node,a=e._decorator,r=e.Component,c=e.director,l=e.UIOpacity,s=e.tween,u=e.v3},function(e){h=e.ZSTSB_AudioManager}],execute:function(){var p,B,g,d,S,m,C,y;n._RF.push({},"ad8ef/YvRxEvIBkJ3teobpz","ZSTSB_UIGame",void 0);const{ccclass:f,property:b}=a;e("ZSTSB_UIGame",(p=f("ZSTSB_UIGame"),B=b(o),g=b(o),p(((y=class e extends r{constructor(...e){super(...e),this.curScene="选图界面",i(this,"mapBtn",m,this),i(this,"ColorBox",C,this),this.fillBoard=null,this.fillCourse=null,this.fillProgress=null}start(){e.instance=this,this.init()}update(e){}onBtnClick(e){switch(h.instance.playSFX("按钮"),e.target.name){case"开始游戏":this.changeMenu("选图界面")}}changeMenu(e){c.getScene().emit("钻石填色本_开始切换场景");let t=this.node.getChildByName(this.curScene).getComponent(l);s(t).to(.2,{opacity:0},{easing:"backIn"}).call((()=>{"游戏界面"!==this.curScene&&(this.node.getChildByName(this.curScene).active=!1),this.node.getChildByName(e).active=!0})).start();let i=this.node.getChildByName(e).getComponent(l);s(i).to(.8,{opacity:255},{easing:"backOut"}).call((()=>{this.curScene=e})).start()}showColorBox(){this.ColorBox.active=!0,s(this.ColorBox).to(.5,{scale:u(1,1,1)},{easing:"backOut"}).call((()=>{})).start()}hideColorBox(){s(this.ColorBox).to(.5,{scale:u(0,0,0)},{easing:"backIn"}).call((()=>{this.ColorBox.active=!1})).start()}init(){}}).instance=null,m=t((S=y).prototype,"mapBtn",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(S.prototype,"ColorBox",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=S))||d));n._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/45_ZSTSB', 'chunks:///_virtual/45_ZSTSB'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});